import{r as s,j as e,M as F,I as y,S as _,m as v,g as q,u as L,t as N,E as T}from"./index-3fd54424.js";import{b as U,e as V,f as B,g as W,h as A}from"./live-9d1ed6d0.js";import{B as O}from"./index-c3c15456.js";import{P as S}from"./index-df05a090.js";import{H as k}from"./index-d5d1e443.js";import{F as o}from"./index-0ca68444.js";import{S as I}from"./index-ff4e3b6e.js";import{T as P}from"./Table-59a53b18.js";import"./LeftOutlined-a0f8cfa6.js";import"./InfoCircleOutlined-fefc69ce.js";import"./row-98a37fbf.js";import"./responsiveObserver-a0dea2e5.js";import"./useIcons-235bc0cd.js";import"./CheckOutlined-44e74bd9.js";import"./addEventListener-1752243f.js";import"./Pagination-a2ebdf00.js";import"./useForceUpdate-56773729.js";import"./index-a56efb1a.js";import"./iconUtil-14ff0944.js";const Z=t=>{const[l]=o.useForm(),[c,m]=s.useState(!1),[x,g]=s.useState([]);s.useEffect(()=>{t.open&&l.setFieldsValue({name:"",sort:"",parent_id:0})},[t.open]),s.useEffect(()=>{let r=[{value:0,label:"无-作为一级分类"}];for(let h=0;h<t.categories.length;h++)r.push({label:t.categories[h].name,value:t.categories[h].id});g(r)},[t.categories]);const j=r=>{c||(m(!0),U(r).then(h=>{m(!1),v.success("成功！"),t.onSuccess()}).catch(h=>{m(!1)}))},p=r=>{console.log("Failed:",r)};return e.jsx(e.Fragment,{children:t.open?e.jsx(F,{title:"添加分类",onCancel:()=>{t.onCancel()},open:!0,width:800,maskClosable:!1,onOk:()=>{l.submit()},centered:!0,children:e.jsx("div",{className:"float-left mt-30",children:e.jsxs(o,{form:l,name:"live-category-create-dailog",labelCol:{span:3},wrapperCol:{span:21},initialValues:{remember:!0},onFinish:j,onFinishFailed:p,autoComplete:"off",children:[e.jsx(o.Item,{label:"父级分类",name:"parent_id",rules:[{required:!0,message:"请选择父级分类!"}],children:e.jsx(I,{style:{width:300},placeholder:"请选择父级分类",allowClear:!0,options:x})}),e.jsx(o.Item,{label:"分类名称",name:"name",rules:[{required:!0,message:"请输入分类名称!"}],children:e.jsx(y,{style:{width:300},placeholder:"请输入分类名称",allowClear:!0})}),e.jsx(o.Item,{label:"排序",name:"sort",rules:[{required:!0,message:"填输入排序!"}],children:e.jsxs(_,{align:"baseline",style:{height:32},children:[e.jsx(o.Item,{name:"sort",rules:[{required:!0,message:"填输入排序!"}],children:e.jsx(y,{type:"number",style:{width:300},placeholder:"填输入排序",allowClear:!0})}),e.jsx("div",{className:"ml-10",children:e.jsx(k,{text:"填写整数，数字越小排序越靠前"})})]})})]})})}):null})},H=t=>{const[l]=o.useForm(),[c,m]=s.useState(!0),[x,g]=s.useState(!1),[j,p]=s.useState([]);s.useEffect(()=>{t.open&&(m(!0),l.setFieldsValue({name:"",sort:"",parent_id:0})),t.id>0&&r()},[t.open,t.id]),s.useEffect(()=>{let n=[{value:0,label:"无-作为一级分类"}];for(let f=0;f<t.categories.length;f++)n.push({label:t.categories[f].name,value:t.categories[f].id,disabled:t.categories[f].id===t.id});p(n)},[t.categories,t.id]);const r=async()=>{await h(),m(!1)},h=async()=>{const n=await V(t.id);l.setFieldsValue({name:n.data.name,sort:n.data.sort,parent_id:n.data.parent_id})},b=n=>{x||(g(!0),B(t.id,n).then(f=>{g(!1),v.success("成功！"),t.onSuccess()}).catch(f=>{g(!1)}))},C=n=>{console.log("Failed:",n)};return e.jsx(e.Fragment,{children:t.open?e.jsxs(F,{title:"编辑分类",onCancel:()=>{t.onCancel()},open:!0,width:800,maskClosable:!1,onOk:()=>{l.submit()},centered:!0,children:[c&&e.jsx("div",{className:"float-left text-center mt-30",children:e.jsx(q,{})}),e.jsx("div",{style:{display:c?"none":"block"},className:"float-left mt-30",children:e.jsxs(o,{form:l,name:"live-category-update-dailog",labelCol:{span:3},wrapperCol:{span:21},initialValues:{remember:!0},onFinish:b,onFinishFailed:C,autoComplete:"off",children:[e.jsx(o.Item,{label:"父级分类",name:"parent_id",rules:[{required:!0,message:"请选择父级分类!"}],children:e.jsx(I,{style:{width:300},placeholder:"请选择父级分类",allowClear:!0,options:j})}),e.jsx(o.Item,{label:"分类名称",name:"name",rules:[{required:!0,message:"请输入分类名称!"}],children:e.jsx(y,{style:{width:300},placeholder:"请输入分类名称",allowClear:!0})}),e.jsx(o.Item,{label:"排序",name:"sort",rules:[{required:!0,message:"填输入排序!"}],children:e.jsxs(_,{align:"baseline",style:{height:32},children:[e.jsx(o.Item,{name:"sort",rules:[{required:!0,message:"填输入排序!"}],children:e.jsx(y,{type:"number",style:{width:300},placeholder:"填输入排序",allowClear:!0})}),e.jsx("div",{className:"ml-10",children:e.jsx(k,{text:"填写整数，数字越小排序越靠前"})})]})})]})})]}):null})},{confirm:M}=F,de=()=>{const t=L(),[l,c]=s.useState(!1),[m,x]=s.useState([]),[g,j]=s.useState(!1),[p,r]=s.useState(!1),[h,b]=s.useState(!1),[C,n]=s.useState(0);s.useEffect(()=>{document.title="直播课程分类",t(N("直播课程分类"))},[]),s.useEffect(()=>{f()},[g]);const f=()=>{l||(c(!0),W({}).then(d=>{const a=[];let u=d.data;for(let i=0;i<u.length;i++)u[i].children.length>0?a.push({name:u[i].name,id:u[i].id,sort:u[i].sort,children:u[i].children,courses_count:u[i].courses_count}):a.push({name:u[i].name,id:u[i].id,sort:u[i].sort,courses_count:u[i].courses_count});x(a),c(!1)}).catch(d=>{c(!1)}))},E=[{title:"排序",width:150,render:(d,a)=>e.jsx("span",{children:a.sort})},{title:"分类名",render:(d,a)=>e.jsxs("span",{children:[a.name," "]})},{title:"下属课程",width:150,render:(d,a)=>e.jsxs("span",{children:[a.courses_count,"个"]})},{title:"操作",width:160,fixed:"right",render:(d,a)=>e.jsxs(_,{children:[e.jsx(S,{type:"link",text:"编辑",class:"c-primary",icon:null,p:"addons.Zhibo.course_category.update",onClick:()=>{n(a.id),b(!0)},disabled:null}),e.jsx(S,{type:"link",text:"删除",class:"c-red",icon:null,p:"addons.Zhibo.course_category.delete",onClick:()=>{D(a.id)},disabled:null})]})}],w=()=>{x([]),j(!g)},D=d=>{d!==0&&M({title:"操作确认",icon:e.jsx(T,{}),content:"确认删除此分类？",centered:!0,okText:"确认",cancelText:"取消",onOk(){l||(c(!0),A(d).then(()=>{c(!1),v.success("删除成功"),w()}).catch(a=>{c(!1)}))},onCancel(){console.log("Cancel")}})};return e.jsxs("div",{className:"meedu-main-body",children:[e.jsx(O,{title:"直播课程分类"}),e.jsx(Z,{categories:m,open:p,onCancel:()=>r(!1),onSuccess:()=>{w(),r(!1)}}),e.jsx(H,{id:C,categories:m,open:h,onCancel:()=>b(!1),onSuccess:()=>{w(),b(!1)}}),e.jsx("div",{className:"float-left  mt-30 mb-30",children:e.jsx(S,{type:"primary",text:"添加分类",class:"",icon:null,p:"addons.Zhibo.course_category.store",onClick:()=>r(!0),disabled:null})}),e.jsx("div",{className:"float-left",children:e.jsx(P,{loading:l,columns:E,dataSource:m,rowKey:d=>d.id,pagination:!1})})]})};export{de as default};
