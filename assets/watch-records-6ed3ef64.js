import{u as X,b as Z,f as $,r as a,t as ee,j as s,I as te,B as j,d as b,m as se,h as M}from"./index-b4683d61.js";import{B}from"./course-7dc1c12e.js";import{D as P}from"./index-44896e29.js";import{B as ae}from"./index-5f967da4.js";import{u as re,w as ie}from"./xlsx-b055c42d.js";import{T as oe}from"./Table-76e623b5.js";import{D as de}from"./index-cc7d88a3.js";import"./LeftOutlined-9e6e73a2.js";import"./addEventListener-a27ae3f4.js";import"./useIcons-e0af7133.js";import"./CheckOutlined-e6bc730e.js";import"./Pagination-d2c763c6.js";import"./useForceUpdate-f2aff5e0.js";import"./responsiveObserver-dc429d3b.js";import"./index-c09cc6d7.js";import"./index-10f1a096.js";import"./iconUtil-f3f90360.js";const{RangePicker:ne}=de,Ye=()=>{const E=X();Z();const d=new URLSearchParams($().search),[u,n]=a.useState(!1),[L,w]=a.useState([]),[m,h]=a.useState(1),[f,S]=a.useState(10),[v,R]=a.useState(0),[p,N]=a.useState(!1),[c,z]=a.useState({}),[ce,T]=a.useState({}),[_,A]=a.useState({}),[x,D]=a.useState(""),[l,k]=a.useState([]),[F,C]=a.useState([]),[g,H]=a.useState(Number(d.get("course_id"))),[Y,W]=a.useState(Number(d.get("id")));a.useEffect(()=>{document.title="课时学习记录",E(ee("课时学习记录"))},[]),a.useEffect(()=>{H(Number(d.get("course_id"))),W(Number(d.get("id")))},[d.get("id"),d.get("course_id")]),a.useEffect(()=>{U()},[g,m,f,p]);const U=()=>{u||(n(!0),B(Y,{page:m,size:f,course_id:g,user_id:x,watched_start_at:l[0],watched_end_at:l[1]}).then(e=>{w(e.data.data.data),R(e.data.data.total),z(e.data.users),T(e.data.courses),A(e.data.videos),n(!1)}).catch(e=>{n(!1)}))},V=()=>{h(1),S(10),w([]),D(""),C([]),k([]),N(!p)},K={current:m,pageSize:f,total:v,onChange:(e,t)=>q(e,t),showSizeChanger:!0},q=(e,t)=>{h(e),S(t)},G=[{title:"学员ID",width:120,render:(e,t)=>s.jsx("span",{children:t.user_id})},{title:"学员",render:(e,t)=>s.jsxs(s.Fragment,{children:[c[t.user_id]&&s.jsxs("div",{className:"user-item d-flex",children:[s.jsx("div",{className:"avatar",children:s.jsx("img",{src:c[t.user_id].avatar,width:"40",height:"40"})}),s.jsx("div",{className:"ml-10",children:c[t.user_id].nick_name})]}),!c[t.user_id]&&s.jsx("span",{className:"c-red",children:"学员不存在"})]})},{title:"课时时长",width:150,render:(e,t)=>s.jsx(s.Fragment,{children:_[t.video_id]&&s.jsx(P,{duration:_[t.video_id].duration})})},{title:"已观看",width:150,render:(e,t)=>s.jsx(P,{duration:t.watch_seconds})},{title:"开始时间",width:200,dataIndex:"created_at",render:e=>s.jsx("span",{children:b(e)})},{title:"看完时间",width:200,dataIndex:"watched_at",render:e=>s.jsx("span",{children:b(e)})}],y=e=>{let t=Math.floor(e/3600),i=Math.floor((e-t*3600)/60),o=e-t*3600-i*60;return t===0&&i===0&&o===0?null:(t===0?t="":t=t+":",i<10&&(i="0"+i),o<10&&(o="0"+o),t+i+":"+o)},J=()=>{if(u)return;n(!0);let e={page:1,size:v,course_id:g,user_id:x,watched_start_at:l[0],watched_end_at:l[1]};B(Y,e).then(t=>{if(t.data.data.total===0){se.error("数据为空"),n(!1);return}let i="课时学习记录.xlsx",o="sheet1",I=[["学员ID","学员","手机号","课时时长","已观看","开始时间","结束时间"]];t.data.data.data.forEach(r=>{I.push([r.user_id,c[r.user_id].nick_name,c[r.user_id].mobile,y(_[r.video_id].duration),y(r.watch_seconds),r.created_at?M(r.created_at).format("YYYY-MM-DD HH:mm"):"",r.watched_at?M(r.watched_at).format("YYYY-MM-DD HH:mm"):""])});const O=re.json_to_sheet(I),Q={SheetNames:[o],Sheets:{[o]:O}};ie(Q,i),n(!1)})};return s.jsxs("div",{className:"meedu-main-body",children:[s.jsx(ae,{title:"课时学习记录"}),s.jsxs("div",{className:"float-left mt-30",children:[s.jsx(te,{style:{width:150},value:x,onChange:e=>{D(e.target.value)},allowClear:!0,placeholder:"学员ID"}),s.jsx(ne,{format:"YYYY-MM-DD",value:F,style:{marginLeft:10},onChange:(e,t)=>{k(t),C(e)},placeholder:["看完时间-开始","看完时间-结束"]}),s.jsx(j,{className:"ml-10",onClick:V,children:"清空"}),s.jsx(j,{className:"ml-10",type:"primary",onClick:()=>{h(1),N(!p)},children:"筛选"}),s.jsx(j,{type:"primary",className:"ml-10",onClick:()=>J(),children:"导出表格"})]}),s.jsx("div",{className:"float-left mt-30",children:s.jsx(oe,{loading:u,columns:G,dataSource:L,rowKey:e=>e.id,pagination:K})})]})};export{Ye as default};
