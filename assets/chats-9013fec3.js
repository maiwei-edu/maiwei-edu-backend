import{f as R,u as T,r as a,t as z,j as e,d as B,m as p,E as D,M}from"./index-b4683d61.js";import{L as K,M as I}from"./live-ef2dd82c.js";import{B as U}from"./index-5f967da4.js";import{P as A}from"./index-573a6ce5.js";import{T as O}from"./Table-76e623b5.js";import"./LeftOutlined-9e6e73a2.js";import"./addEventListener-a27ae3f4.js";import"./useIcons-e0af7133.js";import"./CheckOutlined-e6bc730e.js";import"./Pagination-d2c763c6.js";import"./useForceUpdate-f2aff5e0.js";import"./responsiveObserver-dc429d3b.js";import"./index-c09cc6d7.js";import"./index-10f1a096.js";import"./iconUtil-f3f90360.js";const{confirm:V}=M,ie=()=>{const n=new URLSearchParams(R().search),x=T(),[o,i]=a.useState(!1),[f,d]=a.useState([]),[r,m]=a.useState(1),[c,j]=a.useState(10),[b,S]=a.useState(0),[u,y]=a.useState(!1),[l,_]=a.useState([]),[h,N]=a.useState(Number(n.get("id"))),[g,w]=a.useState(Number(n.get("course_id")));a.useEffect(()=>{document.title="聊天记录",x(z("聊天记录"))},[]),a.useEffect(()=>{N(Number(n.get("id"))),w(Number(n.get("course_id")))},[n.get("id"),n.get("course_id")]),a.useEffect(()=>{C()},[h,g,r,c,u]);const C=()=>{o||(i(!0),K(g,h,{page:r,size:c}).then(s=>{d(s.data.data),S(s.data.total),i(!1)}).catch(s=>{i(!1)}))},v=()=>{m(1),d([]),y(!u)},E=[{title:"学员",width:300,render:(s,t)=>e.jsxs(e.Fragment,{children:[t.user&&e.jsxs("div",{className:"user-item d-flex",children:[e.jsx("div",{className:"avatar",children:e.jsx("img",{src:t.user.avatar,width:"40",height:"40"})}),e.jsx("div",{className:"ml-10",children:t.user.nick_name})]}),!t.user&&e.jsx("span",{className:"c-red",children:"学员不存在"})]})},{title:"角色",width:120,render:(s,t)=>e.jsx(e.Fragment,{children:t.msg_body?e.jsx(e.Fragment,{children:t.msg_body.role&&t.msg_body.role==="student"?e.jsx("span",{className:"c-gray",children:"学生"}):e.jsx("span",{className:"c-green",children:t.msg_body.role&&t.msg_body.role==="assistant"?"助教":"讲师"})}):e.jsx("span",{children:"-"})})},{title:"聊天内容",render:(s,t)=>e.jsx(e.Fragment,{children:t.msg_body&&e.jsx("span",{children:t.msg_body.content})})},{title:"时间",width:200,dataIndex:"created_at",render:s=>e.jsx("span",{children:B(s)})}],P={current:r,pageSize:c,total:b,onChange:(s,t)=>k(s,t),showSizeChanger:!0},k=(s,t)=>{m(s),j(t)},F={selectedRowKeys:l,onChange:(s,t)=>{_(s)}},L=()=>{if(l.length===0){p.error("请选择需要删除的聊天记录");return}V({title:"操作确认",icon:e.jsx(D,{}),content:"确认删除选中的聊天记录？",centered:!0,okText:"确认",cancelText:"取消",onOk(){o||(i(!0),I({ids:l}).then(()=>{i(!1),p.success("成功"),v()}).catch(s=>{i(!1)}))},onCancel(){console.log("Cancel")}})};return e.jsxs("div",{className:"meedu-main-body",children:[e.jsx(U,{title:"聊天记录"}),e.jsx("div",{className:"float-left mb-30 mt-30",children:e.jsx(A,{type:"danger",text:"删除",class:"",icon:null,p:"addons.Zhibo.chat.delete",onClick:()=>L(),disabled:null})}),e.jsx("div",{className:"float-left",children:e.jsx(O,{rowSelection:{type:"checkbox",...F},loading:o,columns:E,dataSource:f,rowKey:s=>s.id,pagination:P})})]})};export{ie as default};
