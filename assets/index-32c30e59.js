import{r as s,j as e,u as ne,b as ie,t as oe,B as R,M as O,m as E,E as ce}from"./index-b4683d61.js";import{l as re,d as de}from"./question-10c27e70.js";import{P as x}from"./index-573a6ce5.js";import{Q as ue}from"./index-68c2beeb.js";import{c as pe}from"./close-a9a388f8.js";import{T as F}from"./Table-76e623b5.js";import{S}from"./index-c09cc6d7.js";import"./addEventListener-a27ae3f4.js";import"./useIcons-e0af7133.js";import"./CheckOutlined-e6bc730e.js";import"./Pagination-d2c763c6.js";import"./LeftOutlined-9e6e73a2.js";import"./useForceUpdate-f2aff5e0.js";import"./responsiveObserver-dc429d3b.js";import"./index-10f1a096.js";import"./iconUtil-f3f90360.js";const me=c=>{const[d,u]=s.useState(!1),[o,j]=s.useState([]);s.useEffect(()=>{if(c.results){u(!0);let i=[];for(let l in c.results){let n=c.results[l],m={id:l};Object.assign(m,n),i.push(m)}j(i),u(!1)}},[c.results]);const p=[{title:"试题ID",width:150,render:(i,l)=>e.jsx("span",{children:l.id})},{title:"关联试卷/模拟试卷/练习",render:(i,l)=>e.jsxs(e.Fragment,{children:[l.papers.length>0&&l.papers.map(n=>e.jsxs("p",{style:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:["试卷-",n.title]},n.id)),l.mock_papers.length>0&&l.mock_papers.map(n=>e.jsxs("p",{style:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:["模拟-",n.title]},n.id)),l.practices.length>0&&l.practices.map(n=>e.jsxs("p",{style:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:["练习-",n.name]},n.id))]})}];return e.jsx(e.Fragment,{children:c.open&&e.jsx("div",{className:"paper-dialog-mask",children:e.jsxs("div",{className:"paper-result-dialog-box",children:[e.jsxs("div",{className:"meedu-dialog-header",children:[e.jsx("span",{children:"成卷详情"}),e.jsx("img",{className:"icon-close",onClick:()=>{c.onCancel()},src:pe})]}),e.jsx("div",{className:"meedu-dialog-body",children:e.jsx("div",{className:"float-left",children:e.jsx(F,{loading:d,columns:p,dataSource:o,rowKey:i=>i.id,pagination:!1})})})]})})})},{confirm:he}=O,Le=()=>{const c=ne(),d=ie(),[u,o]=s.useState(!1),[j,p]=s.useState([]),[i,l]=s.useState(1),[n,m]=s.useState(20),[z,K]=s.useState(0),[f,y]=s.useState(!1),[w,b]=s.useState([]),[B,I]=s.useState([]),[C,k]=s.useState([]),[M,Q]=s.useState([]),[N,T]=s.useState([]),[A,V]=s.useState([]),[g,_]=s.useState([]),[$,G]=s.useState(0),[H,J]=s.useState(0),[U,v]=s.useState(!1),[W,P]=s.useState(!1),[X,q]=s.useState(null);s.useEffect(()=>{document.title="题库",c(oe("题库"))},[]),s.useEffect(()=>{Y()},[i,n,f]);const Y=()=>{u||(o(!0),re({page:i,size:n,category_id:w,type:C,level:N}).then(t=>{p(t.data.data.data),K(t.data.data.total);let a=[];t.data.categories.length>0&&t.data.categories.map(r=>{a.push({label:r.name,value:r.id})}),I(a);let h=[];t.data.types.length>0&&t.data.types.map(r=>{h.push({label:r.name,value:r.id})}),Q(h);let D=[];t.data.levels.length>0&&t.data.levels.map(r=>{D.push({label:r.name,value:r.id})}),V(D),o(!1)}).catch(t=>{o(!1)}))},Z=()=>{l(1),m(20),p([]),k([]),b([]),T([]),y(!f)},L=()=>{p([]),_([]),y(!f)},ee=[{title:"分类",width:200,render:(t,a)=>{var h;return e.jsx("span",{children:((h=a==null?void 0:a.category)==null?void 0:h.name)||"-"})}},{title:"类型",width:200,render:(t,a)=>e.jsx("span",{children:a.type_text})},{title:"难度",width:200,render:(t,a)=>e.jsx("span",{children:a.level_text})},{title:"内容",render:(t,a)=>e.jsx(ue,{question:a})},{title:"操作",width:120,fixed:"right",render:(t,a)=>e.jsx(x,{type:"link",text:"编辑",class:"c-primary",icon:null,p:"addons.Paper.question.update",onClick:()=>{d("/exam/question/update?id="+a.id)},disabled:null})}],te={current:i,pageSize:n,total:z,onChange:(t,a)=>se(t,a),showSizeChanger:!0},se=(t,a)=>{l(t),m(a)},ae={selectedRowKeys:g,onChange:(t,a)=>{_(t)}},le=()=>{if(g.length===0){E.error("请选择需要操作的数据");return}he({title:"操作确认",icon:e.jsx(ce,{}),content:"确认删除选中试题？",centered:!0,okText:"确认删除",cancelText:"取消",onOk(){u||(o(!0),de({ids:g}).then(t=>{t.data.failure.total>0?(G(t.data.success.total),J(t.data.failure.total),o(!1),q(t.data.failure.data),v(!0),L()):(o(!1),q(null),E.success("成功"),L())}).catch(t=>{o(!1)}))},onCancel(){console.log("Cancel")}})};return e.jsxs("div",{className:"meedu-main-body",children:[e.jsxs("div",{className:"float-left j-b-flex mb-30",children:[e.jsxs("div",{className:"d-flex",children:[e.jsx(x,{type:"primary",text:"新建试题",class:"",icon:null,p:"addons.Paper.question.store",onClick:()=>d("/exam/question/create"),disabled:null}),e.jsx(x,{type:"primary",text:"试题分类",class:"ml-10",icon:null,p:"addons.Paper.question_category.list",onClick:()=>d("/exam/question/category/index"),disabled:null}),e.jsx(x,{type:"primary",text:"试题批量导入",class:"ml-10",icon:null,p:"addons.Paper.question.import.csv",onClick:()=>d("/exam/question/import"),disabled:null}),e.jsx(x,{type:"danger",text:"批量删除",class:"ml-10",icon:null,p:"addons.Paper.question.delete",onClick:()=>le(),disabled:null})]}),e.jsxs("div",{className:"d-flex",children:[e.jsx(S,{style:{width:150},value:w,onChange:t=>{b(t)},allowClear:!0,placeholder:"分类",options:B}),e.jsx(S,{style:{width:150,marginLeft:10},value:C,onChange:t=>{k(t)},allowClear:!0,placeholder:"类型",options:M}),e.jsx(S,{style:{width:150,marginLeft:10},value:N,onChange:t=>{T(t)},allowClear:!0,placeholder:"难度",options:A}),e.jsx(R,{className:"ml-10",onClick:Z,children:"清空"}),e.jsx(R,{className:"ml-10",type:"primary",onClick:()=>{l(1),y(!f)},children:"筛选"})]})]}),e.jsxs("div",{className:"float-left mb-30 check-num",children:["已选择",g.length,"项"]}),e.jsx("div",{className:"float-left",children:e.jsx(F,{rowSelection:{type:"checkbox",...ae},loading:u,columns:ee,dataSource:j,rowKey:t=>t.id,pagination:te})}),U?e.jsxs(O,{title:"",onCancel:()=>{v(!1)},cancelText:"取消",okText:"成卷详情",open:!0,width:500,maskClosable:!1,onOk:()=>{v(!1),P(!0)},centered:!0,children:[e.jsxs("div",{className:"pt-20 pb-10 text-center",children:[e.jsxs("span",{children:[$,"道试题删除成功，"]}),e.jsxs("span",{className:"c-red",children:[H,"道试题删除失败(已成卷) "]})]}),e.jsx("div",{className:"pb-10 text-center",children:e.jsx("span",{children:"已成卷试题请先在关联试卷/模拟试卷/练习中删除该试题！"})})]}):null,e.jsx(me,{open:W,onCancel:()=>P(!1),results:X})]})};export{Le as default};
