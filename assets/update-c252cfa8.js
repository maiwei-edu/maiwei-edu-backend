import{f as K,u as M,b as O,r as a,t as Q,j as e,g as W,I as m,S as n,B as y,m as I}from"./index-3fd54424.js";import{h as X,f as Y,u as Z}from"./paper-57a0cabd.js";import{B as $}from"./index-c3c15456.js";import{H as c}from"./index-d5d1e443.js";import{F as i}from"./index-0ca68444.js";import{S as N}from"./index-ff4e3b6e.js";import{S as x}from"./index-27712364.js";import"./LeftOutlined-a0f8cfa6.js";import"./InfoCircleOutlined-fefc69ce.js";import"./row-98a37fbf.js";import"./responsiveObserver-a0dea2e5.js";import"./useIcons-235bc0cd.js";import"./CheckOutlined-44e74bd9.js";const ue=()=>{const _=new URLSearchParams(K().search),q=M(),g=O(),[r]=i.useForm(),[k,C]=a.useState(!0),[v,j]=a.useState(!1),[w,h]=a.useState(0),[F,f]=a.useState(0),[S,b]=a.useState(0),[V,P]=a.useState([]),[B,E]=a.useState([]),[u,D]=a.useState(Number(_.get("id")));a.useEffect(()=>{document.title="编辑试卷",q(Q("编辑试卷")),L()},[u]),a.useEffect(()=>{D(Number(_.get("id")))},[_.get("id")]);const L=async()=>{await H(),await R(),C(!1)},R=async()=>{if(u===0)return;var t=(await X(u)).data.data;if(r.setFieldsValue({category_id:t.category_id,title:t.title,enabled_invite:t.enabled_invite,is_vip_free:t.is_vip_free,charge:t.charge,expired_minutes:t.expired_minutes,pass_score:t.pass_score,is_skip_mark:t.is_skip_mark,is_random:t.is_random,try_times:t.try_times}),f(t.charge),b(t.enabled_invite),t.charge===0?(h(1),r.setFieldsValue({is_free:1})):(h(0),r.setFieldsValue({is_free:0})),t.required_courses!==null){let d=t.required_courses.length===0?[]:t.required_courses.split(",");const o=[];d.forEach(p=>{o.push(parseInt(p))}),r.setFieldsValue({required_courses:o})}},H=async()=>{const s=await Y();let t=s.data.categories;const d=[];for(let l=0;l<t.length;l++)d.push({label:t[l].name,value:t[l].id});P(d);let o=s.data.courses;const p=[];for(let l=0;l<o.length;l++)p.push({label:o[l].title,value:o[l].id});E(p)},U=s=>{if(v)return;if(s.enabled_invite===0&&s.is_free===0&&!s.charge){I.error("价格不能为空");return}if(s.enabled_invite===0&&s.is_free===0&&parseInt(s.charge)===0&&(s.required_courses&&s.required_courses.length===0||!s.required_courses)){I.error("设置价格大于0或者设置有购买录播课程");return}j(!0);const t=s.required_courses&&s.required_courses.join(",");Z(u,{rule:s.newRule,pass_score:s.pass_score,title:s.title,is_skip_mark:s.is_skip_mark,expired_minutes:s.expired_minutes,enabled_invite:s.enabled_invite,charge:F,is_free:w,required_courses:t,is_vip_free:s.is_vip_free||0,is_random:s.is_random||0,category_id:s.category_id,try_times:s.try_times}).then(d=>{j(!1),I.success("保存成功！"),g(-1)}).catch(d=>{j(!1)})},A=s=>{console.log("Failed:",s)},T=s=>{s?r.setFieldsValue({is_skip_mark:1}):r.setFieldsValue({is_skip_mark:0})},z=s=>{s?(r.setFieldsValue({is_invite:1}),b(1)):(r.setFieldsValue({is_invite:0}),b(0))},G=s=>{s?(r.setFieldsValue({is_free:1,charge:0}),f(0),h(1)):(r.setFieldsValue({is_free:0}),h(0))},J=s=>{s?r.setFieldsValue({is_vip_free:1}):r.setFieldsValue({is_vip_free:0})};return e.jsxs("div",{className:"meedu-main-body",children:[e.jsx($,{title:"编辑试卷"}),k&&e.jsx("div",{className:"float-left text-center mt-30",children:e.jsx(W,{})}),e.jsx("div",{style:{display:k?"none":"block"},className:"float-left mt-30",children:e.jsxs(i,{form:r,name:"paper-create",labelCol:{span:3},wrapperCol:{span:21},initialValues:{remember:!0},onFinish:U,onFinishFailed:A,autoComplete:"off",children:[e.jsx(i.Item,{label:"试卷名",name:"title",rules:[{required:!0,message:"请输入试卷名!"}],children:e.jsx(m,{style:{width:300},placeholder:"请输入试卷名",allowClear:!0})}),e.jsx(i.Item,{label:"分类",name:"category_id",rules:[{required:!0,message:"请选择分类!"}],children:e.jsxs(n,{align:"baseline",style:{height:32},children:[e.jsx(i.Item,{name:"category_id",rules:[{required:!0,message:"请选择分类!"}],children:e.jsx(N,{style:{width:300},allowClear:!0,placeholder:"请选择分类",options:V})}),e.jsx(y,{type:"link",className:"c-primary",onClick:()=>{g("/exam/paper/category/index")},children:"分类管理"})]})}),e.jsx(i.Item,{label:"及格分",name:"pass_score",rules:[{required:!0,message:"请输入及格分!"}],children:e.jsx(m,{type:"number",style:{width:300},placeholder:"请输入及格分",allowClear:!0})}),e.jsx(i.Item,{label:"时间",name:"expired_minutes",rules:[{required:!0,message:"请输入时间!"}],children:e.jsx(m,{type:"number",style:{width:300},placeholder:"单位：分钟",allowClear:!0})}),e.jsx(i.Item,{label:"考试次数",name:"try_times",rules:[{required:!0,message:"请输入考试次数!"}],children:e.jsxs(n,{align:"baseline",style:{height:32},children:[e.jsx(i.Item,{name:"try_times",rules:[{required:!0,message:"请输入考试次数!"}],children:e.jsx(m,{type:"number",style:{width:300},placeholder:"请输入整数",allowClear:!0})}),e.jsx("div",{className:"ml-10",children:e.jsx(c,{text:"可限制用户可考次数。填写0的话意味着不限制考试次数。"})})]})}),e.jsx(i.Item,{label:"跳过阅卷",name:"is_skip_mark",children:e.jsxs(n,{align:"baseline",style:{height:32},children:[e.jsx(i.Item,{name:"is_skip_mark",valuePropName:"checked",children:e.jsx(x,{onChange:T})}),e.jsx("div",{className:"ml-10",children:e.jsx(c,{text:"若试卷中包含问答题，将自动跳过问答题阅卷生成总成绩。"})})]})}),e.jsx(i.Item,{label:"仅添加学员",name:"enabled_invite",children:e.jsxs(n,{align:"baseline",style:{height:32},children:[e.jsx(i.Item,{name:"enabled_invite",valuePropName:"checked",children:e.jsx(x,{onChange:z})}),e.jsx("div",{className:"ml-10",children:e.jsx(c,{text:"只有在后台添加的用户才可以参与考试。该使用场景如：老师指定的一批学生科参与考试。"})})]})}),S===0&&e.jsxs(e.Fragment,{children:[e.jsx(i.Item,{label:"免费参与",name:"is_free",children:e.jsxs(n,{align:"baseline",style:{height:32},children:[e.jsx(i.Item,{name:"is_free",valuePropName:"checked",children:e.jsx(x,{onChange:G})}),e.jsx("div",{className:"ml-10",children:e.jsx(c,{text:"开启所有用户均可直接考试。"})})]})}),w===0&&e.jsxs(e.Fragment,{children:[e.jsx(i.Item,{label:"价格",name:"charge",rules:[{required:!0,message:"请输入价格!"}],children:e.jsxs(n,{align:"baseline",style:{height:32},children:[e.jsx(i.Item,{name:"charge",rules:[{required:!0,message:"请输入价格!"}],children:e.jsx(m,{onChange:s=>{f(Number(s.target.value))},type:"number",style:{width:300},placeholder:"单位：元",allowClear:!0})}),e.jsx("div",{className:"ml-10",children:e.jsx(c,{text:"请输入整数"})})]})}),F>0&&e.jsx(i.Item,{label:"VIP免费",name:"is_vip_free",children:e.jsxs(n,{align:"baseline",style:{height:32},children:[e.jsx(i.Item,{name:"is_vip_free",valuePropName:"checked",children:e.jsx(x,{onChange:J})}),e.jsx("div",{className:"ml-10",children:e.jsx(c,{text:"VIP会员可无需购买直接参与考试。"})})]})}),e.jsx(i.Item,{label:"购买录播课程",name:"required_courses",children:e.jsxs(n,{align:"baseline",style:{height:32},children:[e.jsx(i.Item,{name:"required_courses",children:e.jsx(N,{style:{width:300},allowClear:!0,mode:"multiple",placeholder:"请选择购买录播课程",options:B})}),e.jsx("div",{className:"ml-10",children:e.jsx(c,{text:"购买指定的录播课程可直接参与考试。"})})]})})]})]})]})}),e.jsx("div",{className:"bottom-menus",children:e.jsxs("div",{className:"bottom-menus-box",children:[e.jsx("div",{children:e.jsx(y,{loading:v,type:"primary",onClick:()=>r.submit(),children:"保存"})}),e.jsx("div",{className:"ml-24",children:e.jsx(y,{type:"default",onClick:()=>g(-1),children:"取消"})})]})})]})};export{ue as default};
