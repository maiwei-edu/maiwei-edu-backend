import{u as X,b as ee,r as i,t as se,j as e,S as n,I as f,B as w,M as te,h as le}from"./index-3fd54424.js";import{c as ae,s as ie,l as re}from"./live-9d1ed6d0.js";import{B as ne}from"./index-c3c15456.js";import{P as q}from"./index-df05a090.js";import{H as c}from"./index-d5d1e443.js";import{U as B}from"./index-edf85c8b.js";import{Q as oe}from"./index-019b594b.js";import{F as t}from"./index-0ca68444.js";import{T as ce}from"./index-47408a6e.js";import{S as _}from"./index-ff4e3b6e.js";import{R as T,C as x}from"./row-98a37fbf.js";import{S as C}from"./index-27712364.js";import{D as de}from"./index-a9db941d.js";import"./LeftOutlined-a0f8cfa6.js";import"./InfoCircleOutlined-fefc69ce.js";import"./InboxOutlined-35d156a9.js";import"./selected-7e6221ce.js";import"./Dragger-3ad849c3.js";import"./useForceUpdate-56773729.js";import"./DeleteOutlined-529a4ffa.js";import"./CheckOutlined-44e74bd9.js";import"./useIcons-235bc0cd.js";import"./Pagination-a2ebdf00.js";import"./responsiveObserver-a0dea2e5.js";import"./index-749454db.js";import"./PlusOutlined-18e71fec.js";const Ae=()=>{const[a]=t.useForm(),P=X(),d=ee(),[I,p]=i.useState(!1),[j,D]=i.useState("base"),[Y,A]=i.useState([]),[H,M]=i.useState([]),[E,R]=i.useState([]),[k,g]=i.useState(0),[L,h]=i.useState(!1),[F,Q]=i.useState(""),[b,N]=i.useState(""),U=[{key:"base",label:"基础信息"},{key:"dev",label:"可选信息"}];i.useEffect(()=>{document.title="新建直播课程",P(se("新建直播课程")),a.setFieldsValue({is_show:1,vip_can_view:0}),g(0),h(!1),Z()},[]);const Z=()=>{ae().then(s=>{let r=s.data.categories;const u=[];for(let l=0;l<r.length;l++)if(r[l].children.length>0){u.push({label:r[l].name,value:r[l].id});let m=r[l].children;for(let o=0;o<m.length;o++)m[o].name="|----"+m[o].name,u.push({label:m[o].name,value:m[o].id})}else u.push({label:r[l].name,value:r[l].id});A(u);let v=s.data.teachers.assistant;const S=[];for(let l=0;l<v.length;l++)S.push({label:v[l].name,value:v[l].id});R(S);let y=s.data.teachers.teacher;const V=[];for(let l=0;l<y.length;l++)V.push({label:y[l].name,value:y[l].id});M(V)})},$=s=>{D(s)},z=s=>{I||(s.charge==0&&(s.vip_can_view=0),s.render_desc=s.original_desc,s.published_at=le(new Date(s.published_at)).format("YYYY-MM-DD HH:mm"),p(!0),ie(s).then(r=>{p(!1),h(!0)}).catch(r=>{p(!1)}))},K=s=>{console.log("Failed:",s)},O=()=>{re({page:1,size:1,sort:"id",order:"desc"}).then(s=>{d("/live/course/video/index?id="+s.data.data.data[0].id+"&title="+s.data.data.data[0].title,{replace:!0})})},G=s=>{s?(a.setFieldsValue({charge:0,vip_can_view:0}),g(1)):g(0)},J=s=>{s?a.setFieldsValue({is_show:1}):a.setFieldsValue({is_show:0})},W=s=>{s?a.setFieldsValue({vip_can_view:1}):a.setFieldsValue({vip_can_view:0})};return e.jsxs("div",{className:"meedu-main-body",children:[e.jsx(ne,{title:"新建直播课程"}),e.jsx("div",{className:"center-tabs mb-30",children:e.jsx(ce,{defaultActiveKey:j,items:U,onChange:$})}),e.jsx("div",{className:"float-left",children:e.jsxs(t,{form:a,name:"live-create",labelCol:{span:3},wrapperCol:{span:21},initialValues:{remember:!0},onFinish:z,onFinishFailed:K,autoComplete:"off",children:[e.jsxs("div",{style:{display:j==="base"?"block":"none"},children:[e.jsx(t.Item,{label:"所属分类",name:"category_id",rules:[{required:!0,message:"请选择所属分类!"}],children:e.jsxs(n,{align:"baseline",style:{height:32},children:[e.jsx(t.Item,{name:"category_id",rules:[{required:!0,message:"请选择所属分类!"}],children:e.jsx(_,{style:{width:300},allowClear:!0,placeholder:"请选择所属分类",options:Y})}),e.jsx("div",{children:e.jsx(q,{type:"link",text:"分类管理",class:"c-primary",icon:null,p:"addons.Zhibo.course_category.list",onClick:()=>{d("/live/course/category/index")},disabled:null})})]})}),e.jsx(t.Item,{label:"讲师",name:"teacher_id",rules:[{required:!0,message:"请选择讲师!"}],children:e.jsxs(n,{align:"baseline",style:{height:32},children:[e.jsx(t.Item,{name:"teacher_id",rules:[{required:!0,message:"请选择讲师!"}],children:e.jsx(_,{style:{width:300},allowClear:!0,placeholder:"请选择讲师",options:H})}),e.jsx("div",{children:e.jsx(q,{type:"link",text:"讲师管理",class:"c-primary",icon:null,p:"addons.Zhibo.teacher.list",onClick:()=>{d("/live/teacher/index")},disabled:null})})]})}),e.jsx(t.Item,{label:"助教",name:"assistant_id",children:e.jsxs(n,{align:"baseline",style:{height:32},children:[e.jsx(t.Item,{name:"assistant_id",children:e.jsx(_,{style:{width:300},allowClear:!0,placeholder:"请选择助教",options:E})}),e.jsx("div",{className:"ml-10",children:e.jsx(c,{text:"可选择助教辅助讲师直播"})})]})}),e.jsx(t.Item,{label:"课程名",name:"title",rules:[{required:!0,message:"请输入课程名!"}],children:e.jsx(f,{style:{width:300},placeholder:"请输入课程名",allowClear:!0})}),e.jsx(t.Item,{label:"课程封面",name:"thumb",rules:[{required:!0,message:"请上传课程封面!"}],children:e.jsxs(n,{align:"baseline",style:{height:32},children:[e.jsx(t.Item,{name:"thumb",rules:[{required:!0,message:"请上传课程封面!"}],children:e.jsx(B,{text:"选择图片",onSelected:s=>{a.setFieldsValue({thumb:s}),Q(s)}})}),e.jsx("div",{className:"ml-10",children:e.jsx(c,{text:"推荐尺寸400x300 宽高比4:3"})})]})}),F&&e.jsxs(T,{style:{marginBottom:22},children:[e.jsx(x,{span:3}),e.jsx(x,{span:21,children:e.jsx("div",{className:"normal-thumb-box",style:{backgroundImage:`url(${F})`,width:200,height:150}})})]}),e.jsx(t.Item,{label:"免费",children:e.jsx(C,{onChange:G})}),e.jsx("div",{style:{display:k===0?"block":"none"},children:e.jsx(t.Item,{label:"价格",name:"charge",rules:[{required:!0,message:"请输入价格!"}],children:e.jsxs(n,{align:"baseline",style:{height:32},children:[e.jsx(t.Item,{name:"charge",rules:[{required:!0,message:"请输入价格!"}],children:e.jsx(f,{style:{width:300},placeholder:"请输入价格",allowClear:!0,type:"number"})}),e.jsx("div",{className:"ml-10",children:e.jsx(c,{text:"最小单位“元”，不支持小数"})})]})})}),e.jsx(t.Item,{label:"上架时间",name:"published_at",rules:[{required:!0,message:"请选择上架时间!"}],children:e.jsx(de,{format:"YYYY-MM-DD HH:mm",style:{width:300},showTime:!0,placeholder:"请选择上架时间"})}),e.jsx(t.Item,{label:"显示",name:"is_show",children:e.jsxs(n,{align:"baseline",style:{height:32},children:[e.jsx(t.Item,{name:"is_show",valuePropName:"checked",children:e.jsx(C,{onChange:J})}),e.jsx("div",{className:"ml-10",children:e.jsx(c,{text:"关闭后此直播课在前台隐藏显示"})})]})}),e.jsx("div",{style:{display:k===0?"block":"none"},children:e.jsx(t.Item,{label:"会员免费",name:"vip_can_view",children:e.jsxs(n,{align:"baseline",style:{height:32},children:[e.jsx(t.Item,{name:"vip_can_view",valuePropName:"checked",children:e.jsx(C,{onChange:W})}),e.jsx("div",{className:"ml-10",children:e.jsx(c,{text:"如果启用会员免费那么购买VIP会员的学员将可以无需购买直接观看直播。"})})]})})}),e.jsx(t.Item,{label:"简短介绍",name:"short_description",rules:[{required:!0,message:"请输入简短介绍!"}],children:e.jsx(f.TextArea,{style:{width:800},placeholder:"请输入简短介绍",allowClear:!0,rows:4,maxLength:150,showCount:!0})}),e.jsx(t.Item,{label:"详细介绍",name:"original_desc",rules:[{required:!0,message:"请输入详细介绍!"}],style:{height:440},children:e.jsx("div",{className:"w-800px",children:e.jsx(oe,{mode:"",height:400,defautValue:"",isFormula:!1,setContent:s=>{a.setFieldsValue({original_desc:s})}})})})]}),e.jsxs("div",{style:{display:j==="dev"?"block":"none"},children:[e.jsx(t.Item,{label:"播放封面",name:"poster",children:e.jsxs(n,{align:"baseline",style:{height:32},children:[e.jsx(B,{text:"上传播放封面",onSelected:s=>{a.setFieldsValue({poster:s}),N(s)}}),e.jsx("div",{className:"ml-10",children:b&&e.jsx(w,{onClick:()=>{a.setFieldsValue({poster:""}),N("")},children:"清空"})}),e.jsx("div",{className:"ml-10",children:e.jsx(c,{text:"播放封面是在进入直播时播放器显示的图片。推荐尺寸：1200x500"})})]})}),b&&e.jsxs(T,{style:{marginBottom:22},children:[e.jsx(x,{span:3}),e.jsx(x,{span:21,children:e.jsx("div",{className:"normal-thumb-box",style:{backgroundImage:`url(${b})`,width:400,height:166.7}})})]})]})]})}),e.jsx("div",{className:"bottom-menus",children:e.jsxs("div",{className:"bottom-menus-box",children:[e.jsx("div",{children:e.jsx(w,{loading:I,type:"primary",onClick:()=>a.submit(),children:"保存"})}),e.jsx("div",{className:"ml-24",children:e.jsx(w,{type:"default",onClick:()=>d(-1),children:"取消"})})]})}),L?e.jsx(te,{title:"",centered:!0,onCancel:()=>{h(!1),d("/live/course/index",{replace:!0})},cancelText:"暂不排课",okText:"立即排课",open:!0,width:500,maskClosable:!1,onOk:()=>{h(!1),O()},children:e.jsx("div",{className:"text-center",style:{marginTop:30,marginBottom:30},children:e.jsx("span",{children:"新建直播课成功，请在课程中添加直播排课吧！"})})}):null]})};export{Ae as default};
