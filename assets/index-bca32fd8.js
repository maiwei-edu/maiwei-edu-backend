import{r as a,a as V,j as e,M as q,s as B,B as f,m,I as K,C as de,y as ue,E as A}from"./index-b4683d61.js";import{n as fe,b as me,l as xe}from"./InboxOutlined-1c6772bb.js";import{D as he}from"./index-44896e29.js";import{P as H}from"./index-573a6ce5.js";import{U as je}from"./index-2bfe938a.js";import{T as pe}from"./Table-76e623b5.js";import{E as ve}from"./useIcons-e0af7133.js";import{I}from"./index-84b79d4f.js";const ge="/assets/empty-62a7ed36.png",{confirm:$}=q,Ue=({open:i,onCancel:x,onSuccess:y})=>{const[r,l]=a.useState(!1),[h,u]=a.useState([]),[j,c]=a.useState(1),[p,n]=a.useState(7),[v,C]=a.useState(0),[d,N]=a.useState(!1),[E,T]=a.useState(""),[G,U]=a.useState(""),[Se,L]=a.useState([]),[_,z]=a.useState([]),[g,D]=a.useState(!1),[J,R]=a.useState(!1),[Q,M]=a.useState(!1),[W,P]=a.useState(!1),[F,w]=a.useState(!1),X=V(s=>s.loginUser.value.user),S=V(s=>s.systemConfig.value.video.default_service);a.useEffect(()=>{i&&Y()},[i,j,p,d]),a.useEffect(()=>{b()},[F]),a.useEffect(()=>{S===""?D(!0):S==="local"?R(!0):S==="tencent"?M(!0):S==="aliyun"?P(!0):(D(!1),R(!1),M(!1),P(!1))},[S]);const Y=()=>{r||(l(!0),fe({page:j,size:p,sort:"id",order:"desc",keywords:E}).then(s=>{u(s.data.data),C(s.data.total),l(!1)}).catch(s=>{l(!1)}))},b=()=>{c(1),n(7),u([]),L([]),z([]),T(""),U(""),N(!d)},Z=s=>typeof X.permissions[s]<"u",ee=[{title:"视频名称",render:(s,t)=>e.jsx("span",{children:t.title})},{title:"时长",width:90,render:(s,t)=>e.jsx(he,{duration:t.duration})},{title:"大小",width:100,render:(s,t)=>e.jsxs("span",{children:[ae(t.size),"MB"]})},{title:"上传时间",width:120,dataIndex:"created_at",render:s=>e.jsx("span",{children:ue(s)})},{title:"操作",width:100,fixed:"right",render:(s,t)=>t.storage_driver==="local"?e.jsx(H,{type:"link",text:"删除",class:"c-red",icon:null,p:"addons.LocalUpload.video.destroy",onClick:()=>{te(t.storage_file_id)},disabled:null}):e.jsx(H,{type:"link",text:"删除",class:"c-red",icon:null,p:"media.video.delete.multi",onClick:()=>{se(t.id)},disabled:null})}],O=()=>{c(1),u([]),N(!d)},se=s=>{$({title:"操作确认",icon:e.jsx(A,{}),content:"确认删除选中的视频？",centered:!0,okText:"确认",cancelText:"取消",onOk(){if(r)return;let t=[];t.push(s),l(!0),me({ids:t}).then(()=>{l(!1),m.success("成功"),O()}).catch(o=>{l(!1)})},onCancel(){console.log("Cancel")}})},te=s=>{$({title:"操作确认",icon:e.jsx(A,{}),content:"确认删除选中的视频？",centered:!0,okText:"确认",cancelText:"取消",onOk(){if(r)return;let t=[];t.push(s),l(!0),xe({ids:t}).then(()=>{l(!1),m.success("成功"),O()}).catch(o=>{l(!1)})},onCancel(){console.log("Cancel")}})},ae=s=>{var t=`${(s/1048576).toFixed(2)}`;const o=`${t}`,k=o.indexOf(".");return o.substr(k+1,2)=="00"?o.substring(0,k)+o.substr(k+3,2):t},ne={current:j,pageSize:p,total:v,onChange:(s,t)=>le(s,t),showSizeChanger:!0},le=(s,t)=>{c(s),n(t)},ie={onChange:(s,t)=>{L(s);let o=t[0];o&&z(o)}},oe=()=>{if(g){m.warning("请先在系统配置的视频存储中完成参数配置");return}if(_.length===0){m.error("请选择需要操作的视频");return}y(_)},re=()=>{w(!1)},ce=()=>e.jsx(ve,{image:ge,description:""});return e.jsxs(e.Fragment,{children:[i?e.jsxs(q,{title:"",centered:!0,forceRender:!0,open:!0,width:800,onCancel:()=>{x()},maskClosable:!1,closable:!1,onOk:()=>oe(),children:[e.jsx("div",{className:B.header,children:"视频列表"}),e.jsxs("div",{className:B.body,children:[g&&e.jsx("div",{className:"float-left",children:"未配置视频存储服务，请前往『系统』-『系统配置』-『视频存储』配置。"}),e.jsxs("div",{className:"float-left",children:[J&&Z("addons.LocalUpload.video.index")&&e.jsx(e.Fragment,{children:e.jsxs("div",{className:"float-left j-b-flex mb-15",children:[e.jsx("div",{className:"d-flex",children:e.jsx(f,{type:"primary",onClick:()=>{if(g){m.warning("请先在系统配置的视频存储中完成参数配置");return}w(!0)},children:"上传视频"})}),e.jsxs("div",{className:"d-flex",children:[e.jsx(K,{value:G,style:{width:150},onChange:s=>{U(s.target.value)},allowClear:!0,placeholder:"视频名称关键词"}),e.jsx(f,{className:"ml-10",onClick:b,children:"清空"}),e.jsx(f,{className:"ml-10",type:"primary",onClick:()=>{c(1),N(!d)},children:"筛选"})]})]})}),(W||Q)&&e.jsx(e.Fragment,{children:e.jsxs("div",{className:"float-left j-b-flex mb-15",children:[e.jsx("div",{className:"d-flex",children:e.jsx(f,{type:"primary",onClick:()=>{if(g){m.warning("请先在系统配置的视频存储中完成参数配置");return}w(!0)},children:"上传视频"})}),e.jsxs("div",{className:"d-flex",children:[e.jsx(K,{value:E,style:{width:150},onChange:s=>{T(s.target.value)},allowClear:!0,placeholder:"视频名称关键词"}),e.jsx(f,{className:"ml-10",onClick:b,children:"清空"}),e.jsx(f,{className:"ml-10",type:"primary",onClick:()=>{c(1),N(!d)},children:"筛选"})]})]})}),!g&&e.jsx("div",{className:"float-left",children:e.jsx(de,{renderEmpty:ce,children:e.jsx(pe,{rowSelection:{type:"radio",...ie},loading:r,columns:ee,dataSource:h,rowKey:s=>s.id,pagination:ne})})})]})]})]}):null,e.jsx(je,{open:F,onCancel:()=>w(!1),onSuccess:()=>{re()}})]})},Le=i=>{const[x,y]=a.useState(0),[r,l]=a.useState(0),[h,u]=a.useState(0);a.useEffect(()=>{if(i.value){let n=Number(i.value),v=Math.floor(n/3600),C=Math.floor((n-v*3600)/60),d=n-v*3600-C*60;y(v),l(C),u(d)}},[i.value]),a.useEffect(()=>{i.onChange(x*3600+r*60+h)},[x,r,h]);const j=n=>{n!==null&&y(n)},c=n=>{n!==null&&l(n)},p=n=>{n!==null&&u(n)};return e.jsxs("div",{className:"d-flex",children:[e.jsx("div",{children:e.jsx(I,{disabled:i.disabled,value:x,onChange:j,min:0})}),e.jsx("div",{className:"mx-10",children:e.jsx("div",{className:"helper-text",children:"时"})}),e.jsx("div",{children:e.jsx(I,{disabled:i.disabled,value:r,onChange:c,min:0,max:59})}),e.jsx("div",{className:"mx-10",children:e.jsx("div",{className:"helper-text",children:"分"})}),e.jsx("div",{children:e.jsx(I,{disabled:i.disabled,value:h,min:0,max:59,onChange:p})}),e.jsx("div",{className:"mx-10",children:e.jsx("div",{className:"helper-text",children:"秒"})})]})};export{Le as I,Ue as U};
