import{f as J,b as M,u as O,r as a,t as A,j as s,B as N,m as w}from"./index-3fd54424.js";import{w as H,x as Q}from"./paper-57a0cabd.js";import{B as R}from"./index-c3c15456.js";import{I as T}from"./index-0e80bad7.js";import{S as U}from"./index-ff4e3b6e.js";import"./LeftOutlined-a0f8cfa6.js";import"./addEventListener-1752243f.js";import"./useIcons-235bc0cd.js";import"./CheckOutlined-44e74bd9.js";const D="_title_1roag_8",V="_content_1roag_15",z="_option_1roag_21",F="_active_1roag_40",G="_header_1roag_50",K="_answer_1roag_56",W="_result_1roag_65",X="_remark_1roag_71",Y="_score_1roag_80",Z="_operator_1roag_87",$="_p_1roag_95",o={"question-item":"_question-item_1roag_1",title:D,content:V,option:z,"option-item":"_option-item_1roag_28","user-active":"_user-active_1roag_36",active:F,header:G,answer:K,result:W,remark:X,score:Y,operator:Z,p:$},le=()=>{const i=new URLSearchParams(J().search),x=M(),S=O(),[j,_]=a.useState(!1),[n,q]=a.useState({}),[d,y]=a.useState([]),[u,k]=a.useState([]),[m,v]=a.useState([]);a.useState(10);const[h,L]=a.useState(Number(i.get("id"))),[p,C]=a.useState(Number(i.get("user_paper_id")));a.useEffect(()=>{document.title="阅卷",S(A("阅卷")),B()},[h,p]),a.useEffect(()=>{L(Number(i.get("id"))),C(Number(i.get("user_paper_id")))},[i.get("id"),i.get("user_paper_id")]),a.useEffect(()=>{if(d.length===0){v([]);return}let t=[];for(let r=0;r<d.length;r++){let e=d[r];if(e.question!==null){if(e.question.type===4){t.push({id:e.id,score:e.question.score,header:null,content:e.question.content,remark:e.question.remark,answer:e.answer_content,thumbs:e.thumbs?JSON.parse(e.thumbs):[]});continue}if(e.question.type===6){let g=JSON.parse(e.question.content),b=e.answer_contents_rows;for(let c=0;c<g.questions.length;c++){let f=g.questions[c],l=typeof b[c]>"u"?null:b[c];f.type===4&&t.push({id:e.id+"-cap-"+c,score:f.score,header:g.header,content:f.content,remark:e.question.remark,answer:l?l.answer:"",thumbs:l&&l.thumbs!==""?JSON.parse(l.thumbs):[]})}continue}}}v(t)},[d]);const B=()=>{H(h,p,{id:h,user_paper_id:p}).then(t=>{q(t.data.userPaper),y(t.data.questions)})},E=t=>{var r=[];for(let e=0;e<=t;e++)r.push({value:e,label:e+"分"});return r},I=()=>{P()},P=()=>{if(!j){if(u.length===0){w.error("请打分后再提交");return}_(!0);var t={};for(let e=0;e<m.length;e++){var r=m[e];t[r.id]={score:u[r.id]}}Q({id:h,user_paper_id:p,data:t}).then(e=>{_(!1),w.success("保存成功！"),x(-1)}).catch(e=>{_(!1)})}};return s.jsxs("div",{className:"meedu-main-body",children:[s.jsx(R,{title:"阅卷"}),s.jsxs("div",{className:"float-left mt-30",children:[s.jsx("div",{className:"float-left",children:s.jsxs("div",{className:"h-panel-body",children:[s.jsx("div",{className:"float-box mb-10",children:s.jsxs("h2",{children:[n==null?void 0:n.status_text,n.status===2&&s.jsxs("span",{children:["- ",n==null?void 0:n.score,"分"]})]})}),s.jsx("div",{className:"float-box mb-10",children:m.length>0&&m.map(t=>s.jsx("div",{className:o["question-item"],children:s.jsxs("div",{className:o.content,children:[t.header&&s.jsx("div",{className:o.header,dangerouslySetInnerHTML:{__html:t.header}}),s.jsx("div",{className:"mb-10",dangerouslySetInnerHTML:{__html:t.content}}),s.jsxs("div",{className:o.answer,children:[s.jsxs("p",{className:o.p,children:["回答：",t.answer]}),t.thumbs&&t.thumbs.length>0&&t.thumbs.map((r,e)=>s.jsx(T,{width:70,height:70,src:r},e))]}),s.jsxs("div",{className:o.score,children:[s.jsx("p",{className:o.p,children:"请打分："}),s.jsx("div",{children:s.jsx(U,{style:{width:200},value:u[t.id],onChange:r=>{let e=[...u];e[t.id]=r,k(e)},allowClear:!0,placeholder:"请打分",options:E(t.score)})})]})]})},t.id))})]})}),s.jsx("div",{className:"bottom-menus",children:s.jsxs("div",{className:"bottom-menus-box",children:[s.jsx("div",{children:n.status===3&&s.jsx(N,{loading:j,type:"primary",onClick:()=>I(),children:"保存"})}),s.jsx("div",{className:"ml-24",children:s.jsx(N,{type:"default",onClick:()=>x(-1),children:"取消"})})]})})]})]})};export{le as default};
