import{f as L,u as H,b as R,r,t as U,j as e,g as A,S as c,B as p,I as b,m as g}from"./index-b4683d61.js";import{a as T,c as z,u as G}from"./practice-e65e37d7.js";import{B as J}from"./index-5f967da4.js";import{H as x}from"./index-133d6e1c.js";import{F as a}from"./index-d434f3eb.js";import{S as K}from"./index-c09cc6d7.js";import{S as y}from"./index-918ef875.js";import"./LeftOutlined-9e6e73a2.js";import"./InfoCircleOutlined-4d24221b.js";import"./row-4ee18533.js";import"./responsiveObserver-dc429d3b.js";import"./useIcons-e0af7133.js";import"./CheckOutlined-e6bc730e.js";const ie=()=>{const o=new URLSearchParams(L().search),v=H(),m=R(),[i]=a.useForm(),[f,N]=r.useState(!0),[j,d]=r.useState(!1),[I,S]=r.useState([]),[w,h]=r.useState(0),[F,u]=r.useState(0),[l,C]=r.useState(Number(o.get("id")));r.useEffect(()=>{document.title="编辑练习",v(U("编辑练习")),P()},[l]),r.useEffect(()=>{C(Number(o.get("id")))},[o.get("id")]);const P=async()=>{await k(),await V(),N(!1)},V=async()=>{if(l===0)return;var t=(await T(l)).data.data;i.setFieldsValue({category_id:t.category_id,name:t.name,is_free:t.is_free,is_vip_free:t.is_vip_free,charge:t.charge}),h(t.charge),u(t.is_free)},k=async()=>{let t=(await z()).data.categories;const _=[];for(let n=0;n<t.length;n++)_.push({label:t[n].name,value:t[n].id});S(_)},q=s=>{if(!j){if(s.is_free===1&&(s.charge=0),Number(s.charge)%1!==0){g.error("价格必须为整数型");return}if(s.is_free===0&&Number(s.charge)<=0){g.error("练习未设置免费时价格应该大于0");return}d(!0),G(l,s).then(t=>{d(!1),g.success("保存成功！"),m(-1)}).catch(t=>{d(!1)})}},B=s=>{console.log("Failed:",s)},E=s=>{s?i.setFieldsValue({is_vip_free:1}):i.setFieldsValue({is_vip_free:0})},D=s=>{s?(i.setFieldsValue({is_free:1,is_vip_free:0}),u(1),h(0)):(i.setFieldsValue({is_free:0}),u(0))};return e.jsxs("div",{className:"meedu-main-body",children:[e.jsx(J,{title:"编辑练习"}),f&&e.jsx("div",{className:"float-left text-center mt-30",children:e.jsx(A,{})}),e.jsxs("div",{style:{display:f?"none":"block"},className:"float-left mt-30",children:[e.jsxs(a,{form:i,name:"practice-update",labelCol:{span:3},wrapperCol:{span:21},initialValues:{remember:!0},onFinish:q,onFinishFailed:B,autoComplete:"off",children:[e.jsx(a.Item,{label:"分类",name:"category_id",rules:[{required:!0,message:"请选择分类!"}],children:e.jsxs(c,{align:"baseline",style:{height:32},children:[e.jsx(a.Item,{name:"category_id",rules:[{required:!0,message:"请选择分类!"}],children:e.jsx(K,{style:{width:300},allowClear:!0,placeholder:"请选择分类",options:I})}),e.jsx(p,{type:"link",className:"c-primary",onClick:()=>{m("/exam/paper/category/index")},children:"分类管理"})]})}),e.jsx(a.Item,{label:"练习名",name:"name",rules:[{required:!0,message:"请输入练习名!"}],children:e.jsx(b,{style:{width:300},placeholder:"请输入练习名",allowClear:!0})}),e.jsx(a.Item,{label:"免费",name:"is_free",children:e.jsxs(c,{align:"baseline",style:{height:32},children:[e.jsx(a.Item,{name:"is_free",valuePropName:"checked",children:e.jsx(y,{onChange:D})}),e.jsx("div",{className:"ml-10",children:e.jsx(x,{text:"开启免费的话所有用户都可直接参与练习。"})})]})}),F===0&&e.jsx(a.Item,{label:"价格",name:"charge",rules:[{required:!0,message:"请输入价格!"}],children:e.jsxs(c,{align:"baseline",style:{height:32},children:[e.jsx(a.Item,{name:"charge",rules:[{required:!0,message:"请输入价格!"}],children:e.jsx(b,{type:"number",style:{width:300},placeholder:"单位：元",allowClear:!0,onChange:s=>{h(Number(s.target.value))}})}),e.jsx("div",{className:"ml-10",children:e.jsx(x,{text:"请输入整数"})})]})}),w>0&&e.jsx(a.Item,{label:"VIP免费",name:"is_vip_free",children:e.jsxs(c,{align:"baseline",style:{height:32},children:[e.jsx(a.Item,{name:"is_vip_free",valuePropName:"checked",children:e.jsx(y,{onChange:E})}),e.jsx("div",{className:"ml-10",children:e.jsx(x,{text:"开启VIP会员免费的话，VIP用户将直接参与练习。"})})]})})]}),e.jsx("div",{className:"bottom-menus",children:e.jsxs("div",{className:"bottom-menus-box",children:[e.jsx("div",{children:e.jsx(p,{loading:j,type:"primary",onClick:()=>i.submit(),children:"保存"})}),e.jsx("div",{className:"ml-24",children:e.jsx(p,{type:"default",onClick:()=>m(-1),children:"取消"})})]})})]})]})};export{ie as default};
