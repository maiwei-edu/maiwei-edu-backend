import{f as oe,u as de,b as he,r as l,t as me,j as e,g as ue,S as n,I,B as C,h as xe,m as pe}from"./index-3fd54424.js";import{a as ge,c as je,u as be}from"./live-9d1ed6d0.js";import{B as ve}from"./index-c3c15456.js";import{P}from"./index-df05a090.js";import{H as o}from"./index-d5d1e443.js";import{U as B}from"./index-edf85c8b.js";import{Q as _e}from"./index-019b594b.js";import{d as ye,D as fe}from"./index-a9db941d.js";import{F as a}from"./index-0ca68444.js";import{T as we}from"./index-47408a6e.js";import{S}from"./index-ff4e3b6e.js";import{R as H,C as g}from"./row-98a37fbf.js";import{S as k}from"./index-27712364.js";import"./LeftOutlined-a0f8cfa6.js";import"./InfoCircleOutlined-fefc69ce.js";import"./InboxOutlined-35d156a9.js";import"./selected-7e6221ce.js";import"./Dragger-3ad849c3.js";import"./useForceUpdate-56773729.js";import"./DeleteOutlined-529a4ffa.js";import"./CheckOutlined-44e74bd9.js";import"./useIcons-235bc0cd.js";import"./Pagination-a2ebdf00.js";import"./responsiveObserver-a0dea2e5.js";import"./index-749454db.js";import"./PlusOutlined-18e71fec.js";const Ge=()=>{const j=new URLSearchParams(oe().search),[r]=a.useForm(),T=de(),h=he(),[N,A]=l.useState(!0),[F,b]=l.useState(!1),[v,M]=l.useState("base"),[E,L]=l.useState([]),[R,U]=l.useState([]),[O,Q]=l.useState([]),[m,u]=l.useState(0),[V,D]=l.useState(""),[_,y]=l.useState(""),[Z,$]=l.useState(""),[K,z]=l.useState(0),[G,J]=l.useState(0),[x,W]=l.useState(Number(j.get("id"))),X=[{key:"base",label:"基础信息"},{key:"dev",label:"可选信息"}];l.useEffect(()=>{document.title="编辑直播课程",T(me("编辑直播课程")),ee()},[x]),l.useEffect(()=>{W(Number(j.get("id")))},[j.get("id")]);const ee=async()=>{await te(),await se(),A(!1)},se=async()=>{if(x===0)return;var t=(await ge(x)).data;r.setFieldsValue({category_id:t.category_id,title:t.title,thumb:t.thumb,is_show:t.is_show,assistant_id:t.assistant_id===0?[]:t.assistant_id,teacher_id:t.teacher_id,vip_can_view:t.vip_can_view,short_description:t.short_description,original_desc:t.original_desc,charge:t.charge,poster:t.poster,published_at:ye(t.published_at,"YYYY-MM-DD HH:mm")}),t.charge>0?u(0):u(1),z(t.charge),J(t.vip_can_view),$(t.original_desc),D(t.thumb),y(t.poster)},te=async()=>{const s=await je();let t=s.data.categories;const p=[];for(let i=0;i<t.length;i++)if(t[i].children.length>0){p.push({label:t[i].name,value:t[i].id});let d=t[i].children;for(let c=0;c<d.length;c++)d[c].name="|----"+d[c].name,p.push({label:d[c].name,value:d[c].id})}else p.push({label:t[i].name,value:t[i].id});L(p);let f=s.data.teachers.assistant;const q=[];for(let i=0;i<f.length;i++)q.push({label:f[i].name,value:f[i].id});Q(q);let w=s.data.teachers.teacher;const Y=[];for(let i=0;i<w.length;i++)Y.push({label:w[i].name,value:w[i].id});U(Y)},ae=s=>{M(s)},ie=s=>{F||(s.charge==0&&(s.vip_can_view=0),s.render_desc=s.original_desc,s.published_at=xe(new Date(s.published_at)).format("YYYY-MM-DD HH:mm"),b(!0),be(x,s).then(t=>{b(!1),pe.success("保存成功！"),h(-1)}).catch(t=>{b(!1)}))},le=s=>{console.log("Failed:",s)},re=s=>{s?(r.setFieldsValue({charge:0,vip_can_view:0}),u(1)):(r.setFieldsValue({charge:K,vip_can_view:G}),u(0))},ne=s=>{s?r.setFieldsValue({is_show:1}):r.setFieldsValue({is_show:0})},ce=s=>{s?r.setFieldsValue({vip_can_view:1}):r.setFieldsValue({vip_can_view:0})};return e.jsxs("div",{className:"meedu-main-body",children:[e.jsx(ve,{title:"编辑直播课程"}),e.jsx("div",{className:"center-tabs mb-30",children:e.jsx(we,{defaultActiveKey:v,items:X,onChange:ae})}),N&&e.jsx("div",{className:"float-left text-center",children:e.jsx(ue,{})}),e.jsx("div",{style:{display:N?"none":"block"},className:"float-left",children:e.jsxs(a,{form:r,name:"live-update",labelCol:{span:3},wrapperCol:{span:21},initialValues:{remember:!0},onFinish:ie,onFinishFailed:le,autoComplete:"off",children:[e.jsxs("div",{style:{display:v==="base"?"block":"none"},children:[e.jsx(a.Item,{label:"所属分类",name:"category_id",rules:[{required:!0,message:"请选择所属分类!"}],children:e.jsxs(n,{align:"baseline",style:{height:32},children:[e.jsx(a.Item,{name:"category_id",rules:[{required:!0,message:"请选择所属分类!"}],children:e.jsx(S,{style:{width:300},allowClear:!0,placeholder:"请选择所属分类",options:E})}),e.jsx("div",{children:e.jsx(P,{type:"link",text:"分类管理",class:"c-primary",icon:null,p:"addons.Zhibo.course_category.list",onClick:()=>{h("/live/course/category/index")},disabled:null})})]})}),e.jsx(a.Item,{label:"讲师",name:"teacher_id",rules:[{required:!0,message:"请选择讲师!"}],children:e.jsxs(n,{align:"baseline",style:{height:32},children:[e.jsx(a.Item,{name:"teacher_id",rules:[{required:!0,message:"请选择讲师!"}],children:e.jsx(S,{style:{width:300},allowClear:!0,placeholder:"请选择讲师",options:R})}),e.jsx("div",{children:e.jsx(P,{type:"link",text:"讲师管理",class:"c-primary",icon:null,p:"addons.Zhibo.teacher.list",onClick:()=>{h("/live/teacher/index")},disabled:null})})]})}),e.jsx(a.Item,{label:"助教",name:"assistant_id",children:e.jsxs(n,{align:"baseline",style:{height:32},children:[e.jsx(a.Item,{name:"assistant_id",children:e.jsx(S,{style:{width:300},allowClear:!0,placeholder:"请选择助教",options:O})}),e.jsx("div",{className:"ml-10",children:e.jsx(o,{text:"可选择助教辅助讲师直播"})})]})}),e.jsx(a.Item,{label:"课程名",name:"title",rules:[{required:!0,message:"请输入课程名!"}],children:e.jsx(I,{style:{width:300},placeholder:"请输入课程名",allowClear:!0})}),e.jsx(a.Item,{label:"课程封面",name:"thumb",rules:[{required:!0,message:"请上传课程封面!"}],children:e.jsxs(n,{align:"baseline",style:{height:32},children:[e.jsx(a.Item,{name:"thumb",rules:[{required:!0,message:"请上传课程封面!"}],children:e.jsx(B,{text:"选择图片",onSelected:s=>{r.setFieldsValue({thumb:s}),D(s)}})}),e.jsx("div",{className:"ml-10",children:e.jsx(o,{text:"推荐尺寸400x300 宽高比4:3"})})]})}),V&&e.jsxs(H,{style:{marginBottom:22},children:[e.jsx(g,{span:3}),e.jsx(g,{span:21,children:e.jsx("div",{className:"normal-thumb-box",style:{backgroundImage:`url(${V})`,width:200,height:150}})})]}),e.jsx(a.Item,{label:"免费",valuePropName:"checked",children:e.jsx(k,{defaultChecked:m===1,onChange:re})},m),e.jsx("div",{style:{display:m===0?"block":"none"},children:e.jsx(a.Item,{label:"价格",name:"charge",rules:[{required:!0,message:"请输入价格!"}],children:e.jsxs(n,{align:"baseline",style:{height:32},children:[e.jsx(a.Item,{name:"charge",rules:[{required:!0,message:"请输入价格!"}],children:e.jsx(I,{style:{width:300},placeholder:"请输入价格",allowClear:!0,type:"number"})}),e.jsx("div",{className:"ml-10",children:e.jsx(o,{text:"最小单位“元”，不支持小数"})})]})})}),e.jsx(a.Item,{label:"上架时间",name:"published_at",rules:[{required:!0,message:"请选择上架时间!"}],children:e.jsx(fe,{format:"YYYY-MM-DD HH:mm",style:{width:300},showTime:!0,placeholder:"请选择上架时间"})}),e.jsx(a.Item,{label:"显示",name:"is_show",children:e.jsxs(n,{align:"baseline",style:{height:32},children:[e.jsx(a.Item,{name:"is_show",valuePropName:"checked",children:e.jsx(k,{onChange:ne})}),e.jsx("div",{className:"ml-10",children:e.jsx(o,{text:"关闭后此直播课在前台隐藏显示"})})]})}),e.jsx("div",{style:{display:m===0?"block":"none"},children:e.jsx(a.Item,{label:"会员免费",name:"vip_can_view",children:e.jsxs(n,{align:"baseline",style:{height:32},children:[e.jsx(a.Item,{name:"vip_can_view",valuePropName:"checked",children:e.jsx(k,{onChange:ce})}),e.jsx("div",{className:"ml-10",children:e.jsx(o,{text:"如果启用会员免费那么购买VIP会员的学员将可以无需购买直接观看直播。"})})]})})}),e.jsx(a.Item,{label:"简短介绍",name:"short_description",rules:[{required:!0,message:"请输入简短介绍!"}],children:e.jsx(I.TextArea,{style:{width:800},placeholder:"请输入简短介绍",allowClear:!0,rows:4,maxLength:150,showCount:!0})}),e.jsx(a.Item,{label:"详细介绍",name:"original_desc",rules:[{required:!0,message:"请输入详细介绍!"}],style:{height:440},children:e.jsx("div",{className:"w-800px",children:e.jsx(_e,{mode:"",height:400,defautValue:Z,isFormula:!1,setContent:s=>{r.setFieldsValue({original_desc:s})}})})})]}),e.jsxs("div",{style:{display:v==="dev"?"block":"none"},children:[e.jsx(a.Item,{label:"播放封面",name:"poster",children:e.jsxs(n,{align:"baseline",style:{height:32},children:[e.jsx(B,{text:"上传播放封面",onSelected:s=>{r.setFieldsValue({poster:s}),y(s)}}),e.jsx("div",{className:"ml-10",children:_&&e.jsx(C,{onClick:()=>{r.setFieldsValue({poster:""}),y("")},children:"清空"})}),e.jsx("div",{className:"ml-10",children:e.jsx(o,{text:"播放封面是在进入直播时播放器显示的图片。推荐尺寸：1200x500"})})]})}),_&&e.jsxs(H,{style:{marginBottom:22},children:[e.jsx(g,{span:3}),e.jsx(g,{span:21,children:e.jsx("div",{className:"normal-thumb-box",style:{backgroundImage:`url(${_})`,width:400,height:166.7}})})]})]})]})}),e.jsx("div",{className:"bottom-menus",children:e.jsxs("div",{className:"bottom-menus-box",children:[e.jsx("div",{children:e.jsx(C,{loading:F,type:"primary",onClick:()=>r.submit(),children:"保存"})}),e.jsx("div",{className:"ml-24",children:e.jsx(C,{type:"default",onClick:()=>h(-1),children:"取消"})})]})})]})};export{Ge as default};
