import{b as re,r as t,j as e,B as Y,d as U,S as ne,m as F,h as H,E as de,M as ce,f as oe,u as ue,a as he,t as me}from"./index-b4683d61.js";import{B as xe}from"./index-5f967da4.js";import{i as V,j as X,k as pe,m as fe,n as Z}from"./paper-7f0d6524.js";import{D as je}from"./index-44896e29.js";import{P as W}from"./index-573a6ce5.js";import{u as q,w as G}from"./xlsx-b055c42d.js";import{S as ge}from"./index-c09cc6d7.js";import{T as J}from"./Table-76e623b5.js";import{T as B}from"./index-e058fb67.js";import{U as ve}from"./index-71ba7c09.js";import{D as _e}from"./index-cc7d88a3.js";import{T as Se}from"./index-d198db66.js";import"./LeftOutlined-9e6e73a2.js";import"./useIcons-e0af7133.js";import"./CheckOutlined-e6bc730e.js";import"./addEventListener-a27ae3f4.js";import"./Pagination-d2c763c6.js";import"./useForceUpdate-f2aff5e0.js";import"./responsiveObserver-dc429d3b.js";import"./index-10f1a096.js";import"./iconUtil-f3f90360.js";import"./member-43775307.js";import"./PlusOutlined-c97c4cac.js";const Ne=c=>{const f=re(),[i,x]=t.useState(!1),[S,g]=t.useState([]),[v,p]=t.useState(1),[N,j]=t.useState(10),[y,o]=t.useState(0),[b,k]=t.useState(!1),[D,P]=t.useState(-1),[E,M]=t.useState([]);t.useEffect(()=>{R()},[c.id,v,N,b]);const R=()=>{i||(x(!0),V(c.id,{page:v,size:N,sort:"id",order:"desc",user_id:null,created_at:null,submit_at:null,status:D}).then(a=>{g(a.data.data.data),o(a.data.data.total);let s=[{text:"全部",id:-1}];s.push(...a.data.statusMap);let h=[];s.map(m=>{h.push({label:m.text,value:m.id})}),M(h),x(!1)}).catch(a=>{x(!1)}))},u=()=>{p(1),j(10),g([]),P(-1),k(!b)},I={current:v,pageSize:N,total:y,onChange:(a,s)=>A(a,s),showSizeChanger:!0},A=(a,s)=>{p(a),j(s)},z=[{title:"ID",width:120,render:(a,s)=>e.jsx("span",{children:s.id})},{title:"学员ID",width:120,render:(a,s)=>e.jsx("span",{children:s.user_id})},{title:"学员",width:300,render:(a,s)=>e.jsxs(e.Fragment,{children:[s.user&&e.jsxs("div",{className:"user-item d-flex",children:[e.jsx("div",{className:"avatar",children:e.jsx("img",{src:s.user.avatar,width:"40",height:"40"})}),e.jsx("div",{className:"ml-10",children:s.user.nick_name})]}),!s.user&&e.jsx("span",{className:"c-red",children:"学员不存在"})]})},{title:"得分",width:150,render:(a,s)=>e.jsx(e.Fragment,{children:s.status===2&&e.jsxs("span",{children:[s.score,"分"]})})},{title:"用时",render:(a,s)=>e.jsx(e.Fragment,{children:s.status===2&&e.jsx(je,{duration:s.used_seconds})})},{title:"状态",width:150,render:(a,s)=>e.jsxs(e.Fragment,{children:[s.status===2&&e.jsx(B,{color:"success",children:"已结束"}),s.status===0&&e.jsx(B,{color:"default",children:"未开始"}),s.status===3&&e.jsx(B,{color:"warning",children:"阅卷中"}),s.status===1&&e.jsx(B,{color:"processing",children:"考试中"})]})},{title:"开始时间",width:200,dataIndex:"created_at",render:a=>e.jsx("span",{children:U(a)})},{title:"交卷时间",width:200,dataIndex:"submit_at",render:a=>e.jsx("span",{children:U(a)})},{title:"操作",width:100,fixed:"right",render:(a,s)=>e.jsxs(ne,{children:[s.status===3&&e.jsx(W,{type:"link",text:"阅卷",class:"c-primary",icon:null,p:"addons.Paper.paper.userPaper.submit",onClick:()=>{f("/exam/paper/marking?id="+c.id+"&user_paper_id="+s.id)},disabled:null}),e.jsx(W,{type:"link",text:"查看",class:"c-primary",icon:null,p:"addons.Paper.paper.userPaper.render",onClick:()=>{f("/exam/paper/paperShow?id="+s.paper_id+"&pid="+s.id)},disabled:null})]})}],n=a=>{let s=Math.floor(a/3600),h=Math.floor((a-s*3600)/60),m=a-s*3600-h*60;return s===0&&h===0&&m===0?null:(s===0?s="":s=s+":",h<10&&(h="0"+h),m<10&&(m="0"+m),s+h+":"+m)},d=()=>{if(i)return;x(!0);let a={page:1,size:y,sort:"id",order:"desc",user_id:null,created_at:null,submit_at:null,status:D};V(c.id,a).then(s=>{if(s.data.data.total===0){F.error("数据为空"),x(!1);return}let h="考试卷考试记录.xlsx",m="sheet1",T=[["学员ID","学员","手机号","得分","用时","状态","开始时间","交卷时间"]];s.data.data.data.forEach(_=>{T.push([_.user_id,_.user.nick_name,_.user.mobile,_.score+"分",n(_.used_seconds),_.status_text,_.created_at?H(_.created_at).format("YYYY-MM-DD HH:mm"):"",_.submit_at?H(_.submit_at).format("YYYY-MM-DD HH:mm"):""])});const C=q.json_to_sheet(T),K={SheetNames:[m],Sheets:{[m]:C}};G(K,h),x(!1)})};return e.jsxs("div",{className:"float-left",children:[e.jsxs("div",{className:"float-left j-b-flex mb-30",children:[e.jsx("div",{className:"d-flex",children:e.jsx(Y,{type:"primary",onClick:()=>d(),children:"导出表格"})}),e.jsxs("div",{className:"d-flex",children:[e.jsx(ge,{style:{width:150},value:D,onChange:a=>{P(a)},allowClear:!0,placeholder:"看完",options:E}),e.jsx(Y,{className:"ml-10",onClick:u,children:"清空"}),e.jsx(Y,{className:"ml-10",type:"primary",onClick:()=>{p(1),k(!b)},children:"筛选"})]})]}),e.jsx("div",{className:"float-left",children:e.jsx(J,{loading:i,columns:z,dataSource:S,rowKey:a=>a.id,pagination:I})})]})},{confirm:be}=ce,ke=c=>{const[f,i]=t.useState(!1),[x,S]=t.useState([]),[g,v]=t.useState(1),[p,N]=t.useState(10),[j,y]=t.useState(0),[o,b]=t.useState(!1),[k,D]=t.useState(!1);t.useEffect(()=>{P()},[c.id,g,p,k]);const P=()=>{f||(i(!0),X(c.id,{page:g,size:p}).then(n=>{S(n.data.data.data),y(n.data.data.total),i(!1)}).catch(n=>{i(!1)}))},E=n=>{n!==0&&be({title:"警告",icon:e.jsx(de,{}),content:"确认操作？",centered:!0,okText:"确认",cancelText:"取消",onOk(){f||(i(!0),fe(c.id,n).then(()=>{i(!1),F.success("成功"),M()}).catch(d=>{i(!1)}))},onCancel(){console.log("Cancel")}})},M=()=>{v(1),S([]),D(!k)},R={current:g,pageSize:p,total:j,onChange:(n,d)=>u(n,d),showSizeChanger:!0},u=(n,d)=>{v(n),N(d)},I=[{title:"学员ID",width:80,render:(n,d)=>e.jsx("span",{children:d.user_id})},{title:"手机号",width:150,render:(n,d)=>e.jsx(e.Fragment,{children:d.user&&e.jsx("span",{children:d.user.mobile})})},{title:"学员",render:(n,d)=>e.jsxs(e.Fragment,{children:[d.user&&e.jsxs("div",{className:"user-item d-flex",children:[e.jsx("div",{className:"avatar",children:e.jsx("img",{src:d.user.avatar,width:"40",height:"40"})}),e.jsx("div",{className:"ml-10",children:d.user.nick_name})]}),!d.user&&e.jsx("span",{className:"c-red",children:"学员不存在"})]})},{title:"操作",width:100,fixed:"right",render:(n,d)=>e.jsx(W,{type:"link",text:"删除",class:"c-red",icon:null,p:"addons.Paper.paper.users.delete",onClick:()=>{E(d.user_id)},disabled:null})}],A=()=>{if(f)return;i(!0);let n={page:1,size:j};X(c.id,n).then(d=>{if(d.data.data.total===0){F.error("数据为空"),i(!1);return}let a="考试卷订阅学员.xlsx",s="sheet1",h=[["学员ID","学员","手机号","时间"]];d.data.data.data.forEach(C=>{h.push([C.user_id,C.user.nick_name,C.user.mobile,H(C.created_at).format("YYYY-MM-DD HH:mm")])});const m=q.json_to_sheet(h),T={SheetNames:[s],Sheets:{[s]:m}};G(T,a),i(!1)})},z=n=>{f||(i(!0),pe(c.id,{id:c.id,mobiles:n}).then(()=>{i(!1),F.success("成功"),b(!1),M()}).catch(d=>{i(!1)}))};return e.jsxs("div",{className:"float-left",children:[e.jsxs("div",{className:"float-left  mb-30",children:[e.jsx(W,{type:"primary",text:"添加学员",class:"",icon:null,p:"addons.Paper.paper.users.add",onClick:()=>b(!0),disabled:null}),e.jsx(Y,{className:"ml-10",type:"primary",onClick:()=>A(),children:"导出表格"})]}),e.jsx("div",{className:"float-left",children:e.jsx(J,{loading:f,columns:I,dataSource:x,rowKey:n=>n.id,pagination:R})}),e.jsx(ve,{type:"mobile",open:o,onCancel:()=>b(!1),onSuccess:n=>{z(n)}})]})},{RangePicker:$}=_e,we=c=>{const[f,i]=t.useState(!1),[x,S]=t.useState([]),[g,v]=t.useState(1),[p,N]=t.useState(10),[j,y]=t.useState(0),[o,b]=t.useState(!1),[k,D]=t.useState({}),[P,E]=t.useState(0),[M,R]=t.useState(0),[u,I]=t.useState(),[A,z]=t.useState([]),[n,d]=t.useState([]),[a,s]=t.useState([]),[h,m]=t.useState([]);t.useEffect(()=>{T()},[c.id,g,p,o]);const T=()=>{f||(i(!0),Z(c.id,{page:g,size:p,created_at:A,submit_at:a}).then(r=>{S(r.data.data),y(r.data.total),D(r.data.users),I(r.data.stat),E(r.data.pass_score),R(r.data.total_score),i(!1)}).catch(r=>{i(!1)}))},C=()=>{v(1),N(10),S([]),m([]),s([]),d([]),z([]),b(!o)},K={current:g,pageSize:p,total:j,onChange:(r,l)=>_(r,l),showSizeChanger:!0},_=(r,l)=>{v(r),N(l)},ee=[{title:"学员ID",width:120,render:(r,l)=>e.jsx("span",{children:l.user_id})},{title:"学员",width:300,render:(r,l)=>e.jsxs(e.Fragment,{children:[k[l.user_id]&&e.jsxs("div",{className:"user-item d-flex",children:[e.jsx("div",{className:"avatar",children:e.jsx("img",{src:k[l.user_id].avatar,width:"40",height:"40"})}),e.jsx("div",{className:"ml-10",children:k[l.user_id].nick_name})]}),!k[l.user_id]&&e.jsx("span",{className:"c-red",children:"学员不存在"})]})},{title:"最高得分",render:(r,l)=>e.jsxs("span",{children:[l.score,"分"]})},{title:"及格",render:(r,l)=>e.jsx(e.Fragment,{children:l.score>=P?e.jsx("span",{children:"及格"}):e.jsx("span",{className:"c-red",children:"不及格"})})},{title:"开始时间",dataIndex:"created_at",render:r=>e.jsx("span",{children:U(r)})},{title:"交卷时间",dataIndex:"submit_at",render:r=>e.jsx("span",{children:U(r)})}],se=()=>{if(f)return;i(!0);let r={page:1,size:j,created_at:A,submit_at:a};Z(c.id,r).then(l=>{if(l.data.total===0){F.error("数据为空"),i(!1);return}let te="成绩导出|"+H().format("YYYY-MM-DD HH:mm:ss")+".xlsx",Q="默认",w=[["用户ID","用户名","账号","分数","及格","时间"]];l.data.data.forEach(L=>{let O=l.data.users[L.user_id];if(typeof O>"u")return;let ie=L.score>=l.data.pass_score?"是":"否";w.push([L.user_id,O.nick_name,O.mobile,L.score+"分",ie,L.created_at])}),w.push(["","",""]),w.push(["最低分",l.data.stat.min+"分"]),w.push(["最高分",l.data.stat.max+"分"]),w.push(["平均分",l.data.stat.average+"分"]),w.push(["总人数",l.data.total+"人"]),w.push(["及格分",l.data.pass_score+"分"]),w.push(["及格人数",l.data.stat.pass_count+"人"]),w.push(["及格率",l.data.stat.pass_rate+"%"]);const ae=q.json_to_sheet(w),le={SheetNames:[Q],Sheets:{[Q]:ae}};G(le,te),i(!1)})};return e.jsxs("div",{className:"float-left",children:[e.jsxs("div",{className:"float-left j-b-flex mb-30",children:[e.jsx("div",{className:"d-flex",children:e.jsx(Y,{type:"primary",onClick:()=>se(),children:"导出成绩"})}),e.jsxs("div",{className:"d-flex",children:[e.jsx($,{format:"YYYY-MM-DD",value:n,onChange:(r,l)=>{z(l),d(r)},placeholder:["考试时间-开始","考试时间-结束"]}),e.jsx($,{format:"YYYY-MM-DD",value:h,style:{marginLeft:10},onChange:(r,l)=>{s(l),m(r)},placeholder:["交卷时间-开始","交卷时间-结束"]}),e.jsx(Y,{className:"ml-10",onClick:C,children:"清空"}),e.jsx(Y,{className:"ml-10",type:"primary",onClick:()=>{v(1),b(!o)},children:"筛选"})]})]}),e.jsx("div",{className:"float-left mb-30",children:e.jsxs("div",{className:"d-flex stat-paper-box",children:[e.jsxs("div",{className:"flex-1 stat-item",children:[e.jsx("div",{className:"name",children:"总分"}),e.jsxs("div",{className:"value",children:[M,"分"]})]}),e.jsxs("div",{className:"flex-1 stat-item",children:[e.jsx("div",{className:"name",children:"及格分"}),e.jsxs("div",{className:"value",children:[P,"分"]})]}),e.jsxs("div",{className:"flex-1 stat-item",children:[e.jsx("div",{className:"name",children:"最低分"}),e.jsxs("div",{className:"value",children:[u==null?void 0:u.min,"分"]})]}),e.jsxs("div",{className:"flex-1 stat-item",children:[e.jsx("div",{className:"name",children:"最高分"}),e.jsxs("div",{className:"value",children:[u==null?void 0:u.max,"分"]})]}),e.jsxs("div",{className:"flex-1 stat-item",children:[e.jsx("div",{className:"name",children:"平均分"}),e.jsxs("div",{className:"value",children:[u==null?void 0:u.average,"分"]})]}),e.jsxs("div",{className:"flex-1 stat-item",children:[e.jsx("div",{className:"name",children:"及格率"}),e.jsxs("div",{className:"value",children:[u==null?void 0:u.pass_rate,"%"]})]}),e.jsxs("div",{className:"flex-1 stat-item",children:[e.jsx("div",{className:"name",children:"及格人数"}),e.jsxs("div",{className:"value",children:[u==null?void 0:u.pass_count,"人"]})]}),e.jsxs("div",{className:"flex-1 stat-item",children:[e.jsx("div",{className:"name",children:"总人数"}),e.jsxs("div",{className:"value",children:[j,"人"]})]})]})}),e.jsx("div",{className:"float-left",children:e.jsx(J,{loading:f,columns:ee,dataSource:x,rowKey:r=>r.id,pagination:K})})]})},Qe=()=>{const c=new URLSearchParams(oe().search),f=ue();t.useState(!1);const i=he(o=>o.loginUser.value.user),[x,S]=t.useState(""),[g,v]=t.useState([]),[p,N]=t.useState(Number(c.get("id")));t.useEffect(()=>{document.title="试卷学员",f(me("试卷学员"))},[]),t.useEffect(()=>{N(Number(c.get("id")))},[c.get("id")]),t.useEffect(()=>{let o=[];j("addons.Paper.paper.userPaper")&&o.push({label:"考试记录",key:"watch-records"}),j("addons.Paper.paper.statistics")&&o.push({label:"考试统计",key:"statistics"}),j("addons.Paper.paper.users")&&o.push({label:"付费学员",key:"sub-users"}),S(o[0].key),v(o)},[i]);const j=o=>{if(i.permissions)return typeof i.permissions[o]<"u"},y=o=>{S(o)};return e.jsxs("div",{className:"meedu-main-body",children:[e.jsx(xe,{title:"试卷学员"}),e.jsx("div",{className:"float-left mt-30",children:e.jsx(Se,{defaultActiveKey:x,items:g,onChange:y})}),e.jsxs("div",{className:"float-left",children:[x==="watch-records"&&e.jsx(Ne,{id:p}),x==="sub-users"&&e.jsx(ke,{id:p}),x==="statistics"&&e.jsx(we,{id:p})]})]})};export{Qe as default};
