import{f as L,u as q,b as H,r as a,t as O,c7 as h,j as e,S as n,I as T,E as A,c8 as K,B as g,M as U,h as W,m as Q}from"./index-b4683d61.js";import{n as z,a as G,o as J}from"./book-a8b4ca06.js";import{B as X}from"./index-5f967da4.js";import{P as Z}from"./index-573a6ce5.js";import{H as u}from"./index-133d6e1c.js";import{Q as $}from"./index-353c72a4.js";import{M as ee}from"./index-46e287f5.js";import{F as s}from"./index-d434f3eb.js";import{S as b}from"./index-c09cc6d7.js";import{D as te}from"./index-cc7d88a3.js";import{S as k}from"./index-918ef875.js";import"./LeftOutlined-9e6e73a2.js";import"./InfoCircleOutlined-4d24221b.js";import"./index-1a122d3f.js";import"./InboxOutlined-1c6772bb.js";import"./selected-177ec16c.js";import"./Dragger-1df363a5.js";import"./useForceUpdate-f2aff5e0.js";import"./DeleteOutlined-8e7e99fd.js";import"./CheckOutlined-e6bc730e.js";import"./row-4ee18533.js";import"./responsiveObserver-dc429d3b.js";import"./useIcons-e0af7133.js";import"./Pagination-d2c763c6.js";const{confirm:se}=U,Fe=()=>{const c=new URLSearchParams(L().search),[i]=s.useForm(),w=q(),d=H(),[x,m]=a.useState(!1),[C,y]=a.useState([]),[_,S]=a.useState(0),[N,p]=a.useState(""),[F,j]=a.useState(""),[v,E]=a.useState(""),[o,I]=a.useState(Number(c.get("book_id"))),D=[{label:"Markdown",value:"markdown"},{label:"富文本编辑器",value:"quill"}];a.useEffect(()=>{document.title="添加电子书文章",w(O("添加电子书文章")),i.setFieldsValue({book_cid:[],is_show:1,trySee:0}),o&&(V(),M())},[o]),a.useEffect(()=>{I(Number(c.get("book_id")))},[c.get("book_id")]),a.useEffect(()=>{let t=h();j(t==="markdown"?"MARKDOWN":"FULLEDITOR"),p(t||"quill")},[h()]);const V=()=>{z({}).then(t=>{let l=t.data.chapters[o];if(l){const f=[];for(let r=0;r<l.length;r++)f.push({label:l[r].name,value:l[r].id});y(f)}})},M=()=>{G(o).then(t=>{S(t.data.charge)})},B=t=>{x||(h()==="markdown"?(t.editor="MARKDOWN",t.render_content=v):(t.editor="FULLEDITOR",t.render_content=t.original_content),t.bid=o,t.published_at=W(new Date(t.published_at)).format("YYYY-MM-DD HH:mm"),m(!0),J(t).then(l=>{m(!1),Q.success("保存成功！"),d(-1)}).catch(l=>{m(!1)}))},P=t=>{console.log("Failed:",t)},R=t=>{t?i.setFieldsValue({is_show:1}):i.setFieldsValue({is_show:0})},Y=t=>{t?i.setFieldsValue({trySee:1}):i.setFieldsValue({trySee:0})};return e.jsxs("div",{className:"meedu-main-body",children:[e.jsx(X,{title:"添加电子书文章"}),e.jsx("div",{className:"float-left mt-30",children:e.jsxs(s,{form:i,name:"book-article-create",labelCol:{span:3},wrapperCol:{span:21},initialValues:{remember:!0},onFinish:B,onFinishFailed:P,autoComplete:"off",children:[e.jsx(s.Item,{name:"book_cid",label:"章节",children:e.jsxs(n,{align:"baseline",style:{height:32},children:[e.jsx(s.Item,{name:"book_cid",children:e.jsx(b,{style:{width:300},allowClear:!0,placeholder:"请选择章节",options:C})}),e.jsx("div",{children:e.jsx(Z,{type:"link",text:"章节管理",class:"c-primary",icon:null,p:"addons.meedu_books.book_chapter.list",onClick:()=>{d("/meedubook/chapter/index?bid="+o)},disabled:null})})]})}),e.jsx(s.Item,{label:"标题",name:"title",rules:[{required:!0,message:"请输入标题!"}],children:e.jsx(T,{style:{width:300},placeholder:"请输入标题",allowClear:!0})}),e.jsx(s.Item,{label:"上架时间",required:!0,children:e.jsxs(n,{align:"baseline",style:{height:32},children:[e.jsx(s.Item,{name:"published_at",rules:[{required:!0,message:"请选择上架时间!"}],children:e.jsx(te,{format:"YYYY-MM-DD HH:mm",style:{width:300},showTime:!0,placeholder:"请选择上架时间"})}),e.jsx("div",{className:"ml-10",children:e.jsx(u,{text:"上架时间越晚，排序越靠前"})})]})}),_>0&&e.jsx(s.Item,{label:"试看",name:"trySee",children:e.jsxs(n,{align:"baseline",style:{height:32},children:[e.jsx(s.Item,{name:"trySee",valuePropName:"checked",children:e.jsx(k,{onChange:Y})}),e.jsx("div",{className:"ml-10",children:e.jsx(u,{text:"开启试看的话未购买电子书学员可直接浏览该篇文章。"})})]})}),e.jsx(s.Item,{label:"显示文章",name:"is_show",children:e.jsxs(n,{align:"baseline",style:{height:32},children:[e.jsx(s.Item,{name:"is_show",valuePropName:"checked",children:e.jsx(k,{onChange:R})}),e.jsx("div",{className:"ml-10",children:e.jsx(u,{text:"关闭后电子书文章在前台隐藏显示"})})]})}),e.jsx(s.Item,{label:"文章内容",name:"original_content",rules:[{required:!0,message:"请输入文章内容!"}],style:{height:840},children:e.jsxs("div",{className:"flex flex-row",children:[e.jsx("div",{className:"w-800px",children:F==="MARKDOWN"?e.jsx(ee,{height:800,defautValue:"",setContent:(t,l)=>{i.setFieldsValue({original_content:t}),E(l)}}):e.jsx($,{mode:"",height:800,defautValue:"",isFormula:!1,setContent:t=>{i.setFieldsValue({original_content:t})}})}),e.jsx("div",{className:"ml-30",children:e.jsx(b,{value:N,style:{width:150},onChange:t=>{se({title:"警告",icon:e.jsx(A,{}),content:"切换编辑器将清空已编辑文章内容，是否切换？",centered:!0,okText:"确认",cancelText:"取消",onOk(){p(t),K(t)},onCancel(){console.log("Cancel")}})},placeholder:"请选择",options:D})})]})})]})}),e.jsx("div",{className:"bottom-menus",children:e.jsxs("div",{className:"bottom-menus-box",children:[e.jsx("div",{children:e.jsx(g,{loading:x,type:"primary",onClick:()=>i.submit(),children:"保存"})}),e.jsx("div",{className:"ml-24",children:e.jsx(g,{type:"default",onClick:()=>d(-1),children:"取消"})})]})})]})};export{Fe as default};
