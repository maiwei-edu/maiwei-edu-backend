import{u as q,f as G,r as a,t as J,j as t,I as Q,B as g,d as X,E as Z,m as w,h as $,M as ee}from"./index-b4683d61.js";import{C as D,D as te}from"./course-7dc1c12e.js";import{B as se}from"./index-5f967da4.js";import{P as ae}from"./index-573a6ce5.js";import{u as re,w as ie}from"./xlsx-b055c42d.js";import{T as oe}from"./Table-76e623b5.js";import{D as ce}from"./index-cc7d88a3.js";import"./LeftOutlined-9e6e73a2.js";import"./addEventListener-a27ae3f4.js";import"./useIcons-e0af7133.js";import"./CheckOutlined-e6bc730e.js";import"./Pagination-d2c763c6.js";import"./useForceUpdate-f2aff5e0.js";import"./responsiveObserver-dc429d3b.js";import"./index-c09cc6d7.js";import"./index-10f1a096.js";import"./iconUtil-f3f90360.js";const{confirm:ne}=ee,{RangePicker:de}=ce,De=()=>{const y=q(),i=new URLSearchParams(G().search),[d,r]=a.useState(!1),[P,h]=a.useState([]),[p,l]=a.useState(1),[f,j]=a.useState(10),[b,E]=a.useState(0),[u,_]=a.useState(!1),[o,I]=a.useState({}),[x,S]=a.useState(""),[m,v]=a.useState([]),[Y,k]=a.useState([]),[B,L]=a.useState(Number(i.get("course_id"))),[c,M]=a.useState(Number(i.get("video_id")));a.useEffect(()=>{document.title="课时销售记录",y(J("课时销售记录"))},[]),a.useEffect(()=>{L(Number(i.get("course_id"))),M(Number(i.get("video_id")))},[i.get("video_id"),i.get("course_id")]),a.useEffect(()=>{z()},[B,c,p,f,u]);const z=()=>{d||(r(!0),D(c,{page:p,size:f,video_id:c,user_id:x,subscribe_start_at:m[0],subscribe_end_at:m[1]}).then(e=>{h(e.data.data.data),E(e.data.data.total),I(e.data.users),r(!1)}).catch(e=>{r(!1)}))},T=()=>{l(1),j(10),h([]),S(""),k([]),v([]),_(!u)},A=()=>{l(1),h([]),_(!u)},F={current:p,pageSize:f,total:b,onChange:(e,s)=>R(e,s),showSizeChanger:!0},R=(e,s)=>{l(e),j(s)},U=[{title:"学员ID",width:120,render:(e,s)=>t.jsx("span",{children:s.user_id})},{title:"学员",render:(e,s)=>t.jsxs(t.Fragment,{children:[o[s.user_id]&&t.jsxs("div",{className:"user-item d-flex",children:[t.jsx("div",{className:"avatar",children:t.jsx("img",{src:o[s.user_id].avatar,width:"40",height:"40"})}),t.jsx("div",{className:"ml-10",children:o[s.user_id].nick_name})]}),!o[s.user_id]&&t.jsx("span",{className:"c-red",children:"学员不存在"})]})},{title:"价格",width:200,render:(e,s)=>t.jsx("span",{children:s.charge})},{title:"时间",width:200,dataIndex:"created_at",render:e=>t.jsx("span",{children:X(e)})},{title:"操作",width:100,fixed:"right",render:(e,s)=>t.jsx(ae,{type:"link",text:"删除",class:"c-red",icon:null,p:"video.subscribe.delete",onClick:()=>{W(s.user_id)},disabled:null})}],W=e=>{ne({title:"操作确认",icon:t.jsx(Z,{}),content:"确认删除选中的课时记录？",centered:!0,okText:"确认",cancelText:"取消",onOk(){d||(r(!0),te(c,{user_id:e}).then(()=>{r(!1),w.success("成功"),A()}).catch(s=>{r(!1)}))},onCancel(){console.log("Cancel")}})},H=()=>{if(d)return;r(!0);let e={page:1,size:b,video_id:c,user_id:x,subscribe_start_at:m[0],subscribe_end_at:m[1]};D(c,e).then(s=>{if(s.data.data.total===0){w.error("数据为空"),r(!1);return}let K="课时订阅学员.xlsx",C="sheet1",N=[["学员ID","学员","手机号","价格","时间"]];s.data.data.data.forEach(n=>{N.push([n.user_id,o[n.user_id].nick_name,o[n.user_id].mobile,n.charge===0?"-":"￥"+n.charge,$(n.created_at).format("YYYY-MM-DD HH:mm")])});const O=re.json_to_sheet(N),V={SheetNames:[C],Sheets:{[C]:O}};ie(V,K),r(!1)})};return t.jsxs("div",{className:"meedu-main-body",children:[t.jsx(se,{title:"课时销售记录"}),t.jsxs("div",{className:"float-left mt-30",children:[t.jsx(Q,{style:{width:150},value:x,onChange:e=>{S(e.target.value)},allowClear:!0,placeholder:"学员ID"}),t.jsx(de,{format:"YYYY-MM-DD",value:Y,style:{marginLeft:10},onChange:(e,s)=>{v(s),k(e)},placeholder:["订阅时间-开始","订阅时间-结束"]}),t.jsx(g,{className:"ml-10",onClick:T,children:"清空"}),t.jsx(g,{className:"ml-10",type:"primary",onClick:()=>{l(1),_(!u)},children:"筛选"}),t.jsx(g,{type:"primary",className:"ml-10",onClick:()=>H(),children:"导出表格"})]}),t.jsx("div",{className:"float-left mt-30",children:t.jsx(oe,{loading:d,columns:U,dataSource:P,rowKey:e=>e.id,pagination:F})})]})};export{De as default};
