import{f as Q,r as a,j as e,B as f,d as O,m as M,h as E,u as re,t as le,I as ne,E as ce,M as ie}from"./index-b4683d61.js";import{w as G,r as J,v as oe,x as de}from"./live-ef2dd82c.js";import{B as he}from"./index-5f967da4.js";import{P as ue}from"./index-573a6ce5.js";import{U as me}from"./index-288d6393.js";import{U as fe}from"./index-71ba7c09.js";import{D as pe}from"./index-44896e29.js";import{u as V,w as X}from"./xlsx-b055c42d.js";import{S as xe}from"./index-c09cc6d7.js";import{T as $}from"./Table-76e623b5.js";import{D as ge}from"./index-cc7d88a3.js";import{T as je}from"./index-d198db66.js";import"./LeftOutlined-9e6e73a2.js";import"./course-7dc1c12e.js";import"./certificate-285fae4b.js";import"./index-9c2b15e9.js";import"./Dragger-1df363a5.js";import"./useForceUpdate-f2aff5e0.js";import"./DeleteOutlined-8e7e99fd.js";import"./CheckOutlined-e6bc730e.js";import"./member-43775307.js";import"./useIcons-e0af7133.js";import"./addEventListener-a27ae3f4.js";import"./Pagination-d2c763c6.js";import"./responsiveObserver-dc429d3b.js";import"./index-10f1a096.js";import"./iconUtil-f3f90360.js";import"./PlusOutlined-c97c4cac.js";const{RangePicker:we}=ge,Se=()=>{const p=new URLSearchParams(Q().search),[N,c]=a.useState(!1),[n,P]=a.useState([]),[x,g]=a.useState(1),[u,_]=a.useState(10),[y,L]=a.useState(0),[k,j]=a.useState(!1),[h,v]=a.useState([]),[C,A]=a.useState([]),[D,R]=a.useState([]),[w,b]=a.useState(Number(p.get("id"))),Y=[{label:"未看完",value:0},{label:"已看完",value:1}];a.useEffect(()=>{b(Number(p.get("id")))},[p.get("id")]),a.useEffect(()=>{I()},[w,x,u,k]);const I=()=>{N||(c(!0),G(w,{page:x,size:u,is_watched:h.length===0?-1:h,watched_at:C}).then(s=>{P(s.data.data),L(s.data.total),c(!1)}).catch(s=>{c(!1)}))},z=()=>{g(1),_(10),P([]),v([]),R([]),A([]),j(!k)},m={current:x,pageSize:u,total:y,onChange:(s,t)=>T(s,t),showSizeChanger:!0},T=(s,t)=>{g(s),_(t)},B=[{title:"学员ID",width:120,render:(s,t)=>e.jsx("span",{children:t.user_id})},{title:"学员",render:(s,t)=>e.jsxs(e.Fragment,{children:[t.user&&e.jsxs("div",{className:"user-item d-flex",children:[e.jsx("div",{className:"avatar",children:e.jsx("img",{src:t.user.avatar,width:"40",height:"40"})}),e.jsx("div",{className:"ml-10",children:t.user.nick_name})]}),!t.user&&e.jsx("span",{className:"c-red",children:"学员不存在"})]})},{title:"观看进度",width:150,render:(s,t)=>e.jsxs("span",{children:[t.progress,"%"]})},{title:"学习总时长",width:150,render:(s,t)=>e.jsx(pe,{duration:t.total_duration})},{title:"看完",width:80,render:(s,t)=>e.jsxs(e.Fragment,{children:[t.is_watched===1&&e.jsx("span",{className:"c-green",children:"是"}),t.is_watched!==1&&e.jsx("span",{children:"否"})]})},{title:"开始时间",width:200,dataIndex:"created_at",render:s=>e.jsx("span",{children:O(s)})},{title:"看完时间",width:200,dataIndex:"watched_at",render:s=>e.jsx("span",{children:O(s)})}],F=s=>{let t=Math.floor(s/3600),o=Math.floor((s-t*3600)/60),d=s-t*3600-o*60;return t===0&&o===0&&d===0?null:(t===0?t="":t=t+":",o<10&&(o="0"+o),d<10&&(d="0"+d),t+o+":"+d)},H=()=>{if(N)return;c(!0);let s={page:1,size:y,is_watched:h.length===0?-1:h,watched_at:C};G(w,s).then(t=>{if(t.data.total===0){M.error("数据为空"),c(!1);return}let o="直播课程观看学员|"+E().format("YYYY-MM-DD HH:mm:ss")+".xlsx",d="sheet1",U=[["学员ID","学员","手机号","观看进度","学习总时长","看完","开始时间","看完时间"]];t.data.data.forEach(i=>{U.push([i.user_id,i.user.nick_name,i.user.mobile,i.progress+"%",F(i.total_duration),i.is_watched===1?"是":"否",i.created_at?E(i.created_at).format("YYYY-MM-DD HH:mm"):"",i.watched_at?E(i.watched_at).format("YYYY-MM-DD HH:mm"):""])});const W=V.json_to_sheet(U),K={SheetNames:[d],Sheets:{[d]:W}};X(K,o),c(!1)})};return e.jsxs("div",{className:"float-left",children:[e.jsxs("div",{className:"float-left j-b-flex mb-30",children:[e.jsx("div",{className:"d-flex"}),e.jsxs("div",{className:"d-flex",children:[e.jsx(xe,{style:{width:150},value:h,onChange:s=>{v(s)},allowClear:!0,placeholder:"看完",options:Y}),e.jsx(we,{format:"YYYY-MM-DD",value:D,style:{marginLeft:10},onChange:(s,t)=>{t[1]+=" 23:59:59",A(t),R(s)},placeholder:["看完时间-开始","看完时间-结束"]}),e.jsx(f,{className:"ml-10",onClick:z,children:"清空"}),e.jsx(f,{className:"ml-10",type:"primary",onClick:()=>{g(1),j(!k)},children:"筛选"}),e.jsx(f,{className:"ml-10",type:"primary",onClick:()=>H(),children:"导出表格"})]})]}),e.jsx("div",{className:"float-left",children:e.jsx($,{loading:N,columns:B,dataSource:n,rowKey:s=>s.id,pagination:m})})]})},{confirm:_e}=ie,Qe=()=>{const p=new URLSearchParams(Q().search),N=re(),[c,n]=a.useState(!1),[P,x]=a.useState([]),[g,u]=a.useState(1),[_,y]=a.useState(10),[L,k]=a.useState(0),[j,h]=a.useState(!1),[v,C]=a.useState(""),[A,D]=a.useState(!1),[R,w]=a.useState(!1),[b,Y]=a.useState([]),[I,z]=a.useState("watch-user"),[m,T]=a.useState(Number(p.get("id"))),B=[{label:"观看学员",key:"watch-user"},{label:"付费学员",key:"sub-user"}];a.useEffect(()=>{document.title="直播课程学员",N(le("直播课程学员"))},[]),a.useEffect(()=>{T(Number(p.get("id")))},[p.get("id")]),a.useEffect(()=>{F()},[m,g,_,j]);const F=()=>{c||(n(!0),J(m,{page:g,size:_,user_id:v}).then(r=>{x(r.data.data.data),k(r.data.data.total),n(!1)}).catch(r=>{n(!1)}))},H=()=>{u(1),y(10),x([]),C(""),Y([]),h(!j)},s=()=>{u(1),x([]),Y([]),h(!j)},t={current:g,pageSize:_,total:L,onChange:(r,l)=>o(r,l),showSizeChanger:!0},o=(r,l)=>{u(r),y(l)},d=[{title:"学员ID",width:120,render:(r,l)=>e.jsx("span",{children:l.user_id})},{title:"学员",render:(r,l)=>e.jsxs(e.Fragment,{children:[l.user&&e.jsxs("div",{className:"user-item d-flex",children:[e.jsx("div",{className:"avatar",children:e.jsx("img",{src:l.user.avatar,width:"40",height:"40"})}),e.jsx("div",{className:"ml-10",children:l.user.nick_name})]}),!l.user&&e.jsx("span",{className:"c-red",children:"学员不存在"})]})},{title:"价格",width:200,render:(r,l)=>e.jsxs(e.Fragment,{children:[l.charge===0&&e.jsx("span",{children:"-"}),l.charge!==0&&e.jsxs("span",{children:["￥",l.charge]})]})},{title:"时间",width:200,dataIndex:"created_at",render:r=>e.jsx("span",{children:O(r)})}],U=()=>{if(b.length===0){M.error("请选择需要操作的数据");return}_e({title:"操作确认",icon:e.jsx(ce,{}),content:"确认删除选中的学员？",centered:!0,okText:"确认",cancelText:"取消",onOk(){c||(n(!0),oe(m,{ids:b}).then(()=>{n(!1),M.success("成功"),s()}).catch(r=>{n(!1)}))},onCancel(){console.log("Cancel")}})},W=()=>{if(c)return;n(!0),J(m,{page:1,size:L,user_id:v}).then(l=>{if(l.data.data.total===0){M.error("数据为空"),n(!1);return}let te="直播课程订阅学员.xlsx",Z="sheet1",q=[["学员ID","学员","手机号","价格","时间"]];l.data.data.data.forEach(S=>{q.push([S.user_id,S.user.nick_name,S.user.mobile,S.charge===0?"-":"￥"+S.charge,S.created_at?E(S.created_at).format("YYYY-MM-DD HH:mm"):""])});const se=V.json_to_sheet(q),ae={SheetNames:[Z],Sheets:{[Z]:se}};X(ae,te),n(!1)})},K={selectedRowKeys:b,onChange:(r,l)=>{Y(r)}},i=r=>{c||(n(!0),de(m,{ids:r}).then(()=>{n(!1),M.success("成功"),D(!1),s()}).catch(l=>{n(!1)}))},ee=r=>{z(r)};return e.jsxs("div",{className:"meedu-main-body",children:[e.jsx(he,{title:"直播课程学员"}),e.jsx("div",{className:"float-left",children:e.jsx(je,{defaultActiveKey:I,items:B,onChange:ee})}),I==="watch-user"&&e.jsx(Se,{}),I==="sub-user"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"float-left j-b-flex mb-30",children:[e.jsxs("div",{className:"d-flex",children:[e.jsx(f,{type:"primary",onClick:()=>D(!0),children:"添加学员"}),e.jsx(ue,{type:"primary",text:"批量导入",class:"ml-10",icon:null,p:"addons.Zhibo.course.user.import",onClick:()=>w(!0),disabled:null}),e.jsx(f,{type:"primary",className:"ml-10",danger:!0,onClick:()=>U(),children:"删除学员"})]}),e.jsxs("div",{className:"d-flex",children:[e.jsx(ne,{value:v,onChange:r=>{C(r.target.value)},allowClear:!0,style:{width:150},placeholder:"学员ID"}),e.jsx(f,{className:"ml-10",onClick:H,children:"清空"}),e.jsx(f,{className:"ml-10",type:"primary",onClick:()=>{u(1),h(!j)},children:"筛选"}),e.jsx(f,{className:"ml-10",type:"primary",onClick:()=>W(),children:"导出表格"})]})]}),e.jsx("div",{className:"float-left",children:e.jsx($,{rowSelection:{type:"checkbox",...K},loading:c,columns:d,dataSource:P,rowKey:r=>r.id,pagination:t})})]}),e.jsx(me,{open:R,id:m,type:"live",name:"学员批量导入模板",onCancel:()=>w(!1),onSuccess:()=>{w(!1),s()}}),e.jsx(fe,{type:"",open:A,onCancel:()=>D(!1),onSuccess:r=>{i(r)}})]})};export{Qe as default};
