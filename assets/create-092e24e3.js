import{u as G,f as J,b as Q,r as a,t as X,j as e,B as j,I as d,S as n,m as N,h as Z}from"./index-b4683d61.js";import{N as $,a as ee,O as se}from"./course-7dc1c12e.js";import{e as te}from"./InboxOutlined-1c6772bb.js";import{B as le}from"./index-5f967da4.js";import{P as ae}from"./index-573a6ce5.js";import{H as c}from"./index-133d6e1c.js";import{I as v,U as ie}from"./index-bca32fd8.js";import{F as l}from"./index-d434f3eb.js";import{T as re}from"./index-d198db66.js";import{S as ne}from"./index-c09cc6d7.js";import{D as oe}from"./index-cc7d88a3.js";import{S as D}from"./index-918ef875.js";import"./LeftOutlined-9e6e73a2.js";import"./InfoCircleOutlined-4d24221b.js";import"./index-44896e29.js";import"./index-2bfe938a.js";import"./Dragger-1df363a5.js";import"./useForceUpdate-f2aff5e0.js";import"./DeleteOutlined-8e7e99fd.js";import"./CheckOutlined-e6bc730e.js";import"./row-4ee18533.js";import"./responsiveObserver-dc429d3b.js";import"./Table-76e623b5.js";import"./addEventListener-a27ae3f4.js";import"./useIcons-e0af7133.js";import"./Pagination-d2c763c6.js";import"./index-10f1a096.js";import"./iconUtil-f3f90360.js";import"./index-e058fb67.js";import"./index-84b79d4f.js";import"./PlusOutlined-c97c4cac.js";const Ae=()=>{const[t]=l.useForm(),k=G(),m=new URLSearchParams(J().search),u=Q(),[g,h]=a.useState(!1),[p,U]=a.useState("base"),[b,P]=a.useState([]),[Y,B]=a.useState(1),[H,y]=a.useState(0),[C,w]=a.useState(0),[F,S]=a.useState(0),[I,x]=a.useState(""),[f,L]=a.useState(""),[R,_]=a.useState(!1),[r,T]=a.useState(Number(m.get("course_id"))),A=[{key:"base",label:"基础信息"},{key:"dev",label:"可选信息"}];a.useEffect(()=>{document.title="新建课时",k(X("新建课时")),t.setFieldsValue({ban_drag:0,is_show:0}),E(),M()},[r]),a.useEffect(()=>{T(Number(m.get("course_id")))},[m.get("course_id")]);const E=()=>{$(r).then(s=>{let i=s.data.chapters;if(i.length>0){const V=[];for(let o=0;o<i.length;o++)V.push({label:i[o].title,value:i[o].id});P(V)}})},M=()=>{ee(r).then(s=>{let i=s.data;B(i.is_free),i.is_free===1?(y(0),w(0),t.setFieldsValue({free_seconds:0})):y(i.charge)})},q=s=>{if(!g){if(!s.url&&!s.aliyun_video_id&&!s.tencent_video_id){N.error("请上传课程视频");return}if(b.length>0&&!s.chapter_id){N.error("请选择所属章节");return}s.is_show===1?s.is_show=0:s.is_show=1,s.published_at=Z(new Date(s.published_at)).format("YYYY-MM-DD HH:mm"),s.charge=H,s.course_id=r,s.free_seconds=Number(C),s.duration=Number(F),h(!0),se(s).then(i=>{h(!1),u(-1)}).catch(i=>{h(!1)})}},W=s=>{console.log("Failed:",s)},K=s=>{U(s)},O=s=>{s?t.setFieldsValue({ban_drag:1}):t.setFieldsValue({ban_drag:0})},z=s=>{s?t.setFieldsValue({is_show:1}):t.setFieldsValue({is_show:0})};return e.jsxs("div",{className:"meedu-main-body",children:[e.jsx(le,{title:"新建课时"}),e.jsx("div",{className:"center-tabs mb-30",children:e.jsx(re,{defaultActiveKey:p,items:A,onChange:K})}),e.jsx("div",{className:"float-left",children:e.jsxs(l,{form:t,name:"course-video-create",labelCol:{span:3},wrapperCol:{span:21},initialValues:{remember:!0},onFinish:q,onFinishFailed:W,autoComplete:"off",children:[e.jsxs("div",{style:{display:p==="base"?"block":"none"},children:[e.jsx(l.Item,{label:"上传课时",children:e.jsxs(j,{type:"primary",onClick:()=>_(!0),children:[e.jsx("span",{children:"选择视频"}),I&&e.jsx("span",{className:"ml-10",children:I.replace(".m3u8","").replace(".mp4","")})]})}),e.jsx(l.Item,{label:"课时名称",name:"title",rules:[{required:!0,message:"请输入课时名称!"}],children:e.jsx(d,{style:{width:300},placeholder:"请输入课时名称",allowClear:!0,onChange:s=>{L(s.target.value)}})}),e.jsx(l.Item,{label:"课时时长",name:"duration",rules:[{required:!0,message:"请输入课时时长!"}],children:e.jsxs(n,{align:"baseline",style:{height:32},children:[e.jsx(v,{value:F,disabled:!1,onChange:s=>{S(s),t.setFieldsValue({duration:s})}}),e.jsx("div",{className:"ml-10",children:e.jsx(c,{text:"后台会根据课时时长统计学员学习进度"})})]})}),Y!==1&&e.jsx(l.Item,{label:"可试看时长",name:"free_seconds",children:e.jsxs(n,{align:"baseline",style:{height:32},children:[e.jsx(v,{value:C,disabled:!1,onChange:s=>{w(s),t.setFieldsValue({free_seconds:s})}}),e.jsx("div",{className:"ml-10",children:e.jsx(c,{text:"设置此课时免费试看时长（此配置对本地存储或URL视频无效）"})})]})}),e.jsx(l.Item,{label:"所属章节",name:"chapter_id",children:e.jsxs(n,{align:"baseline",style:{height:32},children:[e.jsx(l.Item,{name:"chapter_id",children:e.jsx(ne,{style:{width:300},allowClear:!0,placeholder:"请选择所属章节",options:b})}),e.jsx("div",{children:e.jsx(ae,{type:"link",text:"章节管理",class:"c-primary",icon:null,p:"course_chapter",onClick:()=>{u("/course/vod/chapter/index?course_id="+r)},disabled:null})})]})}),e.jsx(l.Item,{label:"上架时间",name:"published_at",rules:[{required:!0,message:"请选择上架时间!"}],children:e.jsx(oe,{format:"YYYY-MM-DD HH:mm",style:{width:300},showTime:!0,placeholder:"请选择上架时间"})})]}),e.jsxs("div",{style:{display:p==="dev"?"block":"none"},children:[e.jsx(l.Item,{label:"禁止快进播放",name:"ban_drag",children:e.jsxs(n,{align:"baseline",style:{height:32},children:[e.jsx(l.Item,{name:"ban_drag",valuePropName:"checked",children:e.jsx(D,{onChange:O})}),e.jsx("div",{className:"ml-10",children:e.jsx(c,{text:"打开后学员学习此课时无法快进"})})]})}),e.jsx(l.Item,{label:"隐藏课时",name:"is_show",children:e.jsxs(n,{align:"baseline",style:{height:32},children:[e.jsx(l.Item,{name:"is_show",valuePropName:"checked",children:e.jsx(D,{onChange:z})}),e.jsx("div",{className:"ml-10",children:e.jsx(c,{text:"打开后课时在前台将隐藏显示"})})]})}),e.jsx(l.Item,{label:"阿里云视频文件ID",name:"aliyun_video_id",children:e.jsx(d,{style:{width:300},placeholder:"阿里云视频文件ID",allowClear:!0})}),e.jsx(l.Item,{label:"腾讯云视频文件ID",name:"tencent_video_id",children:e.jsx(d,{style:{width:300},placeholder:"腾讯云视频文件ID",allowClear:!0})}),e.jsx(l.Item,{label:"视频URL",name:"url",children:e.jsx(d,{style:{width:300},placeholder:"视频URL",allowClear:!0})})]})]})}),e.jsx("div",{className:"bottom-menus",children:e.jsxs("div",{className:"bottom-menus-box",children:[e.jsx("div",{children:e.jsx(j,{loading:g,type:"primary",onClick:()=>t.submit(),children:"保存"})}),e.jsx("div",{className:"ml-24",children:e.jsx(j,{type:"default",onClick:()=>u(-1),children:"取消"})})]})}),e.jsx(ie,{open:R,onCancel:()=>_(!1),onSuccess:s=>{t.setFieldsValue({duration:s.duration}),S(s.duration),s.storage_driver==="aliyun"?(f||t.setFieldsValue({title:s.title.replace(".m3u8","").replace(".mp4","")}),t.setFieldsValue({aliyun_video_id:s.storage_file_id,tencent_video_id:null,url:null}),x(s.title)):s.storage_driver==="tencent"?(f||t.setFieldsValue({title:s.title.replace(".m3u8","").replace(".mp4","")}),t.setFieldsValue({aliyun_video_id:null,tencent_video_id:s.storage_file_id,url:null}),x(s.title)):s.storage_driver==="local"&&(f||t.setFieldsValue({title:s.title.replace(".m3u8","").replace(".mp4","")}),te(s.storage_file_id,{}).then(i=>{t.setFieldsValue({aliyun_video_id:null,tencent_video_id:null,url:i.data.url}),x(s.title)})),_(!1)}})]})};export{Ae as default};
