import{u as D,b as L,r as a,t as O,j as e,I as d,S as l,B as g,M as G,m as C}from"./index-3fd54424.js";import{f as J,s as K,l as Q}from"./paper-57a0cabd.js";import{B as U}from"./index-c3c15456.js";import{H as n}from"./index-d5d1e443.js";import{F as t}from"./index-0ca68444.js";import{S as v}from"./index-ff4e3b6e.js";import{S as h}from"./index-27712364.js";import"./LeftOutlined-a0f8cfa6.js";import"./InfoCircleOutlined-fefc69ce.js";import"./row-98a37fbf.js";import"./responsiveObserver-a0dea2e5.js";import"./useIcons-235bc0cd.js";import"./CheckOutlined-44e74bd9.js";const ce=()=>{const w=D(),o=L(),[i]=t.useForm(),[f,u]=a.useState(!1),[b,x]=a.useState(0),[y,I]=a.useState(0),[F,p]=a.useState(0),[N,q]=a.useState([]),[S,V]=a.useState([]),[P,j]=a.useState(!1);a.useEffect(()=>{document.title="新建试卷",w(O("新建试卷")),i.setFieldsValue({enabled_invite:0,is_free:0,is_skip_mark:0,is_vip_free:0,is_random:0}),x(0),p(0),B()},[]);const B=()=>{J().then(s=>{let c=s.data.categories;const m=[];for(let r=0;r<c.length;r++)m.push({label:c[r].name,value:c[r].id});q(m);let _=s.data.courses;const k=[];for(let r=0;r<_.length;r++)k.push({label:_[r].title,value:_[r].id});V(k)})},T=s=>{if(f)return;if(s.enabled_invite===0&&s.is_free===0&&!s.charge){C.error("价格不能为空");return}if(s.enabled_invite===0&&s.is_free===0&&parseInt(s.charge)===0&&(s.required_courses&&s.required_courses.length===0||!s.required_courses)){C.error("设置价格大于0或者设置有购买录播课程");return}u(!0);const c=s.required_courses&&s.required_courses.join(",");K({rule:s.newRule,pass_score:s.pass_score,title:s.title,is_skip_mark:s.is_skip_mark,expired_minutes:s.expired_minutes,enabled_invite:s.enabled_invite,charge:y,is_free:b,required_courses:c,is_vip_free:s.is_vip_free||0,is_random:s.is_random||0,category_id:s.category_id,try_times:s.try_times}).then(m=>{u(!1),j(!0)}).catch(m=>{u(!1)})},E=s=>{console.log("Failed:",s)},H=s=>{s?i.setFieldsValue({is_skip_mark:1}):i.setFieldsValue({is_skip_mark:0})},M=s=>{s?(i.setFieldsValue({is_invite:1}),p(1)):(i.setFieldsValue({is_invite:0}),p(0))},R=s=>{s?(i.setFieldsValue({is_free:1,charge:0}),I(0),x(1)):(i.setFieldsValue({is_free:0}),x(0))},z=s=>{s?i.setFieldsValue({is_vip_free:1}):i.setFieldsValue({is_vip_free:0})},A=()=>{Q({page:1,size:10,sort:"id",order:"desc"}).then(s=>{o("/exam/paper/question?id="+s.data.data.data[0].id,{replace:!0})})};return e.jsxs("div",{className:"meedu-main-body",children:[e.jsx(U,{title:"新建试卷"}),e.jsx("div",{className:"float-left mt-30",children:e.jsxs(t,{form:i,name:"paper-create",labelCol:{span:3},wrapperCol:{span:21},initialValues:{remember:!0},onFinish:T,onFinishFailed:E,autoComplete:"off",children:[e.jsx(t.Item,{label:"试卷名",name:"title",rules:[{required:!0,message:"请输入试卷名!"}],children:e.jsx(d,{style:{width:300},placeholder:"请输入试卷名",allowClear:!0})}),e.jsx(t.Item,{label:"分类",name:"category_id",rules:[{required:!0,message:"请选择分类!"}],children:e.jsxs(l,{align:"baseline",style:{height:32},children:[e.jsx(t.Item,{name:"category_id",rules:[{required:!0,message:"请选择分类!"}],children:e.jsx(v,{style:{width:300},allowClear:!0,placeholder:"请选择分类",options:N})}),e.jsx(g,{type:"link",className:"c-primary",onClick:()=>{o("/exam/paper/category/index")},children:"分类管理"})]})}),e.jsx(t.Item,{label:"及格分",name:"pass_score",rules:[{required:!0,message:"请输入及格分!"}],children:e.jsx(d,{type:"number",style:{width:300},placeholder:"请输入及格分",allowClear:!0})}),e.jsx(t.Item,{label:"时间",name:"expired_minutes",rules:[{required:!0,message:"请输入时间!"}],children:e.jsx(d,{type:"number",style:{width:300},placeholder:"单位：分钟",allowClear:!0})}),e.jsx(t.Item,{label:"考试次数",name:"try_times",rules:[{required:!0,message:"请输入考试次数!"}],children:e.jsxs(l,{align:"baseline",style:{height:32},children:[e.jsx(t.Item,{name:"try_times",rules:[{required:!0,message:"请输入考试次数!"}],children:e.jsx(d,{type:"number",style:{width:300},placeholder:"请输入整数",allowClear:!0})}),e.jsx("div",{className:"ml-10",children:e.jsx(n,{text:"可限制用户可考次数。填写0的话意味着不限制考试次数。"})})]})}),e.jsx(t.Item,{label:"跳过阅卷",name:"is_skip_mark",children:e.jsxs(l,{align:"baseline",style:{height:32},children:[e.jsx(t.Item,{name:"is_skip_mark",valuePropName:"checked",children:e.jsx(h,{onChange:H})}),e.jsx("div",{className:"ml-10",children:e.jsx(n,{text:"若试卷中包含问答题，将自动跳过问答题阅卷生成总成绩。"})})]})}),e.jsx(t.Item,{label:"仅添加学员",name:"enabled_invite",children:e.jsxs(l,{align:"baseline",style:{height:32},children:[e.jsx(t.Item,{name:"enabled_invite",valuePropName:"checked",children:e.jsx(h,{onChange:M})}),e.jsx("div",{className:"ml-10",children:e.jsx(n,{text:"只有在后台添加的用户才可以参与考试。该使用场景如：老师指定的一批学生科参与考试。"})})]})}),F===0&&e.jsxs(e.Fragment,{children:[e.jsx(t.Item,{label:"免费参与",name:"is_free",children:e.jsxs(l,{align:"baseline",style:{height:32},children:[e.jsx(t.Item,{name:"is_free",valuePropName:"checked",children:e.jsx(h,{onChange:R})}),e.jsx("div",{className:"ml-10",children:e.jsx(n,{text:"开启所有用户均可直接考试。"})})]})}),b===0&&e.jsxs(e.Fragment,{children:[e.jsx(t.Item,{label:"价格",name:"charge",rules:[{required:!0,message:"请输入价格!"}],children:e.jsxs(l,{align:"baseline",style:{height:32},children:[e.jsx(t.Item,{name:"charge",rules:[{required:!0,message:"请输入价格!"}],children:e.jsx(d,{onChange:s=>{I(Number(s.target.value))},type:"number",style:{width:300},placeholder:"单位：元",allowClear:!0})}),e.jsx("div",{className:"ml-10",children:e.jsx(n,{text:"请输入整数"})})]})}),y>0&&e.jsx(t.Item,{label:"VIP免费",name:"is_vip_free",children:e.jsxs(l,{align:"baseline",style:{height:32},children:[e.jsx(t.Item,{name:"is_vip_free",valuePropName:"checked",children:e.jsx(h,{onChange:z})}),e.jsx("div",{className:"ml-10",children:e.jsx(n,{text:"VIP会员可无需购买直接参与考试。"})})]})}),e.jsx(t.Item,{label:"购买录播课程",name:"required_courses",children:e.jsxs(l,{align:"baseline",style:{height:32},children:[e.jsx(t.Item,{name:"required_courses",children:e.jsx(v,{style:{width:300},allowClear:!0,mode:"multiple",placeholder:"请选择购买录播课程",options:S})}),e.jsx("div",{className:"ml-10",children:e.jsx(n,{text:"购买指定的录播课程可直接参与考试。"})})]})})]})]})]})}),e.jsx("div",{className:"bottom-menus",children:e.jsxs("div",{className:"bottom-menus-box",children:[e.jsx("div",{children:e.jsx(g,{loading:f,type:"primary",onClick:()=>i.submit(),children:"保存"})}),e.jsx("div",{className:"ml-24",children:e.jsx(g,{type:"default",onClick:()=>o(-1),children:"取消"})})]})}),P?e.jsx(G,{title:"",onCancel:()=>{j(!1),o("/exam/paper/index",{replace:!0})},cancelText:"暂不组卷",okText:"立即组卷",open:!0,width:500,maskClosable:!1,onOk:()=>{j(!1),A()},centered:!0,children:e.jsx("div",{className:"text-center",style:{marginTop:30,marginBottom:30},children:e.jsx("span",{children:"新建考试成功，请在试题库中选择试题组卷吧！"})})}):null]})};export{ce as default};
