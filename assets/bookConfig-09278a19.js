import{r as o,j as e,M as D,m as P,I as F,B as v,u as K,b as E,f as R,t as H,cx as M,g as A,cy as O}from"./index-b4683d61.js";import{l as I}from"./book-a8b4ca06.js";import{B as W}from"./index-5f967da4.js";import{H as $}from"./index-133d6e1c.js";import{T as U}from"./index-ae12b8d6.js";import{C as X}from"./index-7a22fa40.js";import{T as Y}from"./Table-76e623b5.js";import{F as q}from"./index-d434f3eb.js";import"./LeftOutlined-9e6e73a2.js";import"./InfoCircleOutlined-4d24221b.js";import"./addEventListener-a27ae3f4.js";import"./useIcons-e0af7133.js";import"./CheckOutlined-e6bc730e.js";import"./Pagination-d2c763c6.js";import"./useForceUpdate-f2aff5e0.js";import"./responsiveObserver-dc429d3b.js";import"./index-c09cc6d7.js";import"./index-10f1a096.js";import"./iconUtil-f3f90360.js";import"./row-4ee18533.js";const G=m=>{const[u,h]=o.useState(!1),[S,C]=o.useState([]),[g,f]=o.useState(1),[c,i]=o.useState(10),[_,b]=o.useState(0),[d,x]=o.useState(!1),[j,w]=o.useState(""),[p,k]=o.useState([]);o.useEffect(()=>{m.open&&N()},[m.open,g,c,d]);const N=()=>{u||(h(!0),I({page:g,size:c,sort:"created_at",order:"desc",key:j}).then(s=>{C(s.data.data.data),b(s.data.data.total),h(!1)}).catch(s=>{h(!1)}))},a=()=>{f(1),i(10),C([]),w(""),x(!d)},t={current:g,pageSize:c,total:_,onChange:(s,r)=>l(s,r),showSizeChanger:!0},l=(s,r)=>{f(s),i(r)},n=[{title:"电子书ID",width:120,render:(s,r)=>e.jsx("span",{children:r.id})},{title:"电子书",render:(s,r)=>e.jsxs("div",{className:"d-flex",children:[e.jsx("div",{children:e.jsx("img",{src:r.thumb,width:"60",height:"80"})}),e.jsx("div",{className:"ml-15",children:r.name})]})},{title:"价格",width:120,dataIndex:"charge",render:s=>e.jsxs("span",{children:["￥",s]})}],y={onChange:(s,r)=>{let B=r,L=[];if(B){for(var z=0;z<B.length;z++)L.push(B[z].id);k(L)}},getCheckboxProps:s=>({disabled:m.selected.indexOf(s.id)!==-1})};return e.jsx(e.Fragment,{children:m.open?e.jsx(D,{title:"选择电子书",closable:!1,onCancel:()=>{m.onCancel()},open:!0,width:900,maskClosable:!1,onOk:()=>{if(!p||p.length===0){P.error("请先选择内容");return}m.onSelected(p)},centered:!0,children:e.jsxs("div",{className:"float-left mt-20",style:{maxHeight:520,overflowX:"hidden",overflowY:"auto",marginBottom:10},children:[e.jsxs("div",{className:"float-left mb-15",children:[e.jsx(F,{value:j,onChange:s=>{w(s.target.value)},allowClear:!0,style:{width:150},placeholder:"关键字"}),e.jsx(v,{className:"ml-10",onClick:a,children:"清空"}),e.jsx(v,{className:"ml-10",type:"primary",onClick:()=>{f(1),x(!d)},children:"筛选"})]}),e.jsx("div",{className:"float-left mb-15",children:e.jsx(Y,{rowSelection:{type:"checkbox",...y},loading:u,columns:n,dataSource:S,rowKey:s=>s.id,pagination:t})})]})}):null})},J="_item_1lzed_8",T={"thumb-box":"_thumb-box_1lzed_1",item:J,"btn-del":"_btn-del_1lzed_15"},ge=()=>{const m=K(),u=E();q.useForm();const[h,S]=o.useState([]),[C,g]=o.useState([]),f=new URLSearchParams(R().search),[c,i]=o.useState(!1),[_,b]=o.useState(!1),[d,x]=o.useState([]);o.useEffect(()=>{document.title="电子书推荐",m(H("电子书推荐")),j()},[]);const j=()=>{c||(i(!0),M().then(a=>{let t=a.data.电子书,l=[];for(let n in t)t[n].key==="meedu.addons.meedu_books.pc_list_page_rec_ids"&&t[n].value&&t[n].value.length>0&&(l=t[n].value.split(",").map(Number),x(l));w(l)}).catch(a=>{i(!1)}))},w=a=>{I({page:1,size:1e5}).then(t=>{g(t.data.data.data),p(t.data.data.data,a),i(!1)}).catch(t=>{i(!1)})},p=(a,t)=>{let l=[];if(t.length>0)for(var n=0;n<t.length;n++){let y=a.find(s=>s.id===parseInt(t[n]));y&&l.push(y)}S(l)},k=()=>{c||(i(!0),O({config:{"meedu.addons.meedu_books.pc_list_page_rec_ids":d.join(",")}}).then(a=>{i(!1),P.success("成功！"),j(),f.get("referer")?u(String(f.get("referer")),{replace:!0}):u(-1)}).catch(a=>{i(!1)}))},N=a=>{let t=[...h];t.splice(a,1),S(t);let l=[...d];l.splice(a,1),x(l)};return e.jsxs("div",{className:"meedu-main-body",children:[e.jsx(W,{title:"电子书推荐"}),e.jsx(G,{selected:d,open:_,onCancel:()=>b(!1),onSelected:a=>{let t=[...d];t=t.concat(a),x(t),b(!1),p(C,t)}}),e.jsxs("div",{className:"float-left d-flex mt-30 mb-30",children:[e.jsx("div",{children:e.jsx(v,{type:"primary",onClick:()=>b(!0),children:"添加推荐"})}),e.jsx("div",{className:"ml-10",children:e.jsx($,{text:"添加推荐的图文会在PC端图文列表右侧悬浮展示"})})]}),c&&e.jsx("div",{style:{width:"100%",textAlign:"center",paddingTop:50,paddingBottom:30,boxSizing:"border-box"},children:e.jsx(A,{})}),!c&&d&&h&&h.length>0&&e.jsx("div",{className:T["thumb-box"],children:h.map((a,t)=>e.jsxs("div",{className:T.item,onClick:()=>N(t),children:[e.jsx("div",{className:T["btn-del"],children:e.jsx(X,{})}),e.jsx(U,{width:60,value:a.thumb,height:80,title:"",border:4})]},a.id))}),e.jsx("div",{className:"bottom-menus",children:e.jsxs("div",{className:"bottom-menus-box",children:[e.jsx("div",{children:e.jsx(v,{loading:c,type:"primary",onClick:()=>k(),children:"保存"})}),e.jsx("div",{className:"ml-24",children:e.jsx(v,{type:"default",onClick:()=>u(-1),children:"取消"})})]})})]})};export{ge as default};
