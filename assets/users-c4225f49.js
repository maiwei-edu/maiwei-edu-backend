import{f as V,u as q,r as a,t as G,j as t,I as C,B as j,d as y,m as J,h as _}from"./index-b4683d61.js";import{N as M}from"./live-ef2dd82c.js";import{D as I}from"./index-44896e29.js";import{B as O}from"./index-5f967da4.js";import{u as Q,w as X}from"./xlsx-b055c42d.js";import{T as Z}from"./Table-76e623b5.js";import"./LeftOutlined-9e6e73a2.js";import"./addEventListener-a27ae3f4.js";import"./useIcons-e0af7133.js";import"./CheckOutlined-e6bc730e.js";import"./Pagination-d2c763c6.js";import"./useForceUpdate-f2aff5e0.js";import"./responsiveObserver-dc429d3b.js";import"./index-c09cc6d7.js";import"./index-10f1a096.js";import"./iconUtil-f3f90360.js";const pe=()=>{const n=new URLSearchParams(V().search),L=q(),[d,l]=a.useState(!1),[B,w]=a.useState([]),[c,m]=a.useState(1),[u,N]=a.useState(10),[S,E]=a.useState(0),[h,v]=a.useState(!1),[f,k]=a.useState(""),[p,D]=a.useState(""),[x,H]=a.useState(Number(n.get("id"))),[g,z]=a.useState(Number(n.get("course_id")));a.useEffect(()=>{document.title="直播课时学员",L(G("直播课时学员"))},[]),a.useEffect(()=>{H(Number(n.get("id"))),z(Number(n.get("course_id")))},[n.get("id"),n.get("course_id")]),a.useEffect(()=>{P()},[x,g,c,u,h]);const P=()=>{d||(l(!0),M(x,{course_id:g,page:c,size:u,sort:"id",order:"desc",mobile:f,nick_name:p}).then(s=>{w(s.data.data),E(s.data.total),l(!1)}).catch(s=>{l(!1)}))},T=()=>{m(1),N(10),w([]),k(""),D(""),v(!h)},F={current:c,pageSize:u,total:S,onChange:(s,e)=>R(s,e),showSizeChanger:!0},R=(s,e)=>{m(s),N(e)},U=[{title:"学员ID",width:120,render:(s,e)=>t.jsx("span",{children:e.user_id})},{title:"学员",render:(s,e)=>t.jsxs(t.Fragment,{children:[e.user&&t.jsxs("div",{className:"user-item d-flex",children:[t.jsx("div",{className:"avatar",children:t.jsx("img",{src:e.user.avatar,width:"40",height:"40"})}),t.jsx("div",{className:"ml-10",children:e.user.nick_name})]}),!e.user&&t.jsx("span",{className:"c-red",children:"学员不存在"})]})},{title:"观看时长",width:150,render:(s,e)=>t.jsx(I,{duration:e.duration})},{title:"总时长",width:150,render:(s,e)=>t.jsx(I,{duration:e.total_duration})},{title:"看完",width:80,render:(s,e)=>t.jsxs(t.Fragment,{children:[e.is_watched===1&&t.jsx("span",{className:"c-green",children:"是"}),e.is_watched!==1&&t.jsx("span",{children:"否"})]})},{title:"开始时间",width:200,dataIndex:"created_at",render:s=>t.jsx("span",{children:y(s)})},{title:"看完时间",width:200,dataIndex:"watched_at",render:s=>t.jsx("span",{children:y(s)})}],Y=s=>{let e=Math.floor(s/3600),i=Math.floor((s-e*3600)/60),o=s-e*3600-i*60;return e===0&&i===0&&o===0?null:(e===0?e="":e=e+":",i<10&&(i="0"+i),o<10&&(o="0"+o),e+i+":"+o)},W=()=>{if(d)return;l(!0),M(x,{course_id:g,page:1,size:S,sort:"id",order:"desc",mobile:f,nick_name:p}).then(e=>{if(e.data.total===0){J.error("数据为空"),l(!1);return}let i="直播课时学员记录|"+_().format("YYYY-MM-DD HH:mm:ss")+".xlsx",o="sheet1",b=[["学员ID","学员","手机号","观看时长","总时长","看完","开始时间","看完时间"]];e.data.data.forEach(r=>{b.push([r.user_id,r.user.nick_name,r.user.mobile,Y(r.duration),Y(r.total_duration),r.is_watched===1?"是":"否",r.created_at?_(r.created_at).format("YYYY-MM-DD HH:mm"):"",r.watched_at?_(r.watched_at).format("YYYY-MM-DD HH:mm"):""])});const A=Q.json_to_sheet(b),K={SheetNames:[o],Sheets:{[o]:A}};X(K,i),l(!1)})};return t.jsxs("div",{className:"meedu-main-body",children:[t.jsx(O,{title:"直播课时学员"}),t.jsxs("div",{className:"float-left j-b-flex mb-30",children:[t.jsx("div",{className:"d-flex"}),t.jsxs("div",{className:"d-flex",children:[t.jsx(C,{value:f,onChange:s=>{k(s.target.value)},allowClear:!0,style:{width:150},placeholder:"学员手机号"}),t.jsx(C,{value:p,onChange:s=>{D(s.target.value)},allowClear:!0,style:{width:150,marginLeft:10},placeholder:"学员昵称"}),t.jsx(j,{className:"ml-10",onClick:T,children:"清空"}),t.jsx(j,{className:"ml-10",type:"primary",onClick:()=>{m(1),v(!h)},children:"筛选"}),t.jsx(j,{className:"ml-10",type:"primary",onClick:()=>W(),children:"导出表格"})]})]}),t.jsx("div",{className:"float-left",children:t.jsx(Z,{loading:d,columns:U,dataSource:B,rowKey:s=>s.id,pagination:F})})]})};export{pe as default};
