import{r as a,j as e,M as q,I,m as D,u as A,t as U,B as k,d as G,h as J}from"./index-b4683d61.js";import{w as Q,e as N}from"./order-8405cf8c.js";import{P as X}from"./index-573a6ce5.js";import{u as Z,w as $}from"./xlsx-b055c42d.js";import{F as p}from"./index-d434f3eb.js";import{S as ee}from"./index-c09cc6d7.js";import{S as se}from"./index-918ef875.js";import{a as te,w as ae}from"./wepay-fe568e4a.js";import{T as le}from"./index-d198db66.js";import{T as ne}from"./Table-76e623b5.js";import"./row-4ee18533.js";import"./responsiveObserver-dc429d3b.js";import"./useIcons-e0af7133.js";import"./CheckOutlined-e6bc730e.js";import"./PlusOutlined-c97c4cac.js";import"./addEventListener-a27ae3f4.js";import"./Pagination-d2c763c6.js";import"./LeftOutlined-9e6e73a2.js";import"./useForceUpdate-f2aff5e0.js";import"./index-10f1a096.js";import"./iconUtil-f3f90360.js";const re=i=>{const[r]=p.useForm(),[o,h]=a.useState(!1),[f,c]=a.useState(0),d=[{label:"成功",value:5},{label:"驳回",value:3}];a.useEffect(()=>{i.open&&(c(0),r.setFieldsValue({status:[],remark:"",is_return:1}))},[i.open]);const m=n=>{o||(h(!0),n.id=i.ids[0],Q(n).then(()=>{h(!1),D.success("成功！"),i.onSuccess()}).catch(u=>{h(!1)}))},x=n=>{console.log("Failed:",n)},j=n=>{n?r.setFieldsValue({is_return:1}):r.setFieldsValue({is_return:0})};return e.jsx(e.Fragment,{children:i.open?e.jsx(q,{title:"提现处理",onCancel:()=>{i.onCancel()},open:!0,width:500,maskClosable:!1,onOk:()=>{r.submit()},centered:!0,children:e.jsx("div",{className:"float-left mt-30",children:e.jsxs(p,{form:r,name:"refund-dailog",labelCol:{span:7},wrapperCol:{span:17},initialValues:{remember:!0},onFinish:m,onFinishFailed:x,autoComplete:"off",children:[e.jsx(p.Item,{label:"状态",name:"status",rules:[{required:!0,message:"请选择状态!"}],children:e.jsx(ee,{style:{width:300},allowClear:!0,placeholder:"请选择状态",options:d,onChange:n=>{c(n)}})}),e.jsx("div",{style:{display:f===3?"block":"none"},children:e.jsx(p.Item,{label:"是否退回提现金额",name:"is_return",valuePropName:"checked",rules:[{required:!0,message:"请选择是否退回提现金额!"}],children:e.jsx(se,{onChange:j})})}),e.jsx(p.Item,{label:"备注",name:"remark",rules:[{required:!0,message:"请输入备注!"}],children:e.jsx(I.TextArea,{style:{width:300},placeholder:"请输入备注",allowClear:!0,rows:3})})]})})}):null})},Ne=()=>{const i=A(),[r,o]=a.useState(!1),[h,f]=a.useState([]),[c,d]=a.useState(1),[m,x]=a.useState(10),[j,n]=a.useState(0),[u,w]=a.useState(!1),[P,S]=a.useState([]),[y,C]=a.useState(""),[b,z]=a.useState("0"),[E,_]=a.useState(!1),[T]=a.useState([{label:"待处理",key:"0"},{label:"已处理",key:"5"},{label:"已驳回",key:"3"}]),L=t=>{d(1),z(t),w(!u)};a.useEffect(()=>{document.title="余额提现",i(U("余额提现"))},[]),a.useEffect(()=>{M()},[c,m,u]);const M=()=>{r||(o(!0),N({page:c,size:m,user_id:y,status:b}).then(t=>{f(t.data.data),n(t.data.total),o(!1)}).catch(t=>{o(!1)}))},O=()=>{d(1),x(10),f([]),S([]),C(""),w(!u)},V={current:c,pageSize:m,total:j,onChange:(t,s)=>W(t,s),showSizeChanger:!0},W=(t,s)=>{d(t),x(s)},B=[{title:"学员ID",width:150,dataIndex:"user_id",render:t=>e.jsx("span",{children:t})},{title:"学员",width:200,render:(t,s)=>e.jsxs(e.Fragment,{children:[s.user&&e.jsx("div",{className:"user-item d-flex",children:e.jsx("div",{children:s.user.nick_name})}),!s.user&&e.jsx("span",{className:"c-red",children:"-"})]})},{title:"提现金额",width:200,render:(t,s)=>e.jsxs(e.Fragment,{children:[e.jsxs("span",{children:["￥",s.amount]}),e.jsx("br",{}),e.jsxs("span",{style:{color:"rgba(0,0,0,.3)",fontSize:"10px"},children:["提现前余额: ￥",s.before_balance]})]})},{title:"收款渠道",width:100,render:(t,s)=>e.jsx(e.Fragment,{children:e.jsxs("div",{children:[s.channel==="alipay"?e.jsx("img",{src:te,width:"30",height:"30"}):null,s.channel==="wechat"?e.jsx("img",{src:ae,width:"30",height:"30"}):null]})})},{title:"状态",width:150,render:(t,s)=>e.jsxs(e.Fragment,{children:[s.status===5&&e.jsx("span",{className:"c-green",children:"· 已处理"}),s.status===3&&e.jsx("span",{className:"c-red",children:"· 已驳回"}),s.status===0&&e.jsx("span",{className:"c-yellow",children:"· 待处理"})]})},{title:"备注",render:(t,s)=>e.jsx("span",{children:s.remark})},{title:"申请时间",width:200,dataIndex:"created_at",render:t=>e.jsx("span",{children:G(t)})},{title:"操作",width:150,render:(t,s)=>e.jsx(e.Fragment,{children:s.status===0?e.jsx(X,{type:"link",text:"确认打款",class:"c-primary",icon:null,p:"addons.MultiLevelShare.withdraw.handle",onClick:()=>{S([s.id]),_(!0)},disabled:null}):null})}],H=()=>{if(r)return;o(!0),N({page:1,size:j,user_id:y,status:b}).then(s=>{if(s.data.total===0){D.error("数据为空"),o(!1);return}let K="余额提现.xlsx",v="sheet1",F=[["学员ID","学员","金额","收款人渠道","收款人姓名","收款人账号","状态","备注","时间"]];s.data.data.forEach(l=>{let g;l.status===0?g="待处理":l.status===3?g="已驳回":l.status===5&&(g="已处理"),F.push([l.user_id,l.user.nick_name,l.amount+"元",l.channel,l.channel_name,l.channel_account,g,l.remark,l.created_at?J(l.created_at).format("YYYY-MM-DD HH:mm"):""])});const R=Z.json_to_sheet(F),Y={SheetNames:[v],Sheets:{[v]:R}};$(Y,K),o(!1)})};return e.jsxs("div",{className:"meedu-main-body",children:[e.jsx(re,{open:E,ids:P,onCancel:()=>_(!1),onSuccess:()=>{_(!1),S([]),w(!u)}}),e.jsxs("div",{className:"float-left j-b-flex mb-30",children:[e.jsx("div",{className:"d-flex",children:e.jsx(k,{type:"primary",onClick:()=>H(),children:"导出表格"})}),e.jsxs("div",{className:"d-flex",children:[e.jsx(I,{value:y,onChange:t=>{C(t.target.value)},allowClear:!0,style:{width:150},placeholder:"学员ID"}),e.jsx(k,{className:"ml-10",onClick:O,children:"清空"}),e.jsx(k,{className:"ml-10",type:"primary",onClick:()=>{d(1),w(!u)},children:"筛选"})]})]}),e.jsx("div",{className:"float-left",children:e.jsx(le,{defaultActiveKey:b,items:T,onChange:L})}),e.jsx("div",{className:"float-left",children:e.jsx(ne,{loading:r,columns:B,dataSource:h,rowKey:t=>t.id,pagination:V})})]})};export{Ne as default};
