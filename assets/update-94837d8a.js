import{f as I,u as S,b as k,r as i,t as H,j as e,g as B,S as x,I as f,B as j,h as M,m as P}from"./index-b4683d61.js";import{E,C as V,F as q}from"./live-ef2dd82c.js";import{B as L}from"./index-5f967da4.js";import{P as U}from"./index-573a6ce5.js";import{H as A}from"./index-133d6e1c.js";import{d as R,D as T}from"./index-cc7d88a3.js";import{F as s}from"./index-d434f3eb.js";import{S as Z}from"./index-c09cc6d7.js";import"./LeftOutlined-9e6e73a2.js";import"./InfoCircleOutlined-4d24221b.js";import"./row-4ee18533.js";import"./responsiveObserver-dc429d3b.js";import"./useIcons-e0af7133.js";import"./CheckOutlined-e6bc730e.js";const re=()=>{const r=new URLSearchParams(I().search),[l]=s.useForm(),b=S(),n=k(),[g,_]=i.useState([]),[u,y]=i.useState(!0),[h,c]=i.useState(!1),[o,w]=i.useState(Number(r.get("id"))),[m,v]=i.useState(Number(r.get("course_id")));i.useEffect(()=>{document.title="编辑直播排课",b(H("编辑直播排课")),C()},[o,m]),i.useEffect(()=>{w(Number(r.get("id"))),v(Number(r.get("course_id")))},[r.get("id"),r.get("course_id")]);const C=async()=>{await N(),await D(),y(!1)},D=async()=>{if(o===0)return;const t=await E(o);t.data.chapter_id===0?l.setFieldsValue({chapter_id:[]}):l.setFieldsValue({chapter_id:t.data.chapter_id}),l.setFieldsValue({title:t.data.title,published_at:R(t.data.published_at,"YYYY-MM-DD HH:mm"),estimate_duration:t.data.estimate_duration/60})},N=async()=>{var a=(await V()).data.chapters[m];if(a&&a.length>0){let p=[];for(var d=0;d<a.length;d++)p.push({label:a[d].name,value:a[d].id});_(p)}},Y=t=>{h||(c(!0),t.published_at=M(new Date(t.published_at)).format("YYYY-MM-DD HH:mm"),t.course_id=m,t.estimate_duration=t.estimate_duration*60,t.is_show=1,q(o,t).then(a=>{c(!1),P.success("保存成功！"),n(-1)}).catch(a=>{c(!1)}))},F=t=>{console.log("Failed:",t)};return e.jsxs("div",{className:"meedu-main-body",children:[e.jsx(L,{title:"编辑直播排课"}),u&&e.jsx("div",{className:"float-left text-center mt-30",children:e.jsx(B,{})}),e.jsx("div",{style:{display:u?"none":"block"},className:"float-left mt-30",children:e.jsxs(s,{form:l,name:"live-video-update",labelCol:{span:3},wrapperCol:{span:21},initialValues:{remember:!0},onFinish:Y,onFinishFailed:F,autoComplete:"off",children:[e.jsx(s.Item,{label:"章节",name:"chapter_id",children:e.jsxs(x,{align:"baseline",style:{height:32},children:[e.jsx(s.Item,{name:"chapter_id",children:e.jsx(Z,{style:{width:300},allowClear:!0,placeholder:"请选择章节",options:g})}),e.jsx("div",{children:e.jsx(U,{type:"link",text:"章节管理",class:"c-primary",icon:null,p:"addons.Zhibo.course_chapter.list",onClick:()=>{n("/live/course/chapter/index?id="+o)},disabled:null})})]})}),e.jsx(s.Item,{label:"直播标题",name:"title",rules:[{required:!0,message:"请输入直播标题!"}],children:e.jsx(f,{style:{width:300},placeholder:"请输入直播标题",allowClear:!0})}),e.jsx(s.Item,{label:"直播时间",name:"published_at",rules:[{required:!0,message:"请选择直播时间!"}],children:e.jsx(T,{format:"YYYY-MM-DD HH:mm",style:{width:300},showTime:!0,placeholder:"请选择到期时间"})}),e.jsx(s.Item,{label:"预估直播时长",name:"estimate_duration",rules:[{required:!0,message:"请输入预估直播时长!"}],children:e.jsxs(x,{align:"center",children:[e.jsx(s.Item,{style:{marginBottom:0},name:"estimate_duration",rules:[{required:!0,message:"请输入预估直播时长!"}],children:e.jsx(f,{type:"number",addonAfter:"分钟",style:{width:300},placeholder:"请输入预估直播时长",allowClear:!0})}),e.jsx("div",{className:"ml-10",children:e.jsx(A,{text:"学员观看直播超过此时长即代表学完此课时"})})]})})]})}),e.jsx("div",{className:"bottom-menus",children:e.jsxs("div",{className:"bottom-menus-box",children:[e.jsx("div",{children:e.jsx(j,{loading:h,type:"primary",onClick:()=>l.submit(),children:"保存"})}),e.jsx("div",{className:"ml-24",children:e.jsx(j,{type:"default",onClick:()=>n(-1),children:"取消"})})]})})]})};export{re as default};
