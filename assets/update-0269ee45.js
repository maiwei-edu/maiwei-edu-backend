import{u as $,f as ee,b as se,r as i,t as te,j as e,g as ae,B as b,I as m,S as o,m as y,h as ie}from"./index-3fd54424.js";import{P as le,N as re,a as ne,Q as oe}from"./course-c58bd7af.js";import{e as de}from"./InboxOutlined-35d156a9.js";import{B as ce}from"./index-c3c15456.js";import{P as me}from"./index-df05a090.js";import{H as u}from"./index-d5d1e443.js";import{I as V,U as ue}from"./index-43b1e5a1.js";import{d as he,D as pe}from"./index-a9db941d.js";import{F as a}from"./index-0ca68444.js";import{T as _e}from"./index-47408a6e.js";import{S as xe}from"./index-ff4e3b6e.js";import{S as k}from"./index-27712364.js";import"./LeftOutlined-a0f8cfa6.js";import"./InfoCircleOutlined-fefc69ce.js";import"./index-423292da.js";import"./index-b6bc188f.js";import"./Dragger-3ad849c3.js";import"./useForceUpdate-56773729.js";import"./DeleteOutlined-529a4ffa.js";import"./CheckOutlined-44e74bd9.js";import"./row-98a37fbf.js";import"./responsiveObserver-a0dea2e5.js";import"./Table-59a53b18.js";import"./addEventListener-1752243f.js";import"./useIcons-235bc0cd.js";import"./Pagination-a2ebdf00.js";import"./index-a56efb1a.js";import"./iconUtil-14ff0944.js";import"./index-2c039b27.js";import"./index-1d3834a2.js";import"./PlusOutlined-18e71fec.js";const Je=()=>{const[l]=a.useForm(),Y=$(),r=new URLSearchParams(ee().search),h=se(),[w,U]=i.useState(!0),[C,p]=i.useState(!1),[_,P]=i.useState("base"),[v,H]=i.useState([]),[B,L]=i.useState(1),[M,S]=i.useState(0),[I,x]=i.useState(0),[F,f]=i.useState(0),[N,j]=i.useState(""),[fe,R]=i.useState(""),[T,g]=i.useState(!1),[n,A]=i.useState(Number(r.get("course_id"))),[d,E]=i.useState(Number(r.get("id"))),q=[{key:"base",label:"基础信息"},{key:"dev",label:"可选信息"}];i.useEffect(()=>{document.title="编辑课时",Y(te("编辑课时")),W()},[n,d]),i.useEffect(()=>{A(Number(r.get("course_id"))),E(Number(r.get("id")))},[r.get("course_id"),r.get("id")]);const W=async()=>{await Q(),await z(),await K(),U(!1)},K=async()=>{if(d===0)return;var t=(await le(d)).data.video;l.setFieldsValue({title:t.title,chapter_id:t.chapter_id===0?null:t.chapter_id,is_show:t.is_show===1?0:1,ban_drag:t.ban_drag,aliyun_video_id:t.aliyun_video_id,url:t.url,tencent_video_id:t.tencent_video_id,published_at:he(t.published_at,"YYYY-MM-DD HH:mm")}),f(t.duration),x(t.free_seconds)},Q=async()=>{let t=(await re(n)).data.chapters;if(t.length>0){const D=[];for(let c=0;c<t.length;c++)D.push({label:t[c].title,value:t[c].id});H(D)}},z=async()=>{let t=(await ne(n)).data;L(t.is_free),t.is_free===1?(S(0),x(0),l.setFieldsValue({free_seconds:0})):S(t.charge)},G=s=>{if(!C){if(!s.url&&!s.aliyun_video_id&&!s.tencent_video_id){y.error("请上传课程视频");return}if(v.length>0&&!s.chapter_id){y.error("请选择所属章节");return}s.is_show===1?s.is_show=0:s.is_show=1,s.published_at=ie(new Date(s.published_at)).format("YYYY-MM-DD HH:mm"),s.charge=M,s.course_id=n,s.free_seconds=Number(I),s.duration=Number(F),p(!0),oe(d,s).then(t=>{y.success("成功"),p(!1),h(-1)}).catch(t=>{p(!1)})}},J=s=>{console.log("Failed:",s)},O=s=>{P(s)},X=s=>{s?l.setFieldsValue({ban_drag:1}):l.setFieldsValue({ban_drag:0})},Z=s=>{s?l.setFieldsValue({is_show:1}):l.setFieldsValue({is_show:0})};return e.jsxs("div",{className:"meedu-main-body",children:[e.jsx(ce,{title:"编辑课时"}),e.jsx("div",{className:"center-tabs mb-30",children:e.jsx(_e,{defaultActiveKey:_,items:q,onChange:O})}),w&&e.jsx("div",{className:"float-left text-center",children:e.jsx(ae,{})}),e.jsx("div",{style:{display:w?"none":"block"},className:"float-left",children:e.jsxs(a,{form:l,name:"course-video-update",labelCol:{span:3},wrapperCol:{span:21},initialValues:{remember:!0},onFinish:G,onFinishFailed:J,autoComplete:"off",children:[e.jsxs("div",{style:{display:_==="base"?"block":"none"},children:[e.jsx(a.Item,{label:"上传课时",children:e.jsxs(b,{type:"primary",onClick:()=>g(!0),children:[e.jsx("span",{children:"重新选择视频"}),N&&e.jsx("span",{className:"ml-10",children:N.replace(".m3u8","").replace(".mp4","")})]})}),e.jsx(a.Item,{label:"课时名称",name:"title",rules:[{required:!0,message:"请输入课时名称!"}],children:e.jsx(m,{style:{width:300},placeholder:"请输入课时名称",allowClear:!0,onChange:s=>{R(s.target.value)}})}),e.jsx(a.Item,{label:"课时时长",name:"duration",rules:[{required:!0,message:"请输入课时时长!"}],children:e.jsxs(o,{align:"baseline",style:{height:32},children:[e.jsx(V,{value:F,disabled:!1,onChange:s=>{f(s),l.setFieldsValue({duration:s})}}),e.jsx("div",{className:"ml-10",children:e.jsx(u,{text:"后台会根据课时时长统计学员学习进度"})})]})}),B===0&&e.jsx(a.Item,{label:"可试看时长",name:"free_seconds",children:e.jsxs(o,{align:"baseline",style:{height:32},children:[e.jsx(V,{value:I,disabled:!1,onChange:s=>{console.log(s),x(s),l.setFieldsValue({free_seconds:s})}}),e.jsx("div",{className:"ml-10",children:e.jsx(u,{text:"设置此课时免费试看时长（此配置对本地存储或URL视频无效）"})})]})}),e.jsx(a.Item,{label:"所属章节",name:"chapter_id",children:e.jsxs(o,{align:"baseline",style:{height:32},children:[e.jsx(a.Item,{name:"chapter_id",children:e.jsx(xe,{style:{width:300},allowClear:!0,placeholder:"请选择所属章节",options:v})}),e.jsx("div",{children:e.jsx(me,{type:"link",text:"章节管理",class:"c-primary",icon:null,p:"course_chapter",onClick:()=>{h("/course/vod/chapter/index?course_id="+n)},disabled:null})})]})}),e.jsx(a.Item,{label:"上架时间",name:"published_at",rules:[{required:!0,message:"请选择上架时间!"}],children:e.jsx(pe,{format:"YYYY-MM-DD HH:mm",style:{width:300},showTime:!0,placeholder:"请选择上架时间"})})]}),e.jsxs("div",{style:{display:_==="dev"?"block":"none"},children:[e.jsx(a.Item,{label:"禁止快进播放",name:"ban_drag",children:e.jsxs(o,{align:"baseline",style:{height:32},children:[e.jsx(a.Item,{name:"ban_drag",valuePropName:"checked",children:e.jsx(k,{onChange:X})}),e.jsx("div",{className:"ml-10",children:e.jsx(u,{text:"打开后学员学习此课时无法快进"})})]})}),e.jsx(a.Item,{label:"隐藏课时",name:"is_show",children:e.jsxs(o,{align:"baseline",style:{height:32},children:[e.jsx(a.Item,{name:"is_show",valuePropName:"checked",children:e.jsx(k,{onChange:Z})}),e.jsx("div",{className:"ml-10",children:e.jsx(u,{text:"打开后课时在前台将隐藏显示"})})]})}),e.jsx(a.Item,{label:"阿里云视频文件ID",name:"aliyun_video_id",children:e.jsx(m,{style:{width:300},placeholder:"阿里云视频文件ID",allowClear:!0})}),e.jsx(a.Item,{label:"腾讯云视频文件ID",name:"tencent_video_id",children:e.jsx(m,{style:{width:300},placeholder:"腾讯云视频文件ID",allowClear:!0})}),e.jsx(a.Item,{label:"视频URL",name:"url",children:e.jsx(m,{style:{width:300},placeholder:"视频URL",allowClear:!0})})]})]})}),e.jsx("div",{className:"bottom-menus",children:e.jsxs("div",{className:"bottom-menus-box",children:[e.jsx("div",{children:e.jsx(b,{loading:C,type:"primary",onClick:()=>l.submit(),children:"保存"})}),e.jsx("div",{className:"ml-24",children:e.jsx(b,{type:"default",onClick:()=>h(-1),children:"取消"})})]})}),e.jsx(ue,{open:T,onCancel:()=>g(!1),onSuccess:s=>{l.setFieldsValue({duration:s.duration}),f(s.duration),s.storage_driver==="aliyun"?(l.setFieldsValue({aliyun_video_id:s.storage_file_id,tencent_video_id:null,url:null}),j(s.title)):s.storage_driver==="tencent"?(l.setFieldsValue({aliyun_video_id:null,tencent_video_id:s.storage_file_id,url:null}),j(s.title)):s.storage_driver==="local"&&de(s.storage_file_id,{}).then(t=>{l.setFieldsValue({aliyun_video_id:null,tencent_video_id:null,url:t.data.url}),j(s.title)}),g(!1)}})]})};export{Je as default};
