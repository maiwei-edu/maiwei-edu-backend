import{f as E,u as R,b as V,r,t as q,cq as H,ct as L,j as e,g as T,S as g,I as h,cr as b,B as w,m as _,cu as U}from"./index-b4683d61.js";import{B as A}from"./index-5f967da4.js";import{P as O}from"./index-573a6ce5.js";import{H as z}from"./index-133d6e1c.js";import{F as t}from"./index-d434f3eb.js";import{S as G}from"./index-c09cc6d7.js";import{S as J}from"./index-918ef875.js";import"./LeftOutlined-9e6e73a2.js";import"./InfoCircleOutlined-4d24221b.js";import"./row-4ee18533.js";import"./responsiveObserver-dc429d3b.js";import"./useIcons-e0af7133.js";import"./CheckOutlined-e6bc730e.js";const le=()=>{const d=new URLSearchParams(E().search),[n]=t.useForm(),y=R(),m=V(),[x,S]=r.useState(!0),[f,c]=r.useState(!1),[C,N]=r.useState([]),[p,j]=r.useState(""),[o,v]=r.useState(Number(d.get("id")));r.useEffect(()=>{document.title="编辑管理员",y(q("编辑管理员")),I()},[o]),r.useEffect(()=>{v(Number(d.get("id")))},[d.get("id")]);const I=async()=>{await F(),await k(),S(!1)},F=async()=>{const s=await H(),a=[];let i=s.data.roles;for(let l=0;l<i.length;l++)a.push({label:i[l].display_name,value:i[l].id});N(a)},k=async()=>{if(o===0)return;var a=(await L(o)).data,i=a.role_id;let l=[];for(var u=0;u<i.length;u++)l.push(i[u]);n.setFieldsValue({is_ban_login:a.is_ban_login,email:a.email,name:a.name,role_id:l})},B=s=>{if(f)return;let a={password_confirmation:s.password};if(!(s.password===void 0||s.password==="")){if(b(s.password)){_.error("密码至少包含大写字母，小写字母，数字，且不少于12位");return}a={password_confirmation:s.password,password:s.password}}Object.assign(a,{name:s.name,email:s.email,role_id:s.role_id,is_ban_login:s.is_ban_login}),c(!0),U(o,a).then(i=>{c(!1),_.success("保存成功！"),m(-1)}).catch(i=>{c(!1)})},P=s=>{console.log("Failed:",s)},D=s=>{s?n.setFieldsValue({is_ban_login:1}):n.setFieldsValue({is_ban_login:0})};return e.jsxs("div",{className:"meedu-main-body",children:[e.jsx(A,{title:"编辑管理员"}),x&&e.jsx("div",{className:"float-left text-center mt-30",children:e.jsx(T,{})}),e.jsx("div",{style:{display:x?"none":"block"},className:"float-left mt-30",children:e.jsxs(t,{form:n,name:"administrator-create",labelCol:{span:3},wrapperCol:{span:21},initialValues:{remember:!0},onFinish:B,onFinishFailed:P,autoComplete:"off",children:[e.jsx(t.Item,{label:"角色",children:e.jsxs(g,{align:"baseline",style:{height:32},children:[e.jsx(t.Item,{name:"role_id",children:e.jsx(G,{style:{width:300},mode:"multiple",allowClear:!0,placeholder:"请选择角色",options:C})}),e.jsx("div",{className:"ml-10",children:e.jsx(O,{type:"link",text:"角色管理",class:"c-primary",icon:null,p:"administrator_role",onClick:()=>{m("/system/adminroles")},disabled:null})})]})}),e.jsx(t.Item,{label:"姓名",name:"name",rules:[{required:!0,message:"请输入姓名!"}],children:e.jsx(h,{style:{width:300},placeholder:"请输入姓名",allowClear:!0})}),e.jsx(t.Item,{label:"邮箱",name:"email",rules:[{required:!0,message:"请输入邮箱!"}],children:e.jsx(h,{style:{width:300},placeholder:"请输入邮箱",allowClear:!0})}),e.jsx(t.Item,{label:"密码",name:"password",children:e.jsxs(g,{align:"baseline",style:{height:32},children:[e.jsx(t.Item,{name:"password",children:e.jsx(h.Password,{style:{width:300},placeholder:"请输入密码",allowClear:!0,onChange:s=>{if(s.target.value==="")j("");else{let a=b(s.target.value);j(String(a))}}})}),e.jsx("div",{className:"ml-10",children:e.jsx(z,{text:"不修改密码请勿填写"})}),p!==""&&p!=="undefined"&&e.jsx("div",{className:"ml-10 c-red",children:p})]})}),e.jsx(t.Item,{label:"禁止登录",name:"is_ban_login",valuePropName:"checked",children:e.jsx(J,{onChange:D})})]})}),e.jsx("div",{className:"bottom-menus",children:e.jsxs("div",{className:"bottom-menus-box",children:[e.jsx("div",{children:e.jsx(w,{loading:f,type:"primary",onClick:()=>n.submit(),children:"保存"})}),e.jsx("div",{className:"ml-24",children:e.jsx(w,{type:"default",onClick:()=>m(-1),children:"取消"})})]})})]})};export{le as default};
