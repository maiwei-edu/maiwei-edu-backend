import{u as Q,b as V,r as a,t as W,j as e,I as w,B as u,S as X,m as I,E as Z,d as Y,M as ee}from"./index-3fd54424.js";import{l as te,d as se}from"./promocode-0f89ead7.js";import{P as p}from"./index-df05a090.js";import{T as ae}from"./Table-59a53b18.js";import{D as le}from"./index-88bdc632.js";import{D as re}from"./index-a9db941d.js";import{T as A}from"./index-2c039b27.js";import"./addEventListener-1752243f.js";import"./useIcons-235bc0cd.js";import"./CheckOutlined-44e74bd9.js";import"./Pagination-a2ebdf00.js";import"./LeftOutlined-a0f8cfa6.js";import"./useForceUpdate-56773729.js";import"./responsiveObserver-a0dea2e5.js";import"./index-ff4e3b6e.js";import"./index-a56efb1a.js";import"./iconUtil-14ff0944.js";const{confirm:oe}=ee,{RangePicker:M}=re,ke=()=>{const R=Q(),h=V(),[x,l]=a.useState(!1),[z,v]=a.useState([]),[f,o]=a.useState(1),[g,_]=a.useState(10),[F,K]=a.useState(0),[n,j]=a.useState(!1),[r,C]=a.useState(""),[i,k]=a.useState(""),[c,b]=a.useState([]),[d,D]=a.useState([]),[B,N]=a.useState([]),[L,T]=a.useState([]),[S,E]=a.useState([]),[O,m]=a.useState(!1),[ne,P]=a.useState(!1);a.useEffect(()=>{document.title="优惠码",R(W("优惠码"))},[]),a.useEffect(()=>{U()},[f,g,n]),a.useEffect(()=>{c&&c.length>0||d&&d.length>0||i||r?P(!0):P(!1)},[c,d,i,r]);const U=()=>{x||(l(!0),te({page:f,size:g,user_id:i,key:r,created_at:c,expired_at:d}).then(t=>{v(t.data.data),K(t.data.total),l(!1)}).catch(t=>{l(!1)}))},$=()=>{if(S.length===0){I.error("请选择需要操作的数据");return}oe({title:"操作确认",icon:e.jsx(Z,{}),content:"确认删除选中的优惠码？",centered:!0,okText:"确认",cancelText:"取消",onOk(){x||(l(!0),se({ids:S}).then(()=>{I.success("成功"),y(),l(!1)}).catch(t=>{l(!1)}))},onCancel(){console.log("Cancel")}})},y=()=>{o(1),_(10),v([]),E([]),C(""),k(""),N([]),D([]),T([]),b([]),j(!n)},q={current:f,pageSize:g,total:F,onChange:(t,s)=>G(t,s),showSizeChanger:!0},G=(t,s)=>{o(t),_(s)},H=[{title:"ID",width:120,render:(t,s)=>e.jsx("span",{children:s.id})},{title:"优惠码",render:(t,s)=>e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mb-10",children:s.code}),e.jsxs("div",{children:["面值：",s.invited_user_reward,"元"]}),e.jsxs("div",{children:["奖励：",s.invite_user_reward,"元"]})]})},{title:"可使用次数",width:300,render:(t,s)=>e.jsxs(e.Fragment,{children:[s.use_times===0&&e.jsx(A,{color:"error",children:"不限制"}),s.use_times!==0&&e.jsxs(A,{children:[s.use_times||0,"次"]})]})},{title:"已使用次数",width:150,dataIndex:"used_times",render:t=>e.jsxs("span",{children:[t||0,"次"]})},{title:"过期时间",width:200,dataIndex:"expired_at",render:t=>e.jsx("span",{children:Y(t)})},{title:"添加时间",width:200,dataIndex:"created_at",render:t=>e.jsx("span",{children:Y(t)})}],J={selectedRowKeys:S,onChange:(t,s)=>{E(t)}};return e.jsxs("div",{className:"meedu-main-body",children:[e.jsxs("div",{className:"float-left j-b-flex mb-30",children:[e.jsxs("div",{className:"d-flex",children:[e.jsx(p,{type:"primary",text:"新建优惠码",class:"",icon:null,p:"promoCode.store",onClick:()=>h("/createcode"),disabled:null}),e.jsx(p,{type:"primary",text:"批量生成",class:"ml-10",icon:null,p:"promoCode.generator",onClick:()=>h("/createmulticode"),disabled:null}),e.jsx(p,{type:"primary",text:"批量导入",class:"ml-10",icon:null,p:"promoCode.store",onClick:()=>h("/order/code-import"),disabled:null}),e.jsx(p,{type:"danger",text:"批量删除",class:"ml-10",icon:null,p:"promoCode.destroy.multi",onClick:()=>$(),disabled:null})]}),e.jsxs("div",{className:"d-flex",children:[e.jsx(w,{value:r,onChange:t=>{C(t.target.value)},allowClear:!0,style:{width:150},placeholder:"优惠码关键字"}),e.jsx(u,{className:"ml-10",onClick:y,children:"清空"}),e.jsx(u,{className:"ml-10",type:"primary",onClick:()=>{o(1),j(!n),m(!1)},children:"筛选"})]})]}),e.jsx("div",{className:"float-left",children:e.jsx(ae,{rowSelection:{type:"checkbox",...J},loading:x,columns:H,dataSource:z,rowKey:t=>t.id,pagination:q})}),O?e.jsx(le,{title:"更多筛选",onClose:()=>m(!1),maskClosable:!1,open:!0,footer:e.jsxs(X,{className:"j-b-flex",children:[e.jsx(u,{onClick:()=>{y(),m(!1)},children:"清空"}),e.jsx(u,{onClick:()=>{o(1),j(!n),m(!1)},type:"primary",children:"筛选"})]}),width:360,children:e.jsxs("div",{className:"float-left",children:[e.jsx(w,{value:r,onChange:t=>{C(t.target.value)},allowClear:!0,placeholder:"优惠码"}),e.jsx(w,{value:i,onChange:t=>{k(t.target.value)},allowClear:!0,style:{marginTop:20},placeholder:"学员ID"}),e.jsx(M,{format:"YYYY-MM-DD",value:L,style:{marginTop:20},onChange:(t,s)=>{D(s),T(t)},placeholder:["过期时间-开始","过期时间-结束"]}),e.jsx(M,{format:"YYYY-MM-DD",value:B,style:{marginTop:20},onChange:(t,s)=>{b(s),N(t)},placeholder:["添加时间-开始","添加时间-结束"]})]})}):null]})};export{ke as default};
