import{b as re,r as t,j as e,B as M,I as ie,d as H,m as U,h as O,E as ne,M as ce,f as de,u as oe,a as ue,t as he}from"./index-3fd54424.js";import{B as me}from"./index-c3c15456.js";import{u as V,a as X,b as xe,e as fe,s as Z}from"./mock-e0c98417.js";import{D as pe}from"./index-423292da.js";import{P as K}from"./index-df05a090.js";import{u as q,w as G}from"./xlsx-b055c42d.js";import{S as je}from"./index-ff4e3b6e.js";import{T as J}from"./Table-59a53b18.js";import{U as ve}from"./index-dd790b41.js";import{D as ge}from"./index-a9db941d.js";import{T as _e}from"./index-47408a6e.js";import"./LeftOutlined-a0f8cfa6.js";import"./useIcons-235bc0cd.js";import"./CheckOutlined-44e74bd9.js";import"./addEventListener-1752243f.js";import"./Pagination-a2ebdf00.js";import"./useForceUpdate-56773729.js";import"./responsiveObserver-a0dea2e5.js";import"./index-a56efb1a.js";import"./iconUtil-14ff0944.js";import"./member-4894e8dc.js";import"./PlusOutlined-18e71fec.js";const Ne=d=>{const m=re(),[r,u]=t.useState(!1),[g,p]=t.useState([]),[j,h]=t.useState(1),[_,x]=t.useState(10),[y,o]=t.useState(0),[N,S]=t.useState(!1),[D,P]=t.useState(""),[Y,A]=t.useState(-1),L=[{value:-1,label:"全部"},{value:0,label:"未交卷"},{value:1,label:"已交卷"}];t.useEffect(()=>{b()},[d.id,j,_,N]);const b=()=>{r||(u(!0),V(d.id,{page:j,size:_,sort:"id",order:"desc",user_id:D,status:Y}).then(a=>{p(a.data.data),o(a.data.total),u(!1)}).catch(a=>{u(!1)}))},R=()=>{h(1),x(10),p([]),P(""),A(-1),S(!N)},z={current:j,pageSize:_,total:y,onChange:(a,s)=>I(a,s),showSizeChanger:!0},I=(a,s)=>{h(a),x(s)},n=[{title:"ID",width:120,render:(a,s)=>e.jsx("span",{children:s.id})},{title:"学员ID",width:120,render:(a,s)=>e.jsx("span",{children:s.user_id})},{title:"学员",width:300,render:(a,s)=>e.jsxs(e.Fragment,{children:[s.user&&e.jsxs("div",{className:"user-item d-flex",children:[e.jsx("div",{className:"avatar",children:e.jsx("img",{src:s.user.avatar,width:"40",height:"40"})}),e.jsx("div",{className:"ml-10",children:s.user.nick_name})]}),!s.user&&e.jsx("span",{className:"c-red",children:"学员不存在"})]})},{title:"分数",width:150,render:(a,s)=>e.jsx(e.Fragment,{children:s.status===1&&e.jsxs("span",{children:[s.get_score,"分"]})})},{title:"用时",render:(a,s)=>e.jsx(pe,{duration:s.use_seconds})},{title:"时间",width:200,dataIndex:"created_at",render:a=>e.jsx("span",{children:H(a)})},{title:"状态",width:100,render:(a,s)=>e.jsx("span",{children:s.status_text})},{title:"操作",width:100,fixed:"right",render:(a,s)=>e.jsx(K,{type:"link",text:"查看",class:"c-primary",icon:null,p:"addons.Paper.mock_paper.userPaper",onClick:()=>{m("/exam/mockpaper/paperShow?id="+s.paper_id+"&pid="+s.id)},disabled:null})}],c=a=>{let s=Math.floor(a/3600),f=Math.floor((a-s*3600)/60),v=a-s*3600-f*60;return s===0&&f===0&&v===0?null:(s===0?s="":s=s+":",f<10&&(f="0"+f),v<10&&(v="0"+v),s+f+":"+v)},E=()=>{if(r)return;u(!0);let a={page:1,size:y,sort:"id",order:"desc",user_id:D,status:Y};V(d.id,a).then(s=>{if(s.data.total===0){U.error("数据为空"),u(!1);return}let f="模拟卷考试记录.xlsx",v="sheet1",C=[["学员ID","学员","手机号","得分","用时","时间","状态"]];s.data.data.forEach(k=>{C.push([k.user_id,k.user.nick_name,k.user.mobile,k.get_score+"分",c(k.use_seconds),k.created_at?O(k.created_at).format("YYYY-MM-DD HH:mm"):"",k.status_text])});const B=q.json_to_sheet(C),F={SheetNames:[v],Sheets:{[v]:B}};G(F,f),u(!1)})};return e.jsxs("div",{className:"float-left",children:[e.jsxs("div",{className:"float-left j-b-flex mb-30",children:[e.jsx("div",{className:"d-flex",children:e.jsx(M,{type:"primary",onClick:()=>E(),children:"导出表格"})}),e.jsxs("div",{className:"d-flex",children:[e.jsx(ie,{value:D,onChange:a=>{P(a.target.value)},allowClear:!0,style:{width:150},placeholder:"学员ID"}),e.jsx(je,{style:{width:150,marginLeft:10},value:Y,onChange:a=>{A(a)},allowClear:!0,placeholder:"看完",options:L}),e.jsx(M,{className:"ml-10",onClick:R,children:"清空"}),e.jsx(M,{className:"ml-10",type:"primary",onClick:()=>{h(1),S(!N)},children:"筛选"})]})]}),e.jsx("div",{className:"float-left",children:e.jsx(J,{loading:r,columns:n,dataSource:g,rowKey:a=>a.id,pagination:z})})]})},{confirm:Se}=ce,ke=d=>{const[m,r]=t.useState(!1),[u,g]=t.useState([]),[p,j]=t.useState(1),[h,_]=t.useState(10),[x,y]=t.useState(0),[o,N]=t.useState(!1),[S,D]=t.useState(!1);t.useEffect(()=>{P()},[d.id,p,h,S]);const P=()=>{m||(r(!0),X(d.id,{page:p,size:h}).then(n=>{g(n.data.data.data),y(n.data.data.total),r(!1)}).catch(n=>{r(!1)}))},Y=n=>{n!==0&&Se({title:"警告",icon:e.jsx(ne,{}),content:"确认操作？",centered:!0,okText:"确认",cancelText:"取消",onOk(){m||(r(!0),fe(d.id,{id:d.id,user_id:n}).then(()=>{r(!1),U.success("成功"),A()}).catch(c=>{r(!1)}))},onCancel(){console.log("Cancel")}})},A=()=>{j(1),g([]),D(!S)},L={current:p,pageSize:h,total:x,onChange:(n,c)=>b(n,c),showSizeChanger:!0},b=(n,c)=>{j(n),_(c)},R=[{title:"学员ID",width:80,render:(n,c)=>e.jsx("span",{children:c.user_id})},{title:"手机号",width:150,render:(n,c)=>e.jsx(e.Fragment,{children:c.user&&e.jsx("span",{children:c.user.mobile})})},{title:"学员",render:(n,c)=>e.jsxs(e.Fragment,{children:[c.user&&e.jsxs("div",{className:"user-item d-flex",children:[e.jsx("div",{className:"avatar",children:e.jsx("img",{src:c.user.avatar,width:"40",height:"40"})}),e.jsx("div",{className:"ml-10",children:c.user.nick_name})]}),!c.user&&e.jsx("span",{className:"c-red",children:"学员不存在"})]})},{title:"操作",width:100,fixed:"right",render:(n,c)=>e.jsx(K,{type:"link",text:"删除",class:"c-red",icon:null,p:"addons.Paper.mock_paper.delUser",onClick:()=>{Y(c.user_id)},disabled:null})}],z=()=>{if(m)return;r(!0);let n={page:1,size:x};X(d.id,n).then(c=>{if(c.data.data.total===0){U.error("数据为空"),r(!1);return}let E="模拟卷订阅学员.xlsx",a="sheet1",s=[["学员ID","学员","手机号","时间"]];c.data.data.data.forEach(C=>{s.push([C.user_id,C.user.nick_name,C.user.mobile,O(C.created_at).format("YYYY-MM-DD HH:mm")])});const f=q.json_to_sheet(s),v={SheetNames:[a],Sheets:{[a]:f}};G(v,E),r(!1)})},I=n=>{m||(r(!0),xe(d.id,{id:d.id,mobiles:n}).then(()=>{r(!1),U.success("成功"),N(!1),A()}).catch(c=>{r(!1)}))};return e.jsxs("div",{className:"float-left",children:[e.jsxs("div",{className:"float-left  mb-30",children:[e.jsx(K,{type:"primary",text:"添加学员",class:"",icon:null,p:"addons.Paper.mock_paper.addUser",onClick:()=>N(!0),disabled:null}),e.jsx(M,{className:"ml-10",type:"primary",onClick:()=>z(),children:"导出表格"})]}),e.jsx("div",{className:"float-left",children:e.jsx(J,{loading:m,columns:R,dataSource:u,rowKey:n=>n.id,pagination:L})}),e.jsx(ve,{type:"mobile",open:o,onCancel:()=>N(!1),onSuccess:n=>{I(n)}})]})},{RangePicker:$}=ge,we=d=>{const[m,r]=t.useState(!1),[u,g]=t.useState([]),[p,j]=t.useState(1),[h,_]=t.useState(10),[x,y]=t.useState(0),[o,N]=t.useState(!1),[S,D]=t.useState({}),[P,Y]=t.useState(0),[A,L]=t.useState(0),[b,R]=t.useState({}),[z,I]=t.useState([]),[n,c]=t.useState([]),[E,a]=t.useState([]),[s,f]=t.useState([]);t.useEffect(()=>{v()},[d.id,p,h,o]);const v=()=>{m||(r(!0),Z(d.id,{page:p,size:h,created_at:z,submit_at:E}).then(i=>{g(i.data.data),y(i.data.total),D(i.data.users),R(i.data.stat),Y(i.data.pass_score),L(i.data.total_score),r(!1)}).catch(i=>{r(!1)}))},C=()=>{j(1),_(10),g([]),f([]),a([]),c([]),I([]),N(!o)},B={current:p,pageSize:h,total:x,onChange:(i,l)=>F(i,l),showSizeChanger:!0},F=(i,l)=>{j(i),_(l)},k=[{title:"学员ID",width:120,render:(i,l)=>e.jsx("span",{children:l.user_id})},{title:"学员",width:300,render:(i,l)=>e.jsxs(e.Fragment,{children:[S[l.user_id]&&e.jsxs("div",{className:"user-item d-flex",children:[e.jsx("div",{className:"avatar",children:e.jsx("img",{src:S[l.user_id].avatar,width:"40",height:"40"})}),e.jsx("div",{className:"ml-10",children:S[l.user_id].nick_name})]}),!S[l.user_id]&&e.jsx("span",{className:"c-red",children:"学员不存在"})]})},{title:"最高得分",render:(i,l)=>e.jsxs("span",{children:[l.get_score,"分"]})},{title:"及格",render:(i,l)=>e.jsx(e.Fragment,{children:l.get_score>=P?e.jsx("span",{children:"及格"}):e.jsx("span",{className:"c-red",children:"不及格"})})},{title:"开始时间",dataIndex:"created_at",render:i=>e.jsx("span",{children:H(i)})},{title:"交卷时间",dataIndex:"updated_at",render:i=>e.jsx("span",{children:H(i)})}],ee=()=>{if(m)return;r(!0);let i={page:1,size:x,created_at:z,submit_at:E};Z(d.id,i).then(l=>{if(l.data.total===0){U.error("数据为空"),r(!1);return}let se="成绩导出|"+O().format("YYYY-MM-DD HH:mm:ss")+".xlsx",Q="默认",w=[["用户ID","用户名","账号","分数","及格","时间"]];l.data.data.forEach(T=>{let W=l.data.users[T.user_id];if(typeof W>"u")return;let le=T.get_score>=l.data.pass_score?"是":"否";w.push([T.user_id,W.nick_name,W.mobile,T.get_score+"分",le,T.updated_at])}),w.push(["","",""]),w.push(["最低分",l.data.stat.min+"分"]),w.push(["最高分",l.data.stat.max+"分"]),w.push(["平均分",l.data.stat.average+"分"]),w.push(["总人数",l.data.total+"人"]),w.push(["及格分",l.data.pass_score+"分"]),w.push(["及格人数",l.data.stat.pass_count+"人"]),w.push(["及格率",l.data.stat.pass_rate+"%"]);const te=q.json_to_sheet(w),ae={SheetNames:[Q],Sheets:{[Q]:te}};G(ae,se),r(!1)})};return e.jsxs("div",{className:"float-left",children:[e.jsxs("div",{className:"float-left j-b-flex mb-30",children:[e.jsx("div",{className:"d-flex",children:e.jsx(M,{type:"primary",onClick:()=>ee(),children:"导出成绩"})}),e.jsxs("div",{className:"d-flex",children:[e.jsx($,{format:"YYYY-MM-DD",value:n,onChange:(i,l)=>{I(l),c(i)},placeholder:["考试时间-开始","考试时间-结束"]}),e.jsx($,{format:"YYYY-MM-DD",value:s,style:{marginLeft:10},onChange:(i,l)=>{a(l),f(i)},placeholder:["交卷时间-开始","交卷时间-结束"]}),e.jsx(M,{className:"ml-10",onClick:C,children:"清空"}),e.jsx(M,{className:"ml-10",type:"primary",onClick:()=>{j(1),N(!o)},children:"筛选"})]})]}),e.jsx("div",{className:"float-left mb-30",children:e.jsxs("div",{className:"d-flex stat-paper-box",children:[e.jsxs("div",{className:"flex-1 stat-item",children:[e.jsx("div",{className:"name",children:"总分"}),e.jsxs("div",{className:"value",children:[A,"分"]})]}),e.jsxs("div",{className:"flex-1 stat-item",children:[e.jsx("div",{className:"name",children:"及格分"}),e.jsxs("div",{className:"value",children:[P,"分"]})]}),e.jsxs("div",{className:"flex-1 stat-item",children:[e.jsx("div",{className:"name",children:"最低分"}),e.jsxs("div",{className:"value",children:[b.min,"分"]})]}),e.jsxs("div",{className:"flex-1 stat-item",children:[e.jsx("div",{className:"name",children:"最高分"}),e.jsxs("div",{className:"value",children:[b.max,"分"]})]}),e.jsxs("div",{className:"flex-1 stat-item",children:[e.jsx("div",{className:"name",children:"平均分"}),e.jsxs("div",{className:"value",children:[b.average,"分"]})]}),e.jsxs("div",{className:"flex-1 stat-item",children:[e.jsx("div",{className:"name",children:"及格率"}),e.jsxs("div",{className:"value",children:[b.pass_rate,"%"]})]}),e.jsxs("div",{className:"flex-1 stat-item",children:[e.jsx("div",{className:"name",children:"及格人数"}),e.jsxs("div",{className:"value",children:[b.pass_count,"人"]})]}),e.jsxs("div",{className:"flex-1 stat-item",children:[e.jsx("div",{className:"name",children:"总人数"}),e.jsxs("div",{className:"value",children:[x,"人"]})]})]})}),e.jsx("div",{className:"float-left",children:e.jsx(J,{loading:m,columns:k,dataSource:u,rowKey:i=>i.id,pagination:B})})]})},Ge=()=>{const d=new URLSearchParams(de().search),m=oe();t.useState(!1);const r=ue(o=>o.loginUser.value.user),[u,g]=t.useState(""),[p,j]=t.useState([]),[h,_]=t.useState(Number(d.get("id")));t.useEffect(()=>{document.title="模拟试卷学员",m(he("模拟试卷学员"))},[]),t.useEffect(()=>{_(Number(d.get("id")))},[d.get("id")]),t.useEffect(()=>{let o=[];x("addons.Paper.mock_paper.records")&&o.push({label:"考试记录",key:"watch-records"}),x("addons.Paper.mock_paper.statistics")&&o.push({label:"考试统计",key:"statistics"}),x("addons.Paper.mock_paper.users")&&o.push({label:"付费学员",key:"sub-users"}),g(o[0].key),j(o)},[r]);const x=o=>{if(r.permissions)return typeof r.permissions[o]<"u"},y=o=>{g(o)};return e.jsxs("div",{className:"meedu-main-body",children:[e.jsx(me,{title:"模拟试卷学员"}),e.jsx("div",{className:"float-left mt-30",children:e.jsx(_e,{defaultActiveKey:u,items:p,onChange:y})}),e.jsxs("div",{className:"float-left",children:[u==="watch-records"&&e.jsx(Ne,{id:h}),u==="sub-users"&&e.jsx(ke,{id:h}),u==="statistics"&&e.jsx(we,{id:h})]})]})};export{Ge as default};
