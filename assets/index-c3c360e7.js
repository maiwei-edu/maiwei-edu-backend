import{u as S,b as U,r as h,t as M,j as t,B as y,I as f,cw as j,m as a}from"./index-3fd54424.js";import{m as B}from"./wechat-f8e0631e.js";import{B as E}from"./index-c3c15456.js";import{P as _}from"./PlusOutlined-18e71fec.js";import{S as P}from"./index-ff4e3b6e.js";import{D}from"./DeleteOutlined-529a4ffa.js";import"./LeftOutlined-a0f8cfa6.js";import"./useIcons-235bc0cd.js";import"./CheckOutlined-44e74bd9.js";const Q=()=>{const k=S();U();const[C,N]=h.useState(!1),[s,c]=h.useState([]),[d,b]=h.useState(null),[i,x]=h.useState(null),[o,m]=h.useState(null),w=[{value:"view",label:"跳转网页"},{value:"click",label:"点击事件"},{value:"miniprogram",label:"打开小程序"}];h.useEffect(()=>{document.title="公众号菜单",k(M("公众号菜单"))},[]);const q=()=>{let r=[...s];r.length>=3||(r.push({name:"未命名",type:null,sub_button:[]}),c(r),v())},I=()=>{if(C)return;if(s.length==0){a.error("请编辑菜单");return}for(let e=0;e<s.length;e++){let l=e+1;if(!s[e].name){a.error("第"+l+"个菜单的「菜单名」为空"),u(e,null);return}if(!s[e].type){a.error("第"+l+"个菜单的「类型」为空"),u(e,null);return}if(s[e].type==="view"){if(!s[e].url){a.error("第"+l+"个菜单的「网址」为空"),u(e,null);return}if(j(s[e].url)){a.error("第"+l+"个菜单的「网址」错误，必须携带http://或https://协议"),u(e,null);return}}else if(s[e].type==="click"){if(!s[e].key){a.error("第"+l+"个菜单的「事件key」为空"),u(e,null);return}}else if(s[e].type==="miniprogram"){if(!s[e].appid){a.error("第"+l+"个菜单的「小程序appid」为空"),u(e,null);return}if(!s[e].pagepath){a.error("第"+l+"个菜单的「小程序打开页面路径」为空"),u(e,null);return}if(!s[e].url){a.error("第"+l+"个菜单的「URL地址」为空"),u(e,null);return}}if(s[e].sub_button===void 0){if(!s[e].name){a.error("第"+l+"个菜单的「菜单名」为空"),u(e,null);return}if(!s[e].type){a.error("第"+l+"个菜单的「类型」为空"),u(e,null);return}if(s[e].type==="view"){if(!s[e].url){a.error("第"+l+"个菜单的「网址」为空"),u(e,null);return}if(j(s[e].url)){a.error("第"+l+"个菜单的「网址」错误，必须携带http://或https://协议"),u(e,null);return}}else if(s[e].type==="click"){if(!s[e].key){a.error("第"+l+"个菜单的「事件key」为空"),u(e,null);return}}else if(s[e].type==="miniprogram"){if(!s[e].appid){a.error("第"+l+"个菜单的「小程序appid」为空"),u(e,null);return}if(!s[e].pagepath){a.error("第"+l+"个菜单的「小程序打开页面路径」为空"),u(e,null);return}if(!s[e].url){a.error("第"+l+"个菜单的「URL地址」为空"),u(e,null);return}}continue}for(let n=0;n<s[e].sub_button.length;n++){let p=n+1;if(!s[e].sub_button[n].name){a.error("第"+l+"个菜单的第"+p+"子菜单的「菜单名」为空"),u(e,n);return}if(!s[e].sub_button[n].type){a.error("第"+l+"个菜单的第"+p+"子菜单的「类型」为空"),u(e,n);return}if(s[e].sub_button[n].type==="view"){if(!s[e].sub_button[n].url){a.error("第"+l+"个菜单的第"+p+"子菜单的「网址」为空"),u(e,n);return}if(j(s[e].sub_button[n].url)){a.error("第"+l+"个菜单的第"+p+"子菜单的「网址」错误，必须携带http://或https://协议"),u(e,n);return}}else if(s[e].sub_button[n].type==="click"){if(!s[e].sub_button[n].key){a.error("第"+l+"个菜单的第"+p+"子菜单的「事件key」为空"),u(e,n);return}}else if(s[e].sub_button[n].type==="miniprogram"){if(!s[e].sub_button[n].appid){a.error("第"+l+"个菜单的第"+p+"子菜单的「小程序appid」为空"),u(e,n);return}if(!s[e].sub_button[n].pagepath){a.error("第"+l+"个菜单的第"+p+"子菜单的「小程序打开页面路径」为空"),u(e,n);return}if(!s[e].sub_button[n].url){a.error("第"+l+"个菜单的第"+p+"子菜单的「URL地址」为空"),u(e,n);return}}}}N(!0);let r=[];s.forEach(e=>{e.sub_button&&e.sub_button.length===0&&delete e.sub_button,r.push(e)}),B({menu:{button:r}}).then(e=>{a.success("成功"),N(!1)}).catch(e=>{N(!1)})},v=()=>{b(null),m(null),x(null)},L=r=>{let e=[...s];e[r].sub_button?e[r].sub_button.push({name:"未命名",type:null}):(e[r].sub_button=[],e[r].sub_button.push({name:"未命名",type:null})),c(e),v()},g=(r,e,l)=>{b(e),m(r),x(l),console.log(l)},R=()=>{if(!o)return;let r=[...s];i===0?r[d].sub_button=null:i>0?r[d].sub_button.splice(i,1):r.splice(d,1),c(r),v()},u=(r,e)=>{v(),e!==null?(b(r),m(s[r].sub_button[e]),x(e)):(b(r),m(s[r]),x(null))};return t.jsxs("div",{className:"meedu-main-body",children:[t.jsx(E,{title:"公众号菜单"}),t.jsxs("div",{className:"float-left mt-30",children:[t.jsx("h3",{children:"常见问题"}),t.jsx("div",{className:"question-helper-text",children:"1.菜单编辑之后需要点击「更新菜单」按钮将更改同步到微信公众号，这样才是一次正确的菜单更新操作。"}),t.jsx("div",{className:"question-helper-text",children:"2.点击「更新菜单」按钮之后，已修改的公众号菜单并不是立马就可以看到，最多需要等待10分钟才会看到最新修改的菜单。"}),t.jsx("div",{className:"question-helper-text",children:"3.自定义菜单最多包括3个一级菜单，每个一级菜单最多包含5个二级菜单。"}),t.jsx("div",{className:"question-helper-text",children:"4.一级菜单最多4个汉字，二级菜单最多8个汉字，多出来的部分将会以“...”代替。"})]}),t.jsx("div",{className:"float-left mt-15 mb-15",children:t.jsx(y,{type:"primary",onClick:()=>I(),children:"将菜单更新到微信公众号"})}),t.jsxs("div",{className:"mp-menu-edit-box",children:[t.jsx("div",{className:"menu-render-box",children:t.jsxs("div",{className:"menus",children:[s.length>0&&s.map((r,e)=>t.jsxs("div",{className:"menu-item",children:[t.jsx("span",{onClick:()=>{g(r,e,null)},children:r.name}),t.jsxs("div",{className:"children-box",children:[!r.sub_button||r.sub_button.length<5&&t.jsx("div",{className:"children-menu-item",onClick:()=>L(e),children:t.jsx(_,{})}),r.sub_button&&r.sub_button.length>0&&r.sub_button.map((l,n)=>t.jsx("div",{className:"children-menu-item",onClick:()=>g(l,e,n),children:l.name},n))]})]},e)),s.length<3&&t.jsx("div",{className:"menu-item",onClick:()=>q(),children:t.jsx(_,{})})]})}),o&&t.jsxs("div",{className:"menu-edit-box",children:[t.jsxs("div",{className:"float-left mb-15",children:[t.jsxs("div",{className:"float-heft question-helper-text mb-10",children:["菜单名 ",t.jsx("span",{className:"c-red",children:"*"})]}),t.jsx("div",{className:"float-left",children:t.jsx(f,{value:o.name,onChange:r=>{let e={...o};if(e.name=r.target.value,m(e),i!==null){let l=[...s];l[d].sub_button[i].name=r.target.value,c(l)}else{let l=[...s];l[d].name=r.target.value,c(l)}},placeholder:"菜单名",className:"w-300px"})})]}),t.jsxs("div",{className:"float-left mb-15",children:[t.jsxs("div",{className:"float-heft question-helper-text mb-10",children:["菜单类型",t.jsx("span",{className:"c-red",children:"*"})]}),t.jsx("div",{className:"float-left",children:t.jsx(P,{style:{width:300},value:o.type,onChange:r=>{let e={...o};if(e.type=r,m(e),i!==null){let l=[...s];l[d].sub_button[i].type=r,c(l)}else{let l=[...s];l[d].type=r,c(l)}},allowClear:!0,placeholder:"请选择菜单类型",options:w})})]}),o.type==="view"&&t.jsxs("div",{className:"float-left mb-15",children:[t.jsxs("div",{className:"float-heft question-helper-text mb-10",children:["网址",i!==null&&t.jsx("span",{className:"c-red",children:"*"})]}),t.jsx("div",{className:"float-left",children:t.jsxs("div",{className:"d-flex",children:[t.jsx("div",{children:t.jsx(f,{value:o.url,onChange:r=>{let e={...o};if(e.url=r.target.value,m(e),i!==null){let l=[...s];l[d].sub_button[i].url=r.target.value,c(l)}else{let l=[...s];l[d].url=r.target.value,c(l)}},placeholder:"请输入网址",className:"w-300px"})}),o.url&&t.jsx("div",{className:"ml-10 c-red",children:j(o.url)})]})})]}),o.type==="click"&&t.jsxs("div",{className:"float-left mb-15",children:[t.jsxs("div",{className:"float-heft question-helper-text mb-10",children:["事件Key",i!==null&&t.jsx("span",{className:"c-red",children:"*"})]}),t.jsx("div",{className:"float-left",children:t.jsx(f,{value:o.key,onChange:r=>{let e={...o};if(e.key=r.target.value,m(e),i!==null){let l=[...s];l[d].sub_button[i].key=r.target.value,c(l)}else{let l=[...s];l[d].key=r.target.value,c(l)}},placeholder:"请输入事件key",className:"w-300px"})})]}),o.type==="miniprogram"&&t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"float-left mb-15",children:[t.jsxs("div",{className:"float-heft question-helper-text mb-10",children:["小程序AppId",i!==null&&t.jsx("span",{className:"c-red",children:"*"})]}),t.jsx("div",{className:"float-left",children:t.jsx(f,{value:o.appid,onChange:r=>{let e={...o};if(e.appid=r.target.value,m(e),i!==null){let l=[...s];l[d].sub_button[i].appid=r.target.value,c(l)}else{let l=[...s];l[d].appid=r.target.value,c(l)}},placeholder:"小程序AppId",className:"w-300px"})})]}),t.jsxs("div",{className:"float-left mb-15",children:[t.jsxs("div",{className:"float-heft question-helper-text mb-10",children:["小程序打开页面路径",i!==null&&t.jsx("span",{className:"c-red",children:"*"})]}),t.jsx("div",{className:"float-left",children:t.jsx(f,{value:o.pagepath,onChange:r=>{let e={...o};if(e.pagepath=r.target.value,m(e),i!==null){let l=[...s];l[d].sub_button[i].pagepath=r.target.value,c(l)}else{let l=[...s];l[d].pagepath=r.target.value,c(l)}},placeholder:"小程序打开页面路径",className:"w-300px"})})]}),t.jsxs("div",{className:"float-left mb-15",children:[t.jsxs("div",{className:"float-heft question-helper-text mb-10",children:["URL地址",i!==null&&t.jsx("span",{className:"c-red",children:"*"})]}),t.jsxs("div",{className:"float-left",children:[t.jsx("div",{className:"mb-10",children:t.jsx(f,{value:o.url,onChange:r=>{let e={...o};if(e.url=r.target.value,m(e),i!==null){let l=[...s];l[d].sub_button[i].url=r.target.value,c(l)}else{let l=[...s];l[d].url=r.target.value,c(l)}},placeholder:"URL地址",className:"w-300px"})}),t.jsx("div",{children:t.jsx("span",{className:"question-helper-text",children:"不支持打开小程序的老版客户端将会打开该地址"})})]})]})]}),t.jsx("div",{className:"float-left",children:t.jsx(y,{type:"primary",danger:!0,onClick:()=>R(),children:t.jsx(D,{})})})]})]})]})};export{Q as default};
