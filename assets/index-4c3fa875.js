import{u as te,b as ae,r as l,t as le,j as e,I as O,B as f,S as N,d as ie,D as ne,e as re,E as oe,m as ce,M as de}from"./index-b4683d61.js";import{l as ue,d as he}from"./live-ef2dd82c.js";import{P as n}from"./index-573a6ce5.js";import{O as me}from"./index-6f8a3ac0.js";import{T as pe}from"./index-ae12b8d6.js";import{f as xe,a as je}from"./icon-filter-h-a57243b6.js";import{T as ge}from"./Table-76e623b5.js";import{D as fe}from"./index-cfda4d23.js";import{S as F}from"./index-c09cc6d7.js";import"./icon-option-c9fff0bb.js";import"./addEventListener-a27ae3f4.js";import"./useIcons-e0af7133.js";import"./CheckOutlined-e6bc730e.js";import"./Pagination-d2c763c6.js";import"./LeftOutlined-9e6e73a2.js";import"./useForceUpdate-f2aff5e0.js";import"./responsiveObserver-dc429d3b.js";import"./index-10f1a096.js";import"./iconUtil-f3f90360.js";const{confirm:ye}=de,Me=()=>{const M=te(),r=ae(),[v,o]=l.useState(!1),[K,C]=l.useState([]),[w,d]=l.useState(1),[k,T]=l.useState(10),[R,A]=l.useState(0),[u,y]=l.useState(!1),[h,S]=l.useState(""),[m,D]=l.useState([]),[p,Z]=l.useState([]),[b,L]=l.useState(-1),[H,$]=l.useState([]),[q,G]=l.useState([]),[J,Q]=l.useState([]),[U,x]=l.useState(!1),[E,I]=l.useState(!1);l.useEffect(()=>{document.title="直播课",M(le("直播课"))},[]),l.useEffect(()=>{V()},[w,k,u]),l.useEffect(()=>{m&&m.length!==0||p&&p.length!==0||b!==-1||h?I(!0):I(!1)},[m,p,b,h]);const V=()=>{v||(o(!0),ue({page:w,size:k,sort:"id",order:"desc",keywords:h,category_id:m,teacher_id:p,status:b}).then(t=>{C(t.data.data.data),A(t.data.data.total);let s=t.data.categories;const i=[];for(let a=0;a<s.length;a++)if(s[a].children.length>0){i.push({label:s[a].name,value:s[a].id});let g=s[a].children;for(let c=0;c<g.length;c++)g[c].name="|----"+g[c].name,i.push({label:g[c].name,value:g[c].id})}else i.push({label:s[a].name,value:s[a].id});G(i);let j=t.data.statusList;const z=[];for(let a=0;a<j.length;a++)z.push({label:j[a].name,value:j[a].key});Q(z);let _=t.data.teachers;const B=[];for(let a=0;a<_.length;a++)B.push({label:_[a].name,value:_[a].id});$(B),o(!1)}).catch(t=>{o(!1)}))},P=()=>{d(1),T(10),C([]),S(""),L(-1),D([]),Z([]),y(!u)},W={current:w,pageSize:k,total:R,onChange:(t,s)=>X(t,s),showSizeChanger:!0},X=(t,s)=>{d(t),T(s)},Y=[{title:"ID",width:"6%",render:(t,s)=>e.jsx("span",{children:s.id})},{title:"直播课程",width:"22%",render:(t,s)=>e.jsx(pe,{width:120,value:s.thumb,height:90,title:s.title,border:4})},{title:"分类",width:"8%",render:(t,s)=>{var i;return e.jsxs(e.Fragment,{children:[s.category&&e.jsx("span",{children:((i=s==null?void 0:s.category)==null?void 0:i.name)||"-"}),!s.category&&e.jsx("span",{className:"c-red",children:"数据不完整"})]})}},{title:"讲师/助教",width:"10%",render:(t,s)=>e.jsxs(e.Fragment,{children:[e.jsx("span",{children:s.teacher.name}),s.assistant&&e.jsxs("span",{children:["/",s.assistant.name]})]})},{title:"价格",width:"8%",render:(t,s)=>e.jsxs("span",{children:[s.charge,"元"]})},{title:"销量",width:"8%",render:(t,s)=>e.jsx("span",{children:s.join_user_times})},{title:"下一场直播时间",width:"16%",render:(t,s)=>e.jsxs(e.Fragment,{children:[s.status===2&&e.jsxs("span",{className:"c-gray",children:["· ",s.status_text]}),s.status!==2&&e.jsx(e.Fragment,{children:s.next_video.length===0?e.jsx("span",{children:"-"}):e.jsx("span",{children:ie(s.published_at)})})]})},{title:"是否显示",width:"8%",render:(t,s)=>e.jsxs(e.Fragment,{children:[s.is_show===1&&e.jsx("span",{className:"c-green",children:"· 显示"}),s.is_show!==1&&e.jsx("span",{className:"c-red",children:"· 隐藏"})]})},{title:"操作",width:"14%",fixed:"right",render:(t,s)=>{const i=[{key:"1",label:e.jsx(n,{type:"link",text:"统计",class:"c-primary",icon:null,p:"addons.Zhibo.course.stats",onClick:()=>{r("/live/course/stat?id="+s.id)},disabled:null})},{key:"2",label:e.jsx(n,{type:"link",text:"编辑",class:"c-primary",icon:null,p:"addons.Zhibo.course.update",onClick:()=>{r("/live/course/update?id="+s.id)},disabled:null})},{key:"3",label:e.jsx(n,{type:"link",text:"删除",class:"c-red",icon:null,p:"addons.Zhibo.course.delete",onClick:()=>{se(s.id)},disabled:null})}];return e.jsxs(N,{children:[e.jsx(n,{type:"link",text:"排课",class:"c-primary",icon:null,p:"addons.Zhibo.course_video.list",onClick:()=>{r("/live/course/video/index?id="+s.id+"&title="+s.title)},disabled:null}),e.jsx(n,{type:"link",text:"学员",class:"c-primary",icon:null,p:"addons.Zhibo.course.users",onClick:()=>{r("/live/course/users/index?id="+s.id)},disabled:null}),e.jsx(ne,{menu:{items:i},children:e.jsx(f,{type:"link",className:"c-primary",onClick:j=>j.preventDefault(),children:e.jsxs(N,{size:"small",align:"center",children:["更多",e.jsx(re,{})]})})})]})}}],ee=()=>{d(1),C([]),y(!u)},se=t=>{t!==0&&ye({title:"操作确认",icon:e.jsx(oe,{}),content:"确认删除此课程？",centered:!0,okText:"确认",cancelText:"取消",onOk(){v||(o(!0),he(t).then(()=>{o(!1),ce.success("删除成功"),ee()}).catch(s=>{o(!1)}))},onCancel(){console.log("Cancel")}})};return e.jsxs("div",{className:"meedu-main-body",children:[e.jsxs("div",{className:"float-left j-b-flex mb-30",children:[e.jsxs("div",{className:"d-flex",children:[e.jsx(n,{type:"primary",text:"新建直播课",class:"",icon:null,p:"addons.Zhibo.course.store",onClick:()=>r("/live/course/create"),disabled:null}),e.jsx(n,{type:"primary",text:"直播课分类",class:"ml-10",icon:null,p:"addons.Zhibo.course_category.list",onClick:()=>r("/live/course/category/index"),disabled:null}),e.jsx(n,{type:"primary",text:"讲师管理",class:"ml-10",icon:null,p:"addons.Zhibo.teacher.list",onClick:()=>r("/live/teacher/index"),disabled:null}),e.jsx(n,{type:"primary",text:"课程评论",class:"ml-10",icon:null,p:"addons.Zhibo.course_comment",onClick:()=>r("/live/course/comment"),disabled:null}),e.jsx(me,{text:"直播服务配置",value:"/system/liveConfig?referer=%2Flive%2Fcourse%2Findex"})]}),e.jsxs("div",{className:"d-flex",children:[e.jsx(O,{value:h,onChange:t=>{S(t.target.value)},allowClear:!0,style:{width:150},placeholder:"课程名称关键字"}),e.jsx(f,{className:"ml-10",onClick:P,children:"清空"}),e.jsx(f,{className:"ml-10",type:"primary",onClick:()=>{d(1),y(!u),x(!1)},children:"筛选"}),e.jsxs("div",{className:"drawerMore d-flex ml-10",onClick:()=>x(!0),children:[E&&e.jsxs(e.Fragment,{children:[e.jsx("img",{src:xe}),e.jsx("span",{className:"act",children:"已选"})]}),!E&&e.jsxs(e.Fragment,{children:[e.jsx("img",{src:je}),e.jsx("span",{children:"更多"})]})]})]})]}),e.jsx("div",{className:"float-left",children:e.jsx(ge,{loading:v,columns:Y,dataSource:K,rowKey:t=>t.id,pagination:W})}),U?e.jsx(fe,{title:"更多筛选",onClose:()=>x(!1),maskClosable:!1,open:!0,footer:e.jsxs(N,{className:"j-b-flex",children:[e.jsx(f,{onClick:()=>{P(),x(!1)},children:"清空"}),e.jsx(f,{onClick:()=>{d(1),y(!u),x(!1)},type:"primary",children:"筛选"})]}),width:360,children:e.jsxs("div",{className:"float-left",children:[e.jsx(O,{value:h,onChange:t=>{S(t.target.value)},allowClear:!0,placeholder:"课程名称关键字"}),e.jsx(F,{style:{width:"100%",marginTop:20},value:m,onChange:t=>{D(t)},allowClear:!0,placeholder:"分类",options:q}),e.jsx(F,{style:{width:"100%",marginTop:20},value:p,onChange:t=>{Z(t)},allowClear:!0,placeholder:"讲师",options:H}),e.jsx(F,{style:{width:"100%",marginTop:20},value:b,onChange:t=>{L(t)},allowClear:!0,placeholder:"状态",options:J})]})}):null]})};export{Me as default};
