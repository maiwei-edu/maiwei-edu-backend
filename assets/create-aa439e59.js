import{u as L,b as O,r as a,t as T,j as e,I as n,S as l,B as y,m as i}from"./index-3fd54424.js";import{c as z,f as G}from"./mock-e0c98417.js";import{B as K}from"./index-c3c15456.js";import{H as c}from"./index-d5d1e443.js";import{F as t}from"./index-0ca68444.js";import{S as N}from"./index-ff4e3b6e.js";import{S as _}from"./index-27712364.js";import"./LeftOutlined-a0f8cfa6.js";import"./InfoCircleOutlined-fefc69ce.js";import"./row-98a37fbf.js";import"./responsiveObserver-a0dea2e5.js";import"./useIcons-235bc0cd.js";import"./CheckOutlined-44e74bd9.js";const ae=()=>{const q=L(),p=O(),[d]=t.useForm(),[I,u]=a.useState(!1),[F,g]=a.useState(0),[S,f]=a.useState(0),[w,b]=a.useState(0),[x,V]=a.useState([]),[k,P]=a.useState([]),[B,E]=a.useState([]),[r,M]=a.useState({});a.useEffect(()=>{document.title="新建模拟试卷",q(T("新建模拟试卷")),d.setFieldsValue({is_invite:0,is_free:0,is_vip_free:0}),g(0),f(0)},[]),a.useEffect(()=>{H()},[x]);const H=()=>{z({category_ids:x}).then(s=>{let o=s.data.categories;const j=[];for(let m=0;m<o.length;m++)j.push({label:o[m].name,value:o[m].id});P(j);let h=s.data.question_categories;const C=[];for(let m=0;m<h.length;m++)C.push({label:h[m].name,value:h[m].id});E(C),M(s.data.count_map)})},R=s=>{if(I)return;if(s.is_invite===0&&s.is_free===0&&!s.charge){i.error("价格不能为空");return}if(s.charge<0){i.error("价格不能为负数");return}if(s.choice>0||s.select>0||s.input>0||s.qa>0||s.judge>0||s.cap>0){if(s.choice>r[1]){i.error("单选题数量超出可抽取单选题总量");return}if(s.select>r[2]){i.error("多选题数量超出可抽取多选题总量");return}if(s.input>r[3]){i.error("填空题数量超出可抽取填空题总量");return}if(s.qa>r[4]){i.error("问答题数量超出可抽取问答题总量");return}if(s.judge>r[5]){i.error("判断题数量超出可抽取判断题总量");return}if(s.cap>r[6]){i.error("题帽题数量超出可抽取题帽题总量");return}if(s.choice<0){i.error("单选题数量不能为负数");return}if(s.select<0){i.error("多选题数量不能为负数");return}if(s.input<0){i.error("填空题数量不能为负数");return}if(s.qa<0){i.error("问答题数量不能为负数");return}if(s.judge<0){i.error("判断题数量不能为负数");return}if(s.cap<0){i.error("题帽题数量不能为负数");return}s.is_invite===0&&s.is_free===1&&(s.charge=0,b(0)),s.choice||(s.choice=0),s.select||(s.select=0),s.judge||(s.judge=0),s.input||(s.input=0),s.qa||(s.qa=0),s.cap||(s.cap=0)}u(!0);let o={category_ids:x,num:{choice:s.choice,select:s.select,input:s.input,qa:s.qa,judge:s.judge,cap:s.cap}},j=JSON.stringify(o);G({rule:j,pass_score:s.pass_score,title:s.title,is_vip_free:s.is_vip_free,expired_minutes:s.expired_minutes,is_invite:s.is_invite,charge:w,category_id:s.category_id}).then(h=>{u(!1),i.success("保存成功！"),p(-1)}).catch(h=>{u(!1)})},v=s=>{console.log("Failed:",s)},A=s=>{s?(d.setFieldsValue({is_invite:1}),f(1)):(d.setFieldsValue({is_invite:0}),f(0))},D=s=>{s?(d.setFieldsValue({is_free:1,charge:0}),b(0),g(1)):(d.setFieldsValue({is_free:0}),g(0))},J=s=>{s?d.setFieldsValue({is_vip_free:1}):d.setFieldsValue({is_vip_free:0})};return e.jsxs("div",{className:"meedu-main-body",children:[e.jsx(K,{title:"新建模拟试卷"}),e.jsx("div",{className:"float-left mt-30",children:e.jsxs(t,{form:d,name:"mockPaper-create",labelCol:{span:3},wrapperCol:{span:21},initialValues:{remember:!0},onFinish:R,onFinishFailed:v,autoComplete:"off",children:[e.jsx(t.Item,{label:"标题",name:"title",rules:[{required:!0,message:"请输入试卷标题!"}],children:e.jsx(n,{style:{width:300},placeholder:"请输入试卷标题",allowClear:!0})}),e.jsx(t.Item,{label:"分类",name:"category_id",rules:[{required:!0,message:"请选择分类!"}],children:e.jsxs(l,{align:"baseline",style:{height:32},children:[e.jsx(t.Item,{name:"category_id",rules:[{required:!0,message:"请选择分类!"}],children:e.jsx(N,{style:{width:300},allowClear:!0,placeholder:"请选择分类",options:k})}),e.jsx(y,{type:"link",className:"c-primary",onClick:()=>{p("/exam/paper/category/index")},children:"分类管理"})]})}),e.jsx(t.Item,{label:"时间",name:"expired_minutes",rules:[{required:!0,message:"请输入时间!"}],children:e.jsx(n,{type:"number",style:{width:300},placeholder:"单位：分钟",allowClear:!0})}),e.jsx(t.Item,{label:"及格分",name:"pass_score",rules:[{required:!0,message:"请输入及格分!"}],children:e.jsx(n,{type:"number",style:{width:300},placeholder:"请输入及格分",allowClear:!0})}),e.jsx(t.Item,{label:"仅添加学员",name:"is_invite",children:e.jsxs(l,{align:"baseline",style:{height:32},children:[e.jsx(t.Item,{name:"is_invite",valuePropName:"checked",children:e.jsx(_,{onChange:A})}),e.jsx("div",{className:"ml-10",children:e.jsx(c,{text:"开启仅添加学员的话，只有后台添加的用户可以参与考试"})})]})}),S===0&&e.jsx(t.Item,{label:"免费参与",name:"is_free",children:e.jsxs(l,{align:"baseline",style:{height:32},children:[e.jsx(t.Item,{name:"is_free",valuePropName:"checked",children:e.jsx(_,{onChange:D})}),e.jsx("div",{className:"ml-10",children:e.jsx(c,{text:"开启所有用户均可直接考试。"})})]})}),F===0&&e.jsx(t.Item,{label:"价格",name:"charge",rules:[{required:!0,message:"请输入价格!"}],children:e.jsxs(l,{align:"baseline",style:{height:32},children:[e.jsx(t.Item,{name:"charge",rules:[{required:!0,message:"请输入价格!"}],children:e.jsx(n,{onChange:s=>{b(Number(s.target.value))},type:"number",style:{width:300},placeholder:"单位：元",allowClear:!0})}),e.jsx("div",{className:"ml-10",children:e.jsx(c,{text:"请输入整数"})})]})}),w>0&&e.jsx(t.Item,{label:"VIP免费",name:"is_vip_free",children:e.jsxs(l,{align:"baseline",style:{height:32},children:[e.jsx(t.Item,{name:"is_vip_free",valuePropName:"checked",children:e.jsx(_,{onChange:J})}),e.jsx("div",{className:"ml-10",children:e.jsx(c,{text:"设置VIP免费的话，则VIP会员用户可以无需购买直接参与考试。"})})]})}),e.jsx(t.Item,{label:"试题随机范围",name:"category_ids",rules:[{required:!0,message:"请选择试题范围!"}],children:e.jsx(N,{style:{width:300},allowClear:!0,mode:"multiple",placeholder:"请选择范围",options:B,onChange:s=>{V(s)}})}),x.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(t.Item,{label:"单选题数量",name:"choice",children:e.jsxs(l,{align:"baseline",style:{height:32},children:[e.jsx(t.Item,{name:"choice",children:e.jsx(n,{type:"number",style:{width:300},placeholder:"请输入整数",allowClear:!0})}),e.jsx("div",{className:"ml-10",children:e.jsxs("span",{children:["（共",r[1],"题）"]})}),e.jsx("div",{className:"ml-10",children:e.jsx(c,{text:"每次考试抽出的单选题数量"})})]})}),e.jsx(t.Item,{label:"多选题数量",name:"select",children:e.jsxs(l,{align:"baseline",style:{height:32},children:[e.jsx(t.Item,{name:"select",children:e.jsx(n,{type:"number",style:{width:300},placeholder:"请输入整数",allowClear:!0})}),e.jsx("div",{className:"ml-10",children:e.jsxs("span",{children:["（共",r[2],"题）"]})}),e.jsx("div",{className:"ml-10",children:e.jsx(c,{text:"每次考试抽出的多选题数量"})})]})}),e.jsx(t.Item,{label:"判断题数量",name:"judge",children:e.jsxs(l,{align:"baseline",style:{height:32},children:[e.jsx(t.Item,{name:"judge",children:e.jsx(n,{type:"number",style:{width:300},placeholder:"请输入整数",allowClear:!0})}),e.jsx("div",{className:"ml-10",children:e.jsxs("span",{children:["（共",r[5],"题）"]})}),e.jsx("div",{className:"ml-10",children:e.jsx(c,{text:"每次考试抽出的判断题数量"})})]})}),e.jsx(t.Item,{label:"填空题数量",name:"input",children:e.jsxs(l,{align:"baseline",style:{height:32},children:[e.jsx(t.Item,{name:"input",children:e.jsx(n,{type:"number",style:{width:300},placeholder:"请输入整数",allowClear:!0})}),e.jsx("div",{className:"ml-10",children:e.jsxs("span",{children:["（共",r[3],"题）"]})}),e.jsx("div",{className:"ml-10",children:e.jsx(c,{text:"每次考试抽出填空题数量"})})]})}),e.jsx(t.Item,{label:"问答题数量",name:"qa",children:e.jsxs(l,{align:"baseline",style:{height:32},children:[e.jsx(t.Item,{name:"qa",children:e.jsx(n,{type:"number",style:{width:300},placeholder:"请输入整数",allowClear:!0})}),e.jsx("div",{className:"ml-10",children:e.jsxs("span",{children:["（共",r[4],"题）"]})}),e.jsx("div",{className:"ml-10",children:e.jsx(c,{text:"每次考试抽出问答题数量"})})]})}),e.jsx(t.Item,{label:"题帽题数量",name:"cap",children:e.jsxs(l,{align:"baseline",style:{height:32},children:[e.jsx(t.Item,{name:"cap",children:e.jsx(n,{type:"number",style:{width:300},placeholder:"请输入整数",allowClear:!0})}),e.jsx("div",{className:"ml-10",children:e.jsxs("span",{children:["（共",r[6],"题）"]})}),e.jsx("div",{className:"ml-10",children:e.jsx(c,{text:"每次考试抽出题帽题数量"})})]})})]})]})}),e.jsx("div",{className:"bottom-menus",children:e.jsxs("div",{className:"bottom-menus-box",children:[e.jsx("div",{children:e.jsx(y,{loading:I,type:"primary",onClick:()=>d.submit(),children:"保存"})}),e.jsx("div",{className:"ml-24",children:e.jsx(y,{type:"default",onClick:()=>p(-1),children:"取消"})})]})})]})};export{ae as default};
