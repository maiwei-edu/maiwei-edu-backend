import{u as ce,b as de,r as s,t as he,j as e,B as f,I as g,S as ue,m as W,h as q,d as G,E as me,M as pe}from"./index-3fd54424.js";import{a as J,b as xe}from"./order-c5ad5adc.js";import{B as fe}from"./index-c3c15456.js";import{P as ge}from"./index-df05a090.js";import{u as je,w as we}from"./xlsx-b055c42d.js";import{f as ye,a as ve}from"./icon-filter-h-a57243b6.js";import{a as Ce,w as C}from"./wepay-fe568e4a.js";import{c as Se}from"./card-da9446d6.js";import{S as h}from"./index-ff4e3b6e.js";import{T as _e}from"./Table-59a53b18.js";import{D as be}from"./index-88bdc632.js";import{D as Ne}from"./index-a9db941d.js";import"./LeftOutlined-a0f8cfa6.js";import"./useIcons-235bc0cd.js";import"./CheckOutlined-44e74bd9.js";import"./addEventListener-1752243f.js";import"./Pagination-a2ebdf00.js";import"./useForceUpdate-56773729.js";import"./responsiveObserver-a0dea2e5.js";import"./index-a56efb1a.js";import"./iconUtil-14ff0944.js";const{confirm:ke}=pe,{RangePicker:De}=Ne,Ve=()=>{const Q=ce();de();const[j,n]=s.useState(!1),[U,S]=s.useState([]),[_,w]=s.useState(1),[b,P]=s.useState(10),[T,V]=s.useState(0),[u,y]=s.useState(!1),[X,m]=s.useState(!1),[F,M]=s.useState(!1),[o,N]=s.useState(0),[r,k]=s.useState([]),[p,L]=s.useState([]),[Z,E]=s.useState([]),[i,D]=s.useState(""),[c,I]=s.useState(""),[x,B]=s.useState(""),[d,Y]=s.useState(-1),R=[{value:"alipay",label:"支付宝支付"},{value:"wechat",label:"微信支付"},{value:"handPay",label:"线下打款"}],z=[{value:-1,label:"退款类型"},{value:0,label:"原渠道退回"},{value:1,label:"线下退款（线上记录）"}],A=[{value:0,label:"退款状态"},{value:1,label:"待处理"},{value:5,label:"退款成功"},{value:9,label:"退款异常"},{value:13,label:"退款已关闭"}];s.useEffect(()=>{document.title="退款订单",Q(he("退款订单"))},[]),s.useEffect(()=>{p&&p.length>0||d!==-1||o!==0||x||r&&r.length>0||c||i?M(!0):M(!1)},[p,d,x,c,o,r,i]),s.useEffect(()=>{$()},[_,b,u]);const $=()=>{j||(n(!0),J({page:_,size:b,sort:"id",order:"desc",is_local:d,mobile:i,status:o,created_at:p,payment:r,refund_no:c,order_no:x}).then(a=>{S(a.data.data.data),V(a.data.data.total),n(!1)}).catch(a=>{n(!1)}))},H=()=>{w(1),P(10),S([]),N(0),k([]),E([]),L([]),D(""),I(""),B(""),Y(-1),y(!u)},ee=()=>{if(j)return;n(!0),J({page:1,size:T,is_local:d,mobile:i,status:o,created_at:p,payment:r,refund_no:c,order_no:x}).then(t=>{if(t.data.data.total===0){W.error("数据为空"),n(!1);return}let re="退款订单.xlsx",O="sheet1",K=[["ID","学员ID","学员","退款单号","退款类型","支付渠道","退款金额","状态","到账时间","提交时间"]];t.data.data.data.forEach(l=>{let v;l.status===1?v="待处理":l.status===5?v="退款成功":l.status===9&&(v="退款已关闭"),K.push([l.id,l.user?l.user.id:"用户已删除",l.user?l.user.nick_name:"用户已删除",l.refund_no,l.is_local===1?"线下退款":"原渠道退回",l.payment===""?"-":l.payment,"¥"+l.amount/100,v,l.status===5?q(l.success_at).format("YYYY-MM-DD HH:mm"):"",l.created_at?q(l.created_at).format("YYYY-MM-DD HH:mm"):""])});const oe=je.json_to_sheet(K),ie={SheetNames:[O],Sheets:{[O]:oe}};we(ie,re),n(!1)})},ae={current:_,pageSize:b,total:T,onChange:(a,t)=>te(a,t),showSizeChanger:!0},te=(a,t)=>{w(a),P(t)},se=[{title:"ID",width:120,render:(a,t)=>e.jsx("span",{children:t.id})},{title:"学员",width:300,render:(a,t)=>e.jsxs(e.Fragment,{children:[t.user&&t.user.length!==0&&e.jsxs("div",{className:"user-item d-flex",children:[e.jsx("div",{className:"avatar",children:e.jsx("img",{src:t.user.avatar,width:"40",height:"40"})}),e.jsx("div",{className:"ml-10",children:t.user.nick_name})]}),(!t.user||t.user.length===0)&&e.jsx("span",{className:"c-red",children:"学员不存在"})]})},{title:"退款单号",width:300,dataIndex:"refund_no",render:a=>e.jsx("span",{children:a})},{title:"退款类型",width:120,render:(a,t)=>e.jsxs(e.Fragment,{children:[t.is_local===1&&e.jsx("span",{children:"线下退款"}),t.is_local!==1&&e.jsx("span",{children:"原渠道退回"})]})},{title:"支付渠道",width:150,render:(a,t)=>e.jsxs(e.Fragment,{children:[t.payment==="alipay"&&e.jsx("img",{src:Ce,width:"30",height:"30"}),t.payment==="wechat"&&e.jsx("img",{src:C,width:"30",height:"30"}),t.payment==="wechat_h5"&&e.jsx("img",{src:C,width:"30",height:"30"}),t.payment==="wechat-jsapi"&&e.jsx("img",{src:C,width:"30",height:"30"}),t.payment==="wechatApp"&&e.jsx("img",{src:C,width:"30",height:"30"}),t.payment==="handPay"&&e.jsx("img",{src:Se,width:"30",height:"30"}),t.payment===""&&e.jsx("span",{children:"-"})]})},{title:"退款金额",render:(a,t)=>e.jsxs("span",{children:["¥",t.amount/100]})},{title:"状态",width:220,render:(a,t)=>e.jsxs(e.Fragment,{children:[t.status===5&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"c-green mb-10",children:"· 退款成功"}),e.jsx("br",{}),e.jsx("span",{className:"c-gray",children:G(t.success_at)})]}),t.status===13&&e.jsx("span",{className:"c-red",children:"· 退款已关闭"}),t.status===1&&e.jsx("span",{className:"c-yellow",children:"· 待处理"}),t.status===9&&e.jsx("span",{children:"· 退款异常"})]})},{title:"时间",width:200,dataIndex:"created_at",render:a=>e.jsx("span",{children:G(a)})},{title:"操作",width:80,render:(a,t)=>e.jsx(ge,{type:"link",text:"删除",class:"c-red",icon:null,p:"order.refund.delete",onClick:()=>{le(t.id)},disabled:null})}],le=a=>{a!==0&&ke({title:"操作确认",icon:e.jsx(me,{}),content:"确认删除此订单记录？",centered:!0,okText:"确认",cancelText:"取消",onOk(){j||(n(!0),xe(a).then(()=>{n(!1),W.success("删除成功"),ne()}).catch(t=>{n(!1)}))},onCancel(){console.log("Cancel")}})},ne=()=>{S([]),y(!u)};return e.jsxs("div",{className:"meedu-main-body",children:[e.jsx(fe,{title:"退款订单"}),e.jsxs("div",{className:"float-left j-b-flex mb-30 mt-30",children:[e.jsx("div",{className:"d-flex",children:e.jsx(f,{type:"primary",onClick:()=>ee(),children:"导出表格"})}),e.jsxs("div",{className:"d-flex",children:[e.jsx(h,{style:{width:150},value:r,onChange:a=>{k(a)},allowClear:!0,placeholder:"支付渠道",options:R}),e.jsx(g,{value:i,onChange:a=>{D(a.target.value)},allowClear:!0,style:{width:150,marginLeft:10},placeholder:"手机号"}),e.jsx(g,{value:c,onChange:a=>{I(a.target.value)},allowClear:!0,style:{width:150,marginLeft:10},placeholder:"退款单号"}),e.jsx(h,{style:{width:150,marginLeft:10},value:d,onChange:a=>{Y(a)},allowClear:!0,placeholder:"退款类型",options:z}),e.jsx(h,{style:{width:150,marginLeft:10},value:o,onChange:a=>{N(a)},allowClear:!0,placeholder:"退款状态",options:A}),e.jsx(f,{className:"ml-10",onClick:H,children:"清空"}),e.jsx(f,{className:"ml-10",type:"primary",onClick:()=>{w(1),y(!u),m(!1)},children:"筛选"}),e.jsxs("div",{className:"drawerMore d-flex ml-10",onClick:()=>m(!0),children:[F&&e.jsxs(e.Fragment,{children:[e.jsx("img",{src:ye}),e.jsx("span",{className:"act",children:"已选"})]}),!F&&e.jsxs(e.Fragment,{children:[e.jsx("img",{src:ve}),e.jsx("span",{children:"更多"})]})]})]})]}),e.jsx("div",{className:"float-left",children:e.jsx(_e,{loading:j,columns:se,dataSource:U,rowKey:a=>a.id,pagination:ae})}),X?e.jsx(be,{title:"更多筛选",onClose:()=>m(!1),maskClosable:!1,open:!0,footer:e.jsxs(ue,{className:"j-b-flex",children:[e.jsx(f,{onClick:()=>{H(),m(!1)},children:"清空"}),e.jsx(f,{onClick:()=>{w(1),y(!u),m(!1)},type:"primary",children:"筛选"})]}),width:360,children:e.jsxs("div",{className:"float-left",children:[e.jsx(h,{style:{width:"100%"},value:r,onChange:a=>{k(a)},allowClear:!0,placeholder:"支付渠道",options:R}),e.jsx(g,{value:i,onChange:a=>{D(a.target.value)},allowClear:!0,style:{marginTop:20},placeholder:"手机号"}),e.jsx(g,{value:c,onChange:a=>{I(a.target.value)},allowClear:!0,style:{marginTop:20},placeholder:"退款单号"}),e.jsx(g,{value:x,onChange:a=>{B(a.target.value)},allowClear:!0,style:{marginTop:20},placeholder:"订单号"}),e.jsx(h,{style:{width:"100%",marginTop:20},value:d,onChange:a=>{Y(a)},allowClear:!0,placeholder:"退款类型",options:z}),e.jsx(h,{style:{width:"100%",marginTop:20},value:o,onChange:a=>{N(a)},allowClear:!0,placeholder:"退款状态",options:A}),e.jsx(De,{format:"YYYY-MM-DD",value:Z,style:{marginTop:20},onChange:(a,t)=>{L(t),E(a)},placeholder:["开始日期","结束日期"]})]})}):null]})};export{Ve as default};
