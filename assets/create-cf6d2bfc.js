import{u as K,b as O,r as l,t as z,j as t,I as G,B as b,m as f,h as v}from"./index-3fd54424.js";import{s as Q}from"./codeExchanger-51e29e94.js";import{B as U}from"./index-c3c15456.js";import{P as I}from"./index-df05a090.js";import{S as X}from"./multiIndex-bf3b379b.js";import{T as m}from"./index-04a133fc.js";import{p as Z}from"./default-paper-c83eabd4.js";import{v as $}from"./default-vip-add1d1c7.js";import{F as p}from"./index-0ca68444.js";import{D as k}from"./index-a9db941d.js";import{T as ee}from"./Table-59a53b18.js";import"./LeftOutlined-a0f8cfa6.js";import"./course-c58bd7af.js";import"./live-9d1ed6d0.js";import"./role-ccbd4852.js";import"./book-3be45c7b.js";import"./paper-57a0cabd.js";import"./practice-c882748e.js";import"./mock-e0c98417.js";import"./index-47408a6e.js";import"./PlusOutlined-18e71fec.js";import"./row-98a37fbf.js";import"./responsiveObserver-a0dea2e5.js";import"./addEventListener-1752243f.js";import"./useIcons-235bc0cd.js";import"./CheckOutlined-44e74bd9.js";import"./Pagination-a2ebdf00.js";import"./useForceUpdate-56773729.js";import"./index-ff4e3b6e.js";import"./index-a56efb1a.js";import"./iconUtil-14ff0944.js";const Ne=()=>{const[x]=p.useForm(),P=K(),j=O(),[d,h]=l.useState(!1),[s,o]=l.useState([]),[C,u]=l.useState(!1),[w,S]=l.useState([]),[Y,D]=l.useState([]),[_,M]=l.useState([]),[N,F]=l.useState([]),[B,V]=l.useState([]),[E,H]=l.useState([]),[T,R]=l.useState([]);l.useEffect(()=>{document.title="新建兑换活动",P(z("新建兑换活动"))},[]),l.useEffect(()=>{let i=[],e=[],a=[],n=[],c=[],g=[],y=[];if(s.length>0)for(let r=0;r<s.length;r++)s[r].type==="vod"?i.push(s[r].id):s[r].type==="live"?e.push(s[r].id):s[r].type==="paper"?a.push(s[r].id):s[r].type==="book"?n.push(s[r].id):s[r].type==="mock_paper"?c.push(s[r].id):s[r].type==="practice"?g.push(s[r].id):s[r].type==="vip"&&y.push(s[r].id);S(i),D(e),F(a),M(n),V(c),H(g),R(y)},[s]);const L=i=>{if(d)return;if(s.length===0){f.warning("请添加兑换活动包含商品");return}let e=[];if(s.length>0)for(let a=0;a<s.length;a++){let c={sign:s[a].type,id:s[a].id,name:s[a].title,thumb:s[a].thumb,charge:s[a].charge};e.push(c)}h(!0),i.relate_data=JSON.stringify(e),i.start_at=v(new Date(i.start_at)).format("YYYY-MM-DD HH:mm"),i.end_at=v(new Date(i.end_at)).format("YYYY-MM-DD HH:mm"),Q(i).then(a=>{h(!1),f.success("保存成功！"),j(-1)}).catch(a=>{h(!1)})},q=i=>{console.log("Failed:",i)},W=i=>{if(i[0].type==="vip")if(s.length>0){let e=[...s];for(let a=0;a<s.length;a++)s[a].type==="vip"&&(e.splice(a,1),f.warning("VIP会员只能选择一个，已自动删除之前选择的VIP会员"));e=e.concat(i),o(e)}else{let e=[...s];e=e.concat(i),o(e)}else{let e=[...s];e=e.concat(i),o(e)}u(!1)},A=[{title:"包含商品",render:(i,e)=>t.jsx(t.Fragment,{children:e.type==="book"?t.jsx(m,{value:e.thumb,width:90,height:120,title:e.title,border:4}):e.type==="paper"||e.type==="mock_paper"||e.type==="practice"?t.jsx(m,{value:Z,width:120,height:90,title:e.title,border:4}):e.type==="vip"?t.jsx(m,{value:$,width:120,height:90,title:e.title,border:4}):t.jsx(m,{value:e.thumb,width:120,height:90,title:e.title,border:4})})},{title:"商品类型",render:(i,e)=>t.jsxs(t.Fragment,{children:[e.type==="vod"&&t.jsx("span",{children:"录播课程"}),e.type==="live"&&t.jsx("span",{children:"直播课程"}),e.type==="book"&&t.jsx("span",{children:"电子书"}),e.type==="paper"&&t.jsx("span",{children:"考试"}),e.type==="mock_paper"&&t.jsx("span",{children:"模拟卷"}),e.type==="practice"&&t.jsx("span",{children:"练习"}),e.type==="vip"&&t.jsx("span",{children:"VIP会员"})]})},{title:"单品价格",render:(i,e)=>t.jsxs(t.Fragment,{children:[e.charge===0&&t.jsx("span",{children:"免费"}),e.charge!==0&&t.jsxs("span",{children:["￥",e.charge]})]})},{title:"操作",width:100,render:(i,e)=>t.jsx(I,{type:"link",text:"删除",class:"c-red",icon:null,p:"addons.CodeExchanger.activity.update",onClick:()=>{J(e.id)},disabled:null})}],J=i=>{const e=[...s],a=e.findIndex(n=>n.id===i);a>=0&&e.splice(a,1),e.length>0?o(e):o([])};return t.jsxs("div",{className:"meedu-main-body",children:[t.jsx(U,{title:"新建兑换活动"}),t.jsx(X,{type:!0,selectedVod:w,selectedLive:Y,selectedBook:_,selectedPaper:N,selectedMockPaper:B,selectedPractice:E,selectedVip:T,open:C,enabledResource:"vod,live,book,paper,mock_paper,practice,vip",onCancel:()=>u(!1),onSelected:i=>{W(i)}}),t.jsxs("div",{className:"float-left",children:[t.jsx("div",{className:"from-title mt-30",children:"兑换活动基本信息"}),t.jsxs(p,{form:x,name:"codeExchanger-create",labelCol:{span:3},wrapperCol:{span:21},initialValues:{remember:!0},onFinish:L,onFinishFailed:q,autoComplete:"off",children:[t.jsx(p.Item,{label:"活动名称",name:"name",rules:[{required:!0,message:"请输入活动名称!"}],children:t.jsx(G,{style:{width:300},placeholder:"请输入活动名称",allowClear:!0})}),t.jsx(p.Item,{label:"活动开始时间",name:"start_at",rules:[{required:!0,message:"请选择开始时间!"}],children:t.jsx(k,{format:"YYYY-MM-DD HH:mm",style:{width:300},showTime:!0,placeholder:"请选择开始时间"})}),t.jsx(p.Item,{label:"活动结束时间",name:"end_at",rules:[{required:!0,message:"请选择结束时间!"}],children:t.jsx(k,{format:"YYYY-MM-DD HH:mm",style:{width:300},showTime:!0,placeholder:"请选择结束时间"})})]}),t.jsx("div",{className:"from-title mt-30",children:"兑换活动包含商品"}),t.jsx("div",{className:"float-left mb-30",children:t.jsx(I,{type:"primary",text:"添加商品",class:"",icon:null,p:"addons.CodeExchanger.activity.store",onClick:()=>u(!0),disabled:null})}),t.jsx("div",{className:"float-left",children:t.jsx(ee,{loading:d,columns:A,dataSource:s,rowKey:i=>i.id,pagination:!1})}),t.jsx("div",{className:"bottom-menus",children:t.jsxs("div",{className:"bottom-menus-box",children:[t.jsx("div",{children:t.jsx(b,{loading:d,type:"primary",onClick:()=>x.submit(),children:"保存"})}),t.jsx("div",{className:"ml-24",children:t.jsx(b,{type:"default",onClick:()=>j(-1),children:"取消"})})]})})]})]})};export{Ne as default};
