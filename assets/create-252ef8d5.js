import{u as M,b as W,f as K,r as o,t as U,j as e,S as b,I as u,B as g,m as z}from"./index-3fd54424.js";import{m as G}from"./path-1a3bf99e.js";import{B as J}from"./index-c3c15456.js";import{P as y}from"./index-df05a090.js";import{H as v}from"./index-d5d1e443.js";import{S as O}from"./multiIndex-bf3b379b.js";import{T as x}from"./index-04a133fc.js";import{p as Q}from"./default-paper-c83eabd4.js";import{F as n}from"./index-0ca68444.js";import{T as X}from"./Table-59a53b18.js";import"./LeftOutlined-a0f8cfa6.js";import"./InfoCircleOutlined-fefc69ce.js";import"./course-c58bd7af.js";import"./live-9d1ed6d0.js";import"./role-ccbd4852.js";import"./book-3be45c7b.js";import"./paper-57a0cabd.js";import"./practice-c882748e.js";import"./mock-e0c98417.js";import"./index-47408a6e.js";import"./PlusOutlined-18e71fec.js";import"./row-98a37fbf.js";import"./responsiveObserver-a0dea2e5.js";import"./addEventListener-1752243f.js";import"./useIcons-235bc0cd.js";import"./CheckOutlined-44e74bd9.js";import"./Pagination-a2ebdf00.js";import"./useForceUpdate-56773729.js";import"./index-ff4e3b6e.js";import"./index-a56efb1a.js";import"./iconUtil-14ff0944.js";const Fe=()=>{const S=M(),f=W(),[j]=n.useForm(),I=new URLSearchParams(K().search),[p,d]=o.useState(!1),[s,m]=o.useState([]),[w,h]=o.useState(!1),[C,P]=o.useState([]),[k,N]=o.useState([]),[F,_]=o.useState([]),[B,L]=o.useState([]),[R,T]=o.useState([]),[q,Y]=o.useState(Number(I.get("path_id")));o.useEffect(()=>{document.title="添加学习步骤",S(U("添加学习步骤"))},[]),o.useEffect(()=>{let a=[],t=[],i=[],r=[],c=[];if(s.length>0)for(let l=0;l<s.length;l++)s[l].type==="vod"?a.push(s[l].id):s[l].type==="live"?t.push(s[l].id):s[l].type==="paper"?i.push(s[l].id):s[l].type==="book"?r.push(s[l].id):s[l].type==="practice"&&c.push(s[l].id);P(a),N(t),L(i),_(r),T(c)},[s]);const V=a=>{if(p)return;let t=[];if(s.length>0)for(let i=0;i<s.length;i++){let r=s[i].type;r==="vod"&&(r="course"),r==="practice"&&(r="paper_practice"),r==="paper"&&(r="paper_paper");let c={type:r,other_id:s[i].id,name:s[i].title,thumb:s[i].thumb,charge:s[i].charge};t.push(c)}d(!0),a.path_id=q,a.courses=t,G(a).then(i=>{d(!1),z.success("成功！"),f(-1)}).catch(i=>{d(!1)})},E=a=>{console.log("Failed:",a)},D=[{title:"关联课程",width:"53%",render:(a,t)=>e.jsx(e.Fragment,{children:t.type==="book"?e.jsx(x,{value:t.thumb,width:90,height:120,title:t.title,border:4}):t.type==="paper"||t.type==="practice"?e.jsx(x,{value:Q,width:120,height:90,title:t.title,border:4}):e.jsx(x,{value:t.thumb,width:120,height:90,title:t.title,border:4})})},{title:"课程类型",width:"20%",render:(a,t)=>e.jsxs(e.Fragment,{children:[t.type==="vod"&&e.jsx("span",{children:"录播课程"}),t.type==="live"&&e.jsx("span",{children:"直播课程"}),t.type==="book"&&e.jsx("span",{children:"电子书"}),t.type==="paper"&&e.jsx("span",{children:"考试"}),t.type==="practice"&&e.jsx("span",{children:"练习"})]})},{title:"单品价格",width:"21%",render:(a,t)=>e.jsxs(e.Fragment,{children:[t.charge===0&&e.jsx("span",{children:"免费"}),t.charge!==0&&e.jsxs("span",{children:["￥",t.charge]})]})},{title:"操作",width:"6%",render:(a,t)=>e.jsx(y,{type:"link",text:"删除",class:"c-red",icon:null,p:"addons.learnPaths.relation.update",onClick:()=>{A(t.id)},disabled:null})}],A=a=>{const t=[...s],i=t.findIndex(r=>r.id===a);i>=0&&t.splice(i,1),t.length>0?m(t):m([])},H=a=>{let t=[...s];t=t.concat(a),m(t),h(!1)};return e.jsxs("div",{className:"meedu-main-body",children:[e.jsx(J,{title:"添加学习步骤"}),e.jsx(O,{type:!0,selectedVod:C,selectedLive:k,selectedBook:F,selectedPaper:B,selectedMockPaper:[],selectedPractice:R,selectedVip:[],open:w,enabledResource:"vod,live,book,paper,practice",onCancel:()=>h(!1),onSelected:a=>{H(a)}}),e.jsxs("div",{className:"float-left",children:[e.jsx("div",{className:"from-title mt-30",children:"学习步骤基本信息"}),e.jsxs(n,{form:j,name:"learnPath-step-create",labelCol:{span:3},wrapperCol:{span:21},initialValues:{remember:!0},onFinish:V,onFinishFailed:E,autoComplete:"off",children:[e.jsx(n.Item,{label:"排序",name:"sort",rules:[{required:!0,message:"填输入排序!"}],children:e.jsxs(b,{align:"baseline",style:{height:32},children:[e.jsx(n.Item,{name:"sort",rules:[{required:!0,message:"填输入排序!"}],children:e.jsx(u,{type:"number",style:{width:300},placeholder:"填输入整数",allowClear:!0})}),e.jsx("div",{className:"ml-10",children:e.jsx(v,{text:"请输入整数。小数排在前，大数排在后。"})})]})}),e.jsx(n.Item,{label:"步骤名称",name:"name",rules:[{required:!0,message:"请输入步骤名称!"}],children:e.jsx(u,{style:{width:300},placeholder:"请输入步骤名称",allowClear:!0})}),e.jsx(n.Item,{label:"步骤简介",name:"desc",rules:[{required:!0,message:"请输入步骤简介!"}],children:e.jsxs(b,{align:"baseline",children:[e.jsx(n.Item,{name:"desc",rules:[{required:!0,message:"填输入步骤简介!"}],children:e.jsx(u.TextArea,{style:{width:800},placeholder:"请输入步骤简介",allowClear:!0,rows:4,maxLength:150})}),e.jsx("div",{className:"ml-10",children:e.jsx(v,{text:"请输入整数。小数排在前，大数排在后。"})})]})})]}),e.jsx("div",{className:"from-title mt-30",children:"学习步骤关联课程"}),e.jsx("div",{className:"float-left mb-30",children:e.jsx(y,{type:"primary",text:"添加课程",class:"",icon:null,p:"addons.learnPaths.relation.store",onClick:()=>h(!0),disabled:null})}),e.jsx("div",{className:"float-left",children:e.jsx(X,{loading:p,columns:D,dataSource:s,rowKey:a=>a.id,pagination:!1})}),e.jsx("div",{className:"bottom-menus",children:e.jsxs("div",{className:"bottom-menus-box",children:[e.jsx("div",{children:e.jsx(g,{loading:p,type:"primary",onClick:()=>j.submit(),children:"保存"})}),e.jsx("div",{className:"ml-24",children:e.jsx(g,{type:"default",onClick:()=>f(-1),children:"取消"})})]})})]})]})};export{Fe as default};
