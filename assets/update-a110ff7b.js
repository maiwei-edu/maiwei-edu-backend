import{f as B,u as H,b as M,r,t as L,j as e,g as V,S as d,I as h,B as I,h as E,m as R}from"./index-3fd54424.js";import{c as T,a as U,u as A}from"./path-1a3bf99e.js";import{B as $}from"./index-c3c15456.js";import{P as z}from"./index-df05a090.js";import{H as g}from"./index-d5d1e443.js";import{U as G}from"./index-edf85c8b.js";import{d as J,D as K}from"./index-a9db941d.js";import{F as t}from"./index-0ca68444.js";import{S as O}from"./index-ff4e3b6e.js";import{R as Q,C as _}from"./row-98a37fbf.js";import{S as W}from"./index-27712364.js";import"./LeftOutlined-a0f8cfa6.js";import"./InfoCircleOutlined-fefc69ce.js";import"./InboxOutlined-35d156a9.js";import"./selected-7e6221ce.js";import"./Dragger-3ad849c3.js";import"./useForceUpdate-56773729.js";import"./DeleteOutlined-529a4ffa.js";import"./CheckOutlined-44e74bd9.js";import"./useIcons-235bc0cd.js";import"./Pagination-a2ebdf00.js";import"./responsiveObserver-a0dea2e5.js";const ye=()=>{const u=new URLSearchParams(B().search),v=H(),p=M(),[i]=t.useForm(),[j,C]=r.useState(!0),[b,x]=r.useState(!1),[S,N]=r.useState([]),[f,y]=r.useState(""),[m,D]=r.useState(Number(u.get("id")));r.useEffect(()=>{document.title="编辑学习路径",v(L("编辑学习路径")),Y()},[m]),r.useEffect(()=>{D(Number(u.get("id"))),w()},[u.get("id")]);const Y=async()=>{await F(),await w(),C(!1)},F=async()=>{let s=(await T()).data.categories;const c=[];for(let l=0;l<s.length;l++)if(s[l].children.length>0){c.push({label:s[l].name,value:s[l].id});let o=s[l].children;for(let n=0;n<o.length;n++)o[n].name="|----"+o[n].name,c.push({label:o[n].name,value:o[n].id})}else c.push({label:s[l].name,value:s[l].id});N(c)},w=async()=>{if(m===0)return;var s=(await U(m)).data;i.setFieldsValue({category_id:s.category_id,name:s.name,thumb:s.thumb,is_show:s.is_show,desc:s.desc,original_charge:s.original_charge,charge:s.charge,published_at:J(s.published_at,"YYYY-MM-DD HH:mm")}),y(s.thumb)},k=a=>{b||(x(!0),a.published_at=E(new Date(a.published_at)).format("YYYY-MM-DD HH:mm"),A(m,a).then(s=>{x(!1),R.success("成功！"),p(-1)}).catch(s=>{x(!1)}))},q=a=>{console.log("Failed:",a)},P=a=>{a?i.setFieldsValue({is_show:1}):i.setFieldsValue({is_show:0})};return e.jsxs("div",{className:"meedu-main-body",children:[e.jsx($,{title:"编辑学习路径"}),j&&e.jsx("div",{className:"float-left text-center mt-30",children:e.jsx(V,{})}),e.jsxs("div",{style:{display:j?"none":"block"},className:"float-left mt-30",children:[e.jsxs(t,{form:i,name:"learnPath-update",labelCol:{span:3},wrapperCol:{span:21},initialValues:{remember:!0},onFinish:k,onFinishFailed:q,autoComplete:"off",children:[e.jsx(t.Item,{label:"所属分类",name:"category_id",rules:[{required:!0,message:"请选择所属分类!"}],children:e.jsxs(d,{align:"baseline",style:{height:32},children:[e.jsx(t.Item,{name:"category_id",rules:[{required:!0,message:"请选择所属分类!"}],children:e.jsx(O,{style:{width:300},allowClear:!0,placeholder:"请选择所属分类",options:S})}),e.jsx(z,{type:"link",text:"分类管理",class:"c-primary",icon:null,p:"addons.learnPaths.category.list",onClick:()=>{p("/learningpath/path/category/index")},disabled:null})]})}),e.jsx(t.Item,{label:"路径名称",name:"name",rules:[{required:!0,message:"请输入路径名称!"}],children:e.jsx(h,{style:{width:300},placeholder:"请输入路径名称",allowClear:!0})}),e.jsx(t.Item,{label:"路径封面",name:"thumb",rules:[{required:!0,message:"请上传路径封面!"}],children:e.jsxs(d,{align:"baseline",style:{height:32},children:[e.jsx(t.Item,{name:"thumb",rules:[{required:!0,message:"请上传路径封面!"}],children:e.jsx(G,{text:"选择图片",onSelected:a=>{i.setFieldsValue({thumb:a}),y(a)}})}),e.jsx("div",{className:"ml-10",children:e.jsx(g,{text:"长宽比4:3，建议尺寸：400x300像素"})})]})}),f&&e.jsxs(Q,{style:{marginBottom:22},children:[e.jsx(_,{span:3}),e.jsx(_,{span:21,children:e.jsx("div",{className:"normal-thumb-box",style:{backgroundImage:`url(${f})`,width:200,height:150}})})]}),e.jsx(t.Item,{label:"原价",name:"original_charge",rules:[{required:!0,message:"请输入原价!"}],children:e.jsx(h,{type:"number",style:{width:300},placeholder:"单位：元",allowClear:!0})}),e.jsx(t.Item,{label:"现价",name:"charge",rules:[{required:!0,message:"请输入现价!"}],children:e.jsx(h,{type:"number",style:{width:300},placeholder:"单位：元",allowClear:!0})}),e.jsx(t.Item,{label:"上架时间",required:!0,children:e.jsxs(d,{align:"baseline",style:{height:32},children:[e.jsx(t.Item,{name:"published_at",rules:[{required:!0,message:"请选择上架时间!"}],children:e.jsx(K,{format:"YYYY-MM-DD HH:mm",style:{width:300},showTime:!0,placeholder:"请选择上架时间"})}),e.jsx("div",{className:"ml-10",children:e.jsx(g,{text:"上架时间越晚，排序越靠前"})})]})}),e.jsx(t.Item,{label:"显示",name:"is_show",children:e.jsxs(d,{align:"baseline",style:{height:32},children:[e.jsx(t.Item,{name:"is_show",valuePropName:"checked",children:e.jsx(W,{onChange:P})}),e.jsx("div",{className:"ml-10",children:e.jsx(g,{text:"关闭后此路径在前台隐藏显示"})})]})}),e.jsx(t.Item,{label:"简短介绍",name:"desc",rules:[{required:!0,message:"请输入简短介绍!"}],children:e.jsx(h.TextArea,{style:{width:800},placeholder:"请输入简短介绍",allowClear:!0,rows:4,maxLength:150,showCount:!0})})]}),e.jsx("div",{className:"bottom-menus",children:e.jsxs("div",{className:"bottom-menus-box",children:[e.jsx("div",{children:e.jsx(I,{loading:b,type:"primary",onClick:()=>i.submit(),children:"保存"})}),e.jsx("div",{className:"ml-24",children:e.jsx(I,{type:"default",onClick:()=>p(-1),children:"取消"})})]})})]})]})};export{ye as default};
