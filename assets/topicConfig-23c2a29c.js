import{r as i,j as e,M as F,m as P,I,B as v,u as K,b as E,f as R,t as H,cx as M,g as A,cy as O}from"./index-3fd54424.js";import{l as D}from"./topic-e7e1a389.js";import{B as W}from"./index-c3c15456.js";import{H as $}from"./index-d5d1e443.js";import{T as U}from"./index-04a133fc.js";import{T as X}from"./Table-59a53b18.js";import{C as Y}from"./index-168de0e6.js";import{F as q}from"./index-0ca68444.js";import"./LeftOutlined-a0f8cfa6.js";import"./InfoCircleOutlined-fefc69ce.js";import"./addEventListener-1752243f.js";import"./useIcons-235bc0cd.js";import"./CheckOutlined-44e74bd9.js";import"./Pagination-a2ebdf00.js";import"./useForceUpdate-56773729.js";import"./responsiveObserver-a0dea2e5.js";import"./index-ff4e3b6e.js";import"./index-a56efb1a.js";import"./iconUtil-14ff0944.js";import"./row-98a37fbf.js";const G=m=>{const[u,h]=i.useState(!1),[S,C]=i.useState([]),[g,f]=i.useState(1),[r,l]=i.useState(10),[_,j]=i.useState(0),[d,p]=i.useState(!1),[b,w]=i.useState(""),[x,N]=i.useState([]);i.useEffect(()=>{m.open&&k()},[m.open,g,r,d]);const k=()=>{u||(h(!0),D({page:g,size:r,sort:"created_at",order:"desc",keywords:b}).then(a=>{C(a.data.data.data),j(a.data.data.total),h(!1)}).catch(a=>{h(!1)}))},s=()=>{f(1),l(10),C([]),w(""),p(!d)},t={current:g,pageSize:r,total:_,onChange:(a,c)=>o(a,c),showSizeChanger:!0},o=(a,c)=>{f(a),l(c)},n=[{title:"图文ID",width:120,render:(a,c)=>e.jsx("span",{children:c.id})},{title:"图文",render:(a,c)=>e.jsxs("div",{className:"d-flex",children:[e.jsx("div",{children:e.jsx("img",{src:c.thumb,width:"80",height:"60"})}),e.jsx("div",{className:"ml-15",children:c.title})]})}],y={onChange:(a,c)=>{let T=c,L=[];if(T){for(var z=0;z<T.length;z++)L.push(T[z].id);N(L)}},getCheckboxProps:a=>({disabled:m.selected.indexOf(a.id)!==-1})};return e.jsx(e.Fragment,{children:m.open?e.jsx(F,{title:"选择图文",closable:!1,onCancel:()=>{m.onCancel()},open:!0,width:900,maskClosable:!1,onOk:()=>{if(!x||x.length===0){P.error("请先选择内容");return}m.onSelected(x)},centered:!0,children:e.jsxs("div",{className:"float-left mt-20",style:{maxHeight:520,overflowX:"hidden",overflowY:"auto",marginBottom:10},children:[e.jsxs("div",{className:"float-left mb-15",children:[e.jsx(I,{value:b,onChange:a=>{w(a.target.value)},allowClear:!0,style:{width:150},placeholder:"关键字"}),e.jsx(v,{className:"ml-10",onClick:s,children:"清空"}),e.jsx(v,{className:"ml-10",type:"primary",onClick:()=>{f(1),p(!d)},children:"筛选"})]}),e.jsx("div",{className:"float-left mb-15",children:e.jsx(X,{rowSelection:{type:"checkbox",...y},loading:u,columns:n,dataSource:S,rowKey:a=>a.id,pagination:t})})]})}):null})},J="_item_16euz_8",B={"thumb-box":"_thumb-box_16euz_1",item:J,"btn-del":"_btn-del_16euz_15"},ge=()=>{const m=K(),u=E();q.useForm();const[h,S]=i.useState([]),[C,g]=i.useState([]),f=new URLSearchParams(R().search),[r,l]=i.useState(!1),[_,j]=i.useState(!1),[d,p]=i.useState([]);i.useEffect(()=>{document.title="图文推荐",m(H("图文推荐")),b()},[]);const b=()=>{r||(l(!0),M().then(s=>{let t=s.data.图文,o=[];for(let n in t)t[n].key==="meedu.addons.meedu_topics.pc_list_page_rec_ids"&&t[n].value&&t[n].value.length>0&&(o=t[n].value.split(",").map(Number),p(o));w(o)}).catch(s=>{l(!1)}))},w=s=>{D({page:1,size:1e5}).then(t=>{g(t.data.data.data),x(t.data.data.data,s),l(!1)}).catch(t=>{l(!1)})},x=(s,t)=>{let o=[];if(t.length>0)for(var n=0;n<t.length;n++){let y=s.find(a=>a.id===parseInt(t[n]));y&&o.push(y)}S(o)},N=()=>{r||(l(!0),O({config:{"meedu.addons.meedu_topics.pc_list_page_rec_ids":d.join(",")}}).then(s=>{l(!1),P.success("成功！"),b(),f.get("referer")?u(String(f.get("referer")),{replace:!0}):u(-1)}).catch(s=>{l(!1)}))},k=s=>{let t=[...h];t.splice(s,1),S(t);let o=[...d];o.splice(s,1),p(o)};return e.jsxs("div",{className:"meedu-main-body",children:[e.jsx(W,{title:"图文推荐"}),e.jsx(G,{selected:d,open:_,onCancel:()=>j(!1),onSelected:s=>{let t=[...d];t=t.concat(s),p(t),j(!1),x(C,t)}}),e.jsxs("div",{className:"float-left d-flex mt-30 mb-30",children:[e.jsx("div",{children:e.jsx(v,{type:"primary",onClick:()=>j(!0),children:"添加推荐"})}),e.jsx("div",{className:"ml-10",children:e.jsx($,{text:"添加推荐的图文会在PC端图文列表右侧悬浮展示"})})]}),r&&e.jsx("div",{style:{width:"100%",textAlign:"center",paddingTop:50,paddingBottom:30,boxSizing:"border-box"},children:e.jsx(A,{})}),!r&&d&&h&&h.length>0&&e.jsx("div",{className:B["thumb-box"],children:h.map((s,t)=>e.jsxs("div",{className:B.item,onClick:()=>k(t),children:[e.jsx("div",{className:B["btn-del"],children:e.jsx(Y,{})}),e.jsx(U,{width:80,value:s.thumb,height:60,title:"",border:4})]},s.id))}),e.jsx("div",{className:"bottom-menus",children:e.jsxs("div",{className:"bottom-menus-box",children:[e.jsx("div",{children:e.jsx(v,{loading:r,type:"primary",onClick:()=>N(),children:"保存"})}),e.jsx("div",{className:"ml-24",children:e.jsx(v,{type:"default",onClick:()=>u(-1),children:"取消"})})]})})]})};export{ge as default};
