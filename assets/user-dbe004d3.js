import{f as G,u as J,b as V,r as a,t as X,j as e,B as Z,S as $,E as ee,m as f,h as se,M as te}from"./index-3fd54424.js";import{b as w,e as ae,f as re}from"./practice-c882748e.js";import{B as ie}from"./index-c3c15456.js";import{P as x}from"./index-df05a090.js";import{u as ne,w as oe}from"./xlsx-b055c42d.js";import{U as ce}from"./index-dd790b41.js";import{T as le}from"./Table-59a53b18.js";import"./LeftOutlined-a0f8cfa6.js";import"./member-4894e8dc.js";import"./index-ff4e3b6e.js";import"./useIcons-235bc0cd.js";import"./CheckOutlined-44e74bd9.js";import"./index-a9db941d.js";import"./addEventListener-1752243f.js";import"./Pagination-a2ebdf00.js";import"./useForceUpdate-56773729.js";import"./responsiveObserver-a0dea2e5.js";import"./index-a56efb1a.js";import"./iconUtil-14ff0944.js";const{confirm:de}=te,Ee=()=>{const d=new URLSearchParams(G().search),P=J(),y=V(),[o,r]=a.useState(!1),[D,g]=a.useState([]),[u,j]=a.useState(1),[m,E]=a.useState(10),[_,B]=a.useState(0),[S,F]=a.useState(!1),[b,A]=a.useState(0),[c,U]=a.useState({}),[z,p]=a.useState(!1),[i,L]=a.useState(Number(d.get("id")));a.useEffect(()=>{document.title="参与学员",P(X("参与学员"))},[]),a.useEffect(()=>{L(Number(d.get("id")))},[d.get("id")]),a.useEffect(()=>{T()},[i,u,m,S]);const T=()=>{o||(r(!0),w(i,{page:u,size:m,id:i}).then(t=>{g(t.data.data.data),B(t.data.data.total),A(t.data.question_count),U(t.data.progress),r(!1)}).catch(t=>{r(!1)}))},q={current:u,pageSize:m,total:_,onChange:(t,s)=>M(t,s),showSizeChanger:!0},M=(t,s)=>{j(t),E(s)},Y=[{title:"学员ID",width:120,render:(t,s)=>e.jsx("span",{children:s.user_id})},{title:"学员",width:300,render:(t,s)=>e.jsxs(e.Fragment,{children:[s.user&&e.jsxs("div",{className:"user-item d-flex",children:[e.jsx("div",{className:"avatar",children:e.jsx("img",{src:s.user.avatar,width:"40",height:"40"})}),e.jsx("div",{className:"ml-10",children:s.user.nick_name})]}),!s.user&&e.jsx("span",{className:"c-red",children:"学员不存在"})]})},{title:"已练习",width:200,render:(t,s)=>e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:["总试题：",b,"题"]}),c[s.user_id]?e.jsxs("div",{className:"c-red",children:["已练习：",c[s.user_id].submit_count,"题"]}):e.jsx("div",{className:"c-red",children:"已练习：0题"})]})},{title:"练习进度",render:(t,s)=>e.jsx(e.Fragment,{children:c[s.user_id]?e.jsxs("div",{children:[(c[s.user_id].submit_count*100/b).toFixed(2),"%"]}):e.jsx("div",{children:"0%"})})},{title:"操作",width:120,fixed:"right",render:(t,s)=>e.jsxs($,{children:[e.jsx(x,{type:"link",text:"详细",class:"c-primary",icon:null,p:"addons.Paper.practice.user.progress",onClick:()=>{y("/exam/practice/progress?id="+i+"&pid="+s.user_id)},disabled:null}),e.jsx(x,{type:"link",text:"删除",class:"c-red",icon:null,p:"addons.Paper.practice.user.delete",onClick:()=>{I(s.user_id)},disabled:null})]})}],I=t=>{t!==0&&de({title:"操作确认",icon:e.jsx(ee,{}),content:"确认删除此学员？",centered:!0,okText:"确认",cancelText:"取消",onOk(){o||(r(!0),ae(i,{id:i,user_id:t}).then(()=>{r(!1),f.success("删除成功"),k()}).catch(s=>{r(!1)}))},onCancel(){console.log("Cancel")}})},R=t=>{o||(r(!0),re(i,{id:i,mobiles:t}).then(()=>{r(!1),f.success("成功"),p(!1),k()}).catch(s=>{r(!1)}))},k=()=>{j(1),g([]),F(!S)},W=()=>{if(o)return;r(!0),w(i,{page:1,size:_}).then(s=>{if(s.data.data.total===0){f.error("数据为空"),r(!1);return}let H=s.data.data.data,h=s.data.question_count,l=s.data.progress,K="练习进度|"+se().format("YYYY-MM-DD HH:mm:ss")+".xlsx",v="sheet1",C=[["用户ID","用户名","手机号","总题目数","已练习题目数","进度"]];H.forEach(n=>{if(!n.user)return;let N=0;h>0&&l[n.user_id]&&(N=(l[n.user_id].submit_count/h*100).toFixed(2)),C.push([n.user_id,n.user.nick_name,n.user.mobile,h,l[n.user_id]?l[n.user_id].submit_count:0,N+"%"])});const O=ne.json_to_sheet(C),Q={SheetNames:[v],Sheets:{[v]:O}};oe(Q,K),r(!1)})};return e.jsxs("div",{className:"meedu-main-body",children:[e.jsx(ie,{title:"参与学员"}),e.jsxs("div",{className:"float-left mb-30 mt-30",children:[e.jsx(x,{type:"primary",text:"添加学员",class:"",icon:null,p:"addons.Paper.practice.user.insert",onClick:()=>p(!0),disabled:null}),e.jsx(Z,{className:"ml-10",type:"primary",onClick:()=>W(),children:"导出记录"})]}),e.jsx("div",{className:"float-left",children:e.jsx(le,{loading:o,columns:Y,dataSource:D,rowKey:t=>t.id,pagination:q})}),e.jsx(ce,{type:"mobile",open:z,onCancel:()=>p(!1),onSuccess:t=>{R(t)}})]})};export{Ee as default};
