import{u as S,b as F,f as I,r,t as V,cx as N,j as e,g as A,I as d,B as x,cy as z,m as B,cz as D,cA as L}from"./index-b4683d61.js";import{B as R}from"./index-5f967da4.js";import{F as o}from"./index-d434f3eb.js";import{S as m}from"./index-c09cc6d7.js";import"./LeftOutlined-9e6e73a2.js";import"./row-4ee18533.js";import"./responsiveObserver-dc429d3b.js";import"./useIcons-e0af7133.js";import"./CheckOutlined-e6bc730e.js";const J=()=>{const y=S(),p=F(),[i]=o.useForm();new URLSearchParams(I().search);const[c,n]=r.useState(!0),[_,g]=r.useState([]),v=[{label:"华东1（杭州）/ 华东2（上海）",value:"cn-shanghai",host:"vod.cn-shanghai.aliyuncs.com"},{label:"华北2（北京）",value:"cn-beijing",host:"vod.cn-beijing.aliyuncs.com"},{label:"华北3（张家口）",value:"cn-zhangjiakou",host:"vod.cn-zhangjiakou.aliyuncs.com"},{label:"华南1（深圳）",value:"cn-shenzhen",host:"vod.cn-shenzhen.aliyuncs.com"}],j=[{label:"mp4",value:"mp4"},{label:"m3u8",value:"m3u8"}];r.useEffect(()=>{document.title="视频存储",y(V("视频存储")),h()},[]);const h=()=>{N().then(a=>{let t=a.data.视频;for(let l in t)if(t[l].key==="meedu.upload.video.aliyun.region")i.setFieldsValue({"meedu.upload.video.aliyun.region":t[l].value});else if(t[l].key==="meedu.upload.video.aliyun.host")i.setFieldsValue({"meedu.upload.video.aliyun.host":t[l].value});else if(t[l].key==="meedu.upload.video.aliyun.access_key_id")i.setFieldsValue({"meedu.upload.video.aliyun.access_key_id":t[l].value});else if(t[l].key==="meedu.upload.video.aliyun.access_key_secret")i.setFieldsValue({"meedu.upload.video.aliyun.access_key_secret":t[l].value});else if(t[l].key==="tencent.vod.app_id")i.setFieldsValue({"tencent.vod.app_id":t[l].value});else if(t[l].key==="tencent.vod.secret_id")i.setFieldsValue({"tencent.vod.secret_id":t[l].value});else if(t[l].key==="tencent.vod.secret_key")i.setFieldsValue({"tencent.vod.secret_key":t[l].value});else if(t[l].key==="meedu.system.player.tencent_play_key")i.setFieldsValue({"meedu.system.player.tencent_play_key":t[l].value});else if(t[l].key==="meedu.upload.video.default_service"){i.setFieldsValue({"meedu.upload.video.default_service":t[l].value});let u=[];t[l].option_value.map(f=>{u.push({label:f.title,value:f.key})}),g(u)}let s=a.data.播放器配置;for(let l in s)if(s[l].key==="meedu.system.player.video_format_whitelist"&&s[l].value&&s[l].value.length>0){let u=b(s[l].value);i.setFieldsValue({"meedu.system.player.video_format_whitelist":u.split(",")})}n(!1)}).catch(a=>{n(!1)})},b=a=>{let t=a.split(""),s="";for(let l=0;l<t.length;l++)t[l]>="A"&&t[l]<="Z"?s+=t[l].toLowerCase():s+=t[l];return s},w=()=>{D().then(a=>{let t={system:{logo:a.data.system.logo,url:{api:a.data.system.url.api,h5:a.data.system.url.h5,pc:a.data.system.url.pc}},video:{default_service:a.data.video.default_service}};y(L(t)),p(-1)})},k=a=>{if(c)return;a["meedu.system.player.video_format_whitelist"]&&(a["meedu.system.player.video_format_whitelist"]=a["meedu.system.player.video_format_whitelist"].join(","));let t=v.find(s=>s.value===a["meedu.upload.video.aliyun.region"]);t&&(a["meedu.upload.video.aliyun.host"]=t.host),n(!0),z({config:a}).then(s=>{n(!1),B.success("成功！"),h(),w()}).catch(s=>{n(!1)})},C=a=>{console.log("Failed:",a)};return e.jsxs("div",{className:"meedu-main-body",children:[e.jsx(R,{title:"视频存储"}),c&&e.jsx("div",{style:{width:"100%",textAlign:"center",paddingTop:50,paddingBottom:30,boxSizing:"border-box"},children:e.jsx(A,{})}),!c&&e.jsx("div",{className:"float-left",children:e.jsxs(o,{form:i,name:"system-videoSave-config",labelCol:{span:3},wrapperCol:{span:21},initialValues:{remember:!0},onFinish:k,onFinishFailed:C,autoComplete:"off",children:[e.jsx("div",{className:"from-title mt-30",children:"服务商配置"}),e.jsx(o.Item,{label:"视频存储默认服务",name:"meedu.upload.video.default_service",children:e.jsx(m,{style:{width:300},allowClear:!0,options:_})}),e.jsx("div",{className:"from-title mt-30",children:"阿里云视频"}),e.jsx(o.Item,{label:"阿里云视频Region",name:"meedu.upload.video.aliyun.region",children:e.jsx(m,{style:{width:300},allowClear:!0,options:v})}),e.jsx(o.Item,{label:"阿里云视频AccessKeyId",name:"meedu.upload.video.aliyun.access_key_id",children:e.jsx(d,{style:{width:300},allowClear:!0})}),e.jsx(o.Item,{label:"阿里云视频AccessKeySecret",name:"meedu.upload.video.aliyun.access_key_secret",children:e.jsx(d,{style:{width:300},allowClear:!0})}),e.jsx("div",{className:"from-title mt-30",children:"腾讯云视频"}),e.jsx(o.Item,{label:"腾讯云视频AppId",name:"tencent.vod.app_id",children:e.jsx(d,{style:{width:300},allowClear:!0})}),e.jsx(o.Item,{label:"腾讯云视频SecretId",name:"tencent.vod.secret_id",children:e.jsx(d,{style:{width:300},allowClear:!0})}),e.jsx(o.Item,{label:"腾讯云视频SecretKey",name:"tencent.vod.secret_key",children:e.jsx(d,{style:{width:300},allowClear:!0})}),e.jsx(o.Item,{label:"腾讯云播放key",name:"meedu.system.player.tencent_play_key",children:e.jsx(d,{style:{width:300},allowClear:!0})}),e.jsx("div",{className:"from-title mt-30",children:"播放格式白名单"}),e.jsx(o.Item,{label:"视频播放格式白名单",name:"meedu.system.player.video_format_whitelist",children:e.jsx(m,{mode:"multiple",style:{width:300},allowClear:!0,options:j,placeholder:"请选择"})})]})}),e.jsx("div",{className:"bottom-menus",children:e.jsxs("div",{className:"bottom-menus-box",children:[e.jsx("div",{children:e.jsx(x,{loading:c,type:"primary",onClick:()=>i.submit(),children:"保存"})}),e.jsx("div",{className:"ml-24",children:e.jsx(x,{type:"default",onClick:()=>p(-1),children:"取消"})})]})})]})};export{J as default};
