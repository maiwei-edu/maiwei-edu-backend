import{u as I,b as S,f as U,r as n,t as B,cx as A,l as L,j as e,g as P,I as i,B as x,cy as R,m as D}from"./index-3fd54424.js";import{B as E}from"./index-c3c15456.js";import{U as T}from"./index-edf85c8b.js";import{F as m}from"./index-0ca68444.js";import{S as h}from"./index-27712364.js";import{R as z,C as f}from"./row-98a37fbf.js";import"./LeftOutlined-a0f8cfa6.js";import"./InboxOutlined-35d156a9.js";import"./selected-7e6221ce.js";import"./Dragger-3ad849c3.js";import"./useForceUpdate-56773729.js";import"./DeleteOutlined-529a4ffa.js";import"./CheckOutlined-44e74bd9.js";import"./useIcons-235bc0cd.js";import"./Pagination-a2ebdf00.js";import"./responsiveObserver-a0dea2e5.js";import"./index-ff4e3b6e.js";const le=()=>{const g=I(),u=S(),[s]=m.useForm();new URLSearchParams(U().search);const[c,d]=n.useState(!0),[r,j]=n.useState(""),[b,y]=n.useState(""),[p,_]=n.useState("");n.useEffect(()=>{document.title="微信公众号",g(B("微信公众号")),w()},[]),n.useEffect(()=>{r&&y("微信公众号URL："+r+"api/wechat/serve")},[r]);const w=()=>{A().then(l=>{let a=l.data.微信公众号;for(let t in a)a[t].key==="meedu.mp_wechat.app_id"?s.setFieldsValue({"meedu.mp_wechat.app_id":a[t].value}):a[t].key==="meedu.mp_wechat.app_secret"?s.setFieldsValue({"meedu.mp_wechat.app_secret":a[t].value}):a[t].key==="meedu.mp_wechat.token"?s.setFieldsValue({"meedu.mp_wechat.token":a[t].value}):a[t].key==="meedu.mp_wechat.aes_key"?s.setFieldsValue({"meedu.mp_wechat.aes_key":a[t].value}):a[t].key==="meedu.mp_wechat.enabled_oauth_login"?s.setFieldsValue({"meedu.mp_wechat.enabled_oauth_login":Number(a[t].value)}):a[t].key==="meedu.mp_wechat.enabled_scan_login"?s.setFieldsValue({"meedu.mp_wechat.enabled_scan_login":Number(a[t].value)}):a[t].key==="meedu.mp_wechat.scan_login_alert"?s.setFieldsValue({"meedu.mp_wechat.scan_login_alert":a[t].value}):a[t].key==="meedu.mp_wechat.enabled_share"?s.setFieldsValue({"meedu.mp_wechat.enabled_share":Number(a[t].value)}):a[t].key==="meedu.mp_wechat.share.title"?s.setFieldsValue({"meedu.mp_wechat.share.title":a[t].value}):a[t].key==="meedu.mp_wechat.share.desc"?s.setFieldsValue({"meedu.mp_wechat.share.desc":a[t].value}):a[t].key==="meedu.mp_wechat.share.imgUrl"&&(s.setFieldsValue({"meedu.mp_wechat.share.imgUrl":a[t].value}),_(a[t].value));let o=l.data.系统;for(let t in o)if(o[t].key==="app.url"){let N=L(o[t].value);j(N);break}d(!1)}).catch(l=>{d(!1)})},v=l=>{c||(d(!0),R({config:l}).then(a=>{d(!1),D.success("成功！"),w(),u(-1)}).catch(a=>{d(!1)}))},k=l=>{console.log("Failed:",l)},F=l=>{l?s.setFieldsValue({"meedu.mp_wechat.enabled_oauth_login":1}):s.setFieldsValue({"meedu.mp_wechat.enabled_oauth_login":0})},C=l=>{l?s.setFieldsValue({"meedu.mp_wechat.enabled_scan_login":1}):s.setFieldsValue({"meedu.mp_wechat.enabled_scan_login":0})},V=l=>{l?s.setFieldsValue({"meedu.mp_wechat.enabled_share":1}):s.setFieldsValue({"meedu.mp_wechat.enabled_share":0})};return e.jsxs("div",{className:"meedu-main-body",children:[e.jsx(E,{title:"微信公众号"}),c&&e.jsx("div",{style:{width:"100%",textAlign:"center",paddingTop:50,paddingBottom:30,boxSizing:"border-box"},children:e.jsx(P,{})}),!c&&e.jsx("div",{className:"float-left",children:e.jsxs(m,{form:s,name:"system-mp_wechat-config",labelCol:{span:3},wrapperCol:{span:21},initialValues:{remember:!0},onFinish:v,onFinishFailed:k,autoComplete:"off",children:[e.jsx("div",{className:"from-title mt-30",children:"基础配置"}),e.jsxs(m.Item,{label:"AppId",name:"meedu.mp_wechat.app_id",children:[e.jsx(m.Item,{name:"meedu.mp_wechat.app_id",children:e.jsx(i,{style:{width:300},allowClear:!0})}),e.jsx("div",{className:"form-helper-text",children:e.jsx("span",{children:b})})]}),e.jsx(m.Item,{label:"AppSecret",name:"meedu.mp_wechat.app_secret",children:e.jsx(i,{style:{width:300},allowClear:!0})}),e.jsx(m.Item,{label:"Token",name:"meedu.mp_wechat.token",children:e.jsx(i,{style:{width:300},allowClear:!0})}),e.jsx(m.Item,{label:"AesKey",name:"meedu.mp_wechat.aes_key",children:e.jsx(i,{style:{width:300},allowClear:!0})}),e.jsx("div",{className:"from-title mt-30",children:"登录配置"}),e.jsx(m.Item,{label:"启用授权登录",name:"meedu.mp_wechat.enabled_oauth_login",valuePropName:"checked",children:e.jsx(h,{onChange:F})}),e.jsx(m.Item,{label:"启用PC扫码登录",name:"meedu.mp_wechat.enabled_scan_login",valuePropName:"checked",children:e.jsx(h,{onChange:C})}),e.jsx(m.Item,{label:"扫码登录成功回复信息",name:"meedu.mp_wechat.scan_login_alert",children:e.jsx(i.TextArea,{rows:6,style:{width:400,resize:"none"},allowClear:!0,showCount:!0,maxLength:200})}),e.jsx("div",{className:"from-title mt-30",children:"手机端分享"}),e.jsx(m.Item,{label:"启用微信分享",name:"meedu.mp_wechat.enabled_share",valuePropName:"checked",children:e.jsx(h,{onChange:V})}),e.jsx(m.Item,{label:"微信分享标题",name:"meedu.mp_wechat.share.title",children:e.jsx(i,{style:{width:300},allowClear:!0})}),e.jsx(m.Item,{label:"微信分享描述",name:"meedu.mp_wechat.share.desc",children:e.jsx(i,{style:{width:300},allowClear:!0})}),e.jsx(m.Item,{label:"微信分享图片",name:"meedu.mp_wechat.share.imgUrl",children:e.jsx(T,{text:"微信分享图片",onSelected:l=>{s.setFieldsValue({"meedu.mp_wechat.share.imgUrl":l}),_(l)}})}),p&&e.jsxs(z,{style:{marginBottom:22},children:[e.jsx(f,{span:3}),e.jsx(f,{span:21,children:e.jsx("div",{className:"float-left",children:e.jsx("img",{width:200,src:p})})})]})]})}),e.jsx("div",{className:"bottom-menus",children:e.jsxs("div",{className:"bottom-menus-box",children:[e.jsx("div",{children:e.jsx(x,{loading:c,type:"primary",onClick:()=>s.submit(),children:"保存"})}),e.jsx("div",{className:"ml-24",children:e.jsx(x,{type:"default",onClick:()=>u(-1),children:"取消"})})]})})]})};export{le as default};
