import{f as K,u as M,b as q,r as a,t as A,j as e,I as O,B as y,m as b,E as G,d as H,S as J,l as Q,n as V,M as W,q as X}from"./index-b4683d61.js";import{a as Y,b as Z}from"./certificate-285fae4b.js";import{B as $}from"./index-5f967da4.js";import{P as g}from"./index-573a6ce5.js";import{U as ee}from"./index-288d6393.js";import{T as te}from"./Table-76e623b5.js";import"./LeftOutlined-9e6e73a2.js";import"./course-7dc1c12e.js";import"./live-ef2dd82c.js";import"./xlsx-b055c42d.js";import"./index-9c2b15e9.js";import"./Dragger-1df363a5.js";import"./useForceUpdate-f2aff5e0.js";import"./DeleteOutlined-8e7e99fd.js";import"./CheckOutlined-e6bc730e.js";import"./addEventListener-a27ae3f4.js";import"./useIcons-e0af7133.js";import"./Pagination-d2c763c6.js";import"./responsiveObserver-dc429d3b.js";import"./index-c09cc6d7.js";import"./index-10f1a096.js";import"./iconUtil-f3f90360.js";const{confirm:se}=W,Ne=()=>{const l=new URLSearchParams(K().search),N=M();q();const[c,r]=a.useState(!1),[v,d]=a.useState([]),[m,o]=a.useState(1),[u,j]=a.useState(10),[_,D]=a.useState(0),[i,p]=a.useState(!1),[w,S]=a.useState(""),[h,x]=a.useState([]),[I,f]=a.useState(!1),[n,E]=a.useState(Number(l.get("id")));a.useEffect(()=>{document.title="证书授予学员",N(A("证书授予学员"))},[]),a.useEffect(()=>{E(Number(l.get("id")))},[l.get("id")]),a.useEffect(()=>{P()},[m,u,n,i]);const P=()=>{c||(r(!0),Y(n,{page:m,size:u,user_id:w}).then(t=>{d(t.data.data),D(t.data.total),r(!1)}).catch(t=>{r(!1)}))},U=()=>{o(1),j(10),d([]),x([]),S(""),p(!i)},B=()=>{if(h.length===0){b.error("请选择需要删除的学员");return}se({title:"操作确认",icon:e.jsx(G,{}),content:"确认删除授予选中的学员？",centered:!0,okText:"确认",cancelText:"取消",onOk(){c||(r(!0),Z(n,{user_ids:h}).then(()=>{r(!1),b.success("成功"),C()}).catch(t=>{r(!1)}))},onCancel(){console.log("Cancel")}})},C=()=>{o(1),d([]),x([]),p(!i)},L={current:m,pageSize:u,total:_,onChange:(t,s)=>R(t,s),showSizeChanger:!0},R=(t,s)=>{o(t),j(s)},T={selectedRowKeys:h,onChange:(t,s)=>{x(t)}},z=[{title:"学员ID",width:150,render:(t,s)=>e.jsx("span",{children:s.user_id})},{title:"学员",render:(t,s)=>e.jsxs(e.Fragment,{children:[s.user&&e.jsxs("div",{className:"user-item d-flex",children:[e.jsx("div",{className:"avatar",children:e.jsx("img",{src:s.user.avatar,width:"40",height:"40"})}),e.jsx("div",{className:"ml-10",children:s.user.nick_name})]}),!s.user&&e.jsx("span",{className:"c-red",children:"学员不存在"})]})},{title:"手机号",width:150,render:(t,s)=>{var k;return e.jsx("span",{children:(k=s.user)==null?void 0:k.mobile})}},{title:"证书编号",width:400,render:(t,s)=>e.jsx("span",{children:s.cert_no})},{title:"使用时间",width:200,dataIndex:"created_at",render:t=>e.jsx("span",{children:H(t)})},{title:"操作",width:100,render:(t,s)=>e.jsx(J,{children:e.jsx(g,{type:"link",text:"下载",class:"c-primary",icon:null,p:"addons.cert.download",onClick:()=>{F(s.user_id)},disabled:null})})}],F=t=>{window.open(Q(X.url)+"backend/addons/Cert/cert/"+n+"/"+t+"/download?token="+V())};return e.jsxs("div",{className:"meedu-main-body",children:[e.jsx($,{title:"证书授予学员"}),e.jsx(ee,{open:I,id:n,type:"cert",name:"证书授予批量导入模板",onCancel:()=>f(!1),onSuccess:()=>{f(!1),C()}}),e.jsxs("div",{className:"float-left j-b-flex mb-30 mt-30",children:[e.jsxs("div",{className:"d-flex",children:[e.jsx(g,{type:"primary",text:"批量授予",class:"",icon:null,p:"addons.cert.user.import",onClick:()=>f(!0),disabled:null}),e.jsx(g,{type:"danger",text:"撤销授予",class:"ml-10",icon:null,p:"addons.cert.user.destroy",onClick:()=>B(),disabled:null})]}),e.jsxs("div",{className:"d-flex",children:[e.jsx(O,{value:w,onChange:t=>{S(t.target.value)},allowClear:!0,style:{width:150},placeholder:"学员ID"}),e.jsx(y,{className:"ml-10",onClick:U,children:"清空"}),e.jsx(y,{className:"ml-10",type:"primary",onClick:()=>{o(1),p(!i)},children:"筛选"})]})]}),e.jsx("div",{className:"float-left",children:e.jsx(te,{rowSelection:{type:"checkbox",...T},loading:c,columns:z,dataSource:v,rowKey:t=>t.user_id,pagination:L})})]})};export{Ne as default};
