import{u as ye,b as Se,r as c,t as Ie,m as O,j as s,I as De,l as Re,B as y,D as Pe,bm as ze,q as Ee}from"./index-b4683d61.js";import{s as l,u as Ye,f as qe,t as Xe,d as Fe,i as Le,q as Be,c as M,l as Ve,h as We,D as He,R as Ae,a as Oe,b as _e,C as Ke}from"./index-57237ce9.js";import{s as Ue}from"./certificate-285fae4b.js";import{H as Q}from"./index-133d6e1c.js";import{U as Me}from"./index-4432445b.js";import{S as T}from"./multiIndex-16e2adee.js";import{F as S}from"./index-d434f3eb.js";import{R as Qe,C as J}from"./row-4ee18533.js";import{L as Te}from"./LeftOutlined-9e6e73a2.js";import"./index-1a122d3f.js";import"./InboxOutlined-1c6772bb.js";import"./selected-177ec16c.js";import"./Dragger-1df363a5.js";import"./useForceUpdate-f2aff5e0.js";import"./DeleteOutlined-8e7e99fd.js";import"./CheckOutlined-e6bc730e.js";import"./useIcons-e0af7133.js";import"./Pagination-d2c763c6.js";import"./responsiveObserver-dc429d3b.js";import"./index-c09cc6d7.js";import"./InfoCircleOutlined-4d24221b.js";import"./course-7dc1c12e.js";import"./Table-76e623b5.js";import"./addEventListener-a27ae3f4.js";import"./index-10f1a096.js";import"./iconUtil-f3f90360.js";import"./live-ef2dd82c.js";import"./role-513b287e.js";import"./book-a8b4ca06.js";import"./paper-7f0d6524.js";import"./practice-e65e37d7.js";import"./mock-274446b7.js";import"./index-d198db66.js";import"./PlusOutlined-c97c4cac.js";const zt=()=>{const[I]=S.useForm(),G=ye(),Y=Se(),[_,q]=c.useState(!1),[Z,K]=c.useState("上传背景"),[k,$]=c.useState(!1),[a,ee]=c.useState(""),[p,X]=c.useState(.5),[d,w]=c.useState(0),[h,N]=c.useState(106),[D,R]=c.useState(0),[P,z]=c.useState(0),[C,te]=c.useState(0),[E,se]=c.useState(0),[v,b]=c.useState(null),[ie,le]=c.useState(null),[n,m]=c.useState([]),[r,F]=c.useState([]),[u,L]=c.useState([]),[Je,ce]=c.useState(null),[ne,B]=c.useState(!1),[ae,V]=c.useState(!1),[re,oe]=c.useState([]),[de,he]=c.useState([]),[me,ue]=c.useState([]),W=c.useRef(0),H=c.useRef(0),g=c.useRef(0);c.useEffect(()=>{document.title="新建证书",G(Ie("新建证书"))},[]),c.useEffect(()=>(fe(),K(a?"重新上传":"上传背景"),window.addEventListener("mousewheel",U,{passive:!1}),ge(),()=>{window.removeEventListener("mousewheel",U,{passive:!1})}),[a,E,C]),c.useEffect(()=>{let t=[],e=[];if(r.length>0)for(let i=0;i<r.length;i++)r[i].type==="vod"?t.push(r[i].id):r[i].type==="live"&&e.push(r[i].id);oe(t),he(e)},[r]),c.useEffect(()=>{let t=[];if(u.length>0)for(let e=0;e<u.length;e++)u[e].type==="paper"&&t.push(u[e].id);ue(t)},[u]),c.useEffect(()=>{if(n&&n.length>0){let t=[];for(let e=0;e<n.length;e++)n[e]&&(n[e].sign==="text-v1"?t.push({text:n[e].config}):n[e].sign==="image-v1"?t.push({image:n[e].config}):n[e].sign==="qrcode-v1"&&t.push({qrcode:n[e].config}));I.setFieldsValue({params:t})}},[n]);const U=t=>{(t.ctrlKey||t.metaKey)&&(t.preventDefault(),t.deltaY>0?f(0):f(-1))};c.useEffect(()=>{W.current=d,H.current=h,g.current=p},[d,h,p]);const ge=()=>{document.onkeydown=t=>{let e=t||event||window.event;if((e.ctrlKey===!0||e.metaKey===!0)&&(e.which===61||e.which===107||e.which===173||e.which===109||e.which===187||e.which===189)&&(e.preventDefault(),e.which===187?f(0):e.which===189&&f(-1)),e&&e.keyCode==37){if(!a)return;let i=W.current-50;w(i)}else if(e&&e.keyCode==39){if(!a)return;let i=W.current+50;w(i)}else if(e&&e.keyCode==38){if(!a)return;let i=H.current-50;N(i)}else if(e&&e.keyCode==40){if(!a)return;let i=H.current+50;N(i)}}},fe=()=>{let t=new Image;t.src=a,t.onload=()=>{se(t.height),te(t.width),z(p*t.height),R(p*t.width),console.log("图片原始高度",t.height),console.log("图片原始宽度",t.width);let e=.5*(window.screen.width-p*t.width),i=106;w(e),N(i)}},xe=t=>{if(_)return;if(n.length===0){O.warning("请配置好证书元素");return}t.params=JSON.stringify(t.params);let e=[];r.length>0&&(e=e.concat(r)),u.length>0&&(e=e.concat(u)),t.courses=e,q(!0),Ue(t).then(i=>{q(!1),O.success("保存成功！"),Y(-1)}).catch(i=>{q(!1)})},pe=t=>{console.log("Failed:",t)},je=(t,e)=>{if(t){let i=[...n];i[v]=t,m(i),ce(e)}},f=t=>{if(!a){O.error("请上传证书背景后在改变缩放比例");return}if(t===-1){if(g.current===.25)return;let e=g.current-.25;X(e),z(e*E),R(e*C),w(.5*(window.screen.width-e*C)),N(106)}else if(t===0){if(g.current===2)return;let e=g.current+.25;X(e),z(e*E),R(e*C),w(.5*(window.screen.width-e*C)),N(106)}else{let e=t;X(e),z(e*E),R(e*C),w(.5*(window.screen.width-e*C)),N(106)}},ve=[{key:"1",label:s.jsx("span",{onClick:()=>f(2),children:"200%"})},{key:"2",label:s.jsx("span",{onClick:()=>f(1.5),children:"150%"})},{key:"3",label:s.jsx("span",{onClick:()=>f(1),children:"100%"})},{key:"4",label:s.jsx("span",{onClick:()=>f(.5),children:"50%"})},{key:"5",label:s.jsx("span",{onClick:()=>f(.25),children:"25%"})}],be=(t,e)=>{if(t){let i=[...n];i[v]=t,m(i),le(e)}},we=t=>{let e=[...r];e=e.concat(t),F(e),B(!1)},Ne=t=>{const e=[...r];e.splice(t,1),e.length>0?F(e):F([])},Ce=t=>{let e=[...u];e=e.concat(t),L(e),V(!1)},ke=t=>{const e=[...u];e.splice(t,1),e.length>0?L(e):L([])},A=t=>{let e=[...n];e.splice(t,1),m(e),b(null)};return s.jsx("div",{className:"content",children:s.jsx("div",{className:l["certificate-bg"],children:s.jsxs("div",{className:l["certificate-content"],children:[s.jsxs("div",{className:l["top-box"],children:[s.jsxs("div",{className:l["btn-back"],onClick:()=>Y(-1),children:[s.jsx(Te,{style:{marginRight:4}}),"返回"]}),s.jsx("div",{className:l.line}),s.jsx("div",{className:l.name,children:"新建证书"})]}),s.jsxs("div",{className:k?l["noleft-arrrow"]:l["left-arrrow"],onClick:()=>$(!k),children:[k&&s.jsx("img",{src:Ye,width:44,height:44}),!k&&s.jsx("img",{src:qe,width:44,height:44})]}),s.jsxs("div",{style:{display:k?"none":"block"},className:l["certificate-blocks-box"],children:[s.jsx("div",{className:l.title,children:"基本信息"}),s.jsx("div",{className:"float-left",children:s.jsxs(S,{form:I,name:"certificate-create",labelCol:{span:6},wrapperCol:{span:18},initialValues:{remember:!0},onFinish:xe,onFinishFailed:pe,autoComplete:"off",children:[s.jsx(S.Item,{label:"证书名称",name:"name",rules:[{required:!0,message:"请填写证书名称!"}],children:s.jsx(De,{style:{width:250},placeholder:"填写证书名称",allowClear:!0})}),s.jsx(S.Item,{label:"证书背景",name:"template_image",rules:[{required:!0,message:"请上传证书背景!"}],children:s.jsx(Me,{text:Z,onSelected:t=>{I.setFieldsValue({template_image:t}),ee(t)}})}),a&&s.jsxs(s.Fragment,{children:[s.jsxs(Qe,{style:{marginBottom:22},children:[s.jsx(J,{span:6}),s.jsx(J,{span:18,children:s.jsx("div",{className:l["left-preview-box"],children:s.jsx("img",{style:{maxWidth:180,width:"auto",maxHeight:240},src:a})})})]}),s.jsx(S.Item,{label:"证书元素",name:"params",rules:[{required:!0,message:"请配置好证书元素!"}],children:s.jsx(Q,{text:"拖动元素到证书背景上编辑参数"})})]})]})}),a&&s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:l.blocks,children:[s.jsx("div",{draggable:!0,className:l["block-item"],id:"text-v1",onDragEnd:t=>{if(t.clientX<d||t.clientY<h||t.clientX>d+D||t.clientY>h+P)return;let e={x:(t.clientX-d)/g.current,y:(t.clientY-h)/g.current,font:"default",size:40,color:"#333333",text:"默认文字"},i=[...n];i.push({sign:"text-v1",config:e}),m(i),b(i.length-1)},children:s.jsxs("div",{className:l.btn,children:[s.jsx("div",{className:l.icon,children:s.jsx("img",{src:Xe,width:44,height:44})}),s.jsx("div",{className:l.name,children:"文本"})]})}),s.jsx("div",{draggable:!0,className:l["block-item"],id:"image-v1",onDragEnd:t=>{if(t.clientX<d||t.clientY<h||t.clientX>d+D||t.clientY>h+P)return;let e={x:(t.clientX-d)/g.current,y:(t.clientY-h)/g.current,width:200,height:200,url:Fe},i=[...n];i.push({sign:"image-v1",config:e}),m(i),b(i.length-1)},children:s.jsxs("div",{className:l.btn,children:[s.jsx("div",{className:l.icon,children:s.jsx("img",{src:Le,width:44,height:44})}),s.jsx("div",{className:l.name,children:"图片"})]})}),s.jsx("div",{className:l["block-item"],draggable:!0,id:"qrcode-v1",onDragEnd:t=>{if(t.clientX<d||t.clientY<h||t.clientX>d+D||t.clientY>h+P)return;let e={x:(t.clientX-d)/g.current,y:(t.clientY-h)/g.current,width:200,height:200,text:Re(Ee.url)+"addons/Cert/dist/index.html"},i=[...n];i.push({sign:"qrcode-v1",config:e}),m(i),b(i.length-1)},children:s.jsxs("div",{className:l.btn,children:[s.jsx("div",{className:l.icon,children:s.jsx("img",{src:Be,width:44,height:44})}),s.jsx("div",{className:l.name,children:"证书二维码"})]})})]}),s.jsxs("div",{className:"d-flex float-left mt-30",children:[s.jsx("div",{className:l.label,children:"关联学习"}),s.jsx(Q,{text:"添加证书二维码查询"})]}),s.jsxs("div",{className:"float-left mt-30",children:[s.jsxs("div",{className:"d-flex float-left",children:[s.jsx("div",{className:l["label-item"],children:"关联课程"}),s.jsx(y,{onClick:()=>B(!0),children:"添加关联"}),s.jsx(T,{type:!0,selectedVod:re,selectedLive:de,selectedBook:[],selectedPaper:[],selectedMockPaper:[],selectedPractice:[],selectedVip:[],open:ne,enabledResource:"vod,live",onCancel:()=>B(!1),onSelected:t=>{we(t)}})]}),r.length>0&&s.jsx("div",{className:l["courses-multi-box"],children:r.map((t,e)=>s.jsxs("div",{className:l["courses-multi-item"],children:[s.jsx("img",{src:M,className:l.close,width:15,height:15,onClick:()=>{Ne(e)}}),s.jsx("img",{src:t.thumb,width:80,height:60})]},e))}),s.jsxs("div",{className:"d-flex float-left mt-30",children:[s.jsx("div",{className:l["label-item"],children:"关联考试"}),s.jsx(y,{onClick:()=>V(!0),children:"添加关联"}),s.jsx(T,{type:!1,selectedVod:[],selectedLive:[],selectedBook:[],selectedPaper:me,selectedMockPaper:[],selectedPractice:[],selectedVip:[],open:ae,enabledResource:"paper",onCancel:()=>V(!1),onSelected:t=>{Ce(t)}})]}),u.length>0&&s.jsx("div",{className:l["paper-multi-box"],children:u.map((t,e)=>s.jsxs("div",{className:l["paper-multi-item"],children:[s.jsx("img",{src:M,className:l.close,width:15,height:15,onClick:()=>{ke(e)}}),t.title]},e))})]})]})]}),a&&s.jsxs("div",{className:v!==null?l["choose-right-size-box"]:l["choose-size-box"],children:[s.jsx("div",{className:l.tab_narrow,onClick:()=>f(-1),children:s.jsx("img",{src:Ve,width:12,height:12})}),s.jsx("div",{className:l.choose_size,children:s.jsx(Pe,{menu:{items:ve},children:s.jsxs("span",{children:[" ",p*100,"% "]})})}),s.jsx("div",{className:l.tab_enlarge,onClick:()=>f(0),children:s.jsx("img",{src:We,width:12,height:12})})]}),s.jsx(He,{handle:".image-box",bounds:{right:0,left:0,top:0,bottom:0},onDrag:t=>{w(t.x),N(t.y)},children:s.jsxs("div",{style:{width:D,height:P,top:h,left:d},className:"preview-box",children:[s.jsx("div",{style:{backgroundImage:"url("+a+")",backgroundPosition:"center center",backgroundSize:"cover",backgroundRepeat:"no-repeat"},className:"image-box"}),n.length>0&&n.map((t,e)=>t.sign==="image-v1"?s.jsx(Ae,{current:e,status:v,size:p,config:t.config,onChange:(i,j)=>{let o=[...n];o[e].config.width=i,o[e].config.height=j,m(o)},onDragend:(i,j,o)=>{let x=[...n];x[e].config.x=j,x[e].config.y=o,m(x)},onDel:i=>{A(i)},onActive:i=>{b(i)}},e):t.sign==="qrcode-v1"?s.jsx(Oe,{current:e,status:v,size:p,config:t.config,onChange:(i,j)=>{let o=[...n];o[e].config.width=i,o[e].config.height=j,m(o)},onDragend:(i,j,o)=>{let x=[...n];x[e].config.x=j,x[e].config.y=o,m(x)},onDel:i=>{A(i)},onActive:i=>{b(i)}},e):s.jsx(_e,{current:e,status:v,size:p,config:t.config,onDragend:(i,j,o)=>{let x=[...n];x[e].config.x=j,x[e].config.y=o,m(x)},onDel:i=>{A(i)},onActive:i=>{b(i)}},e))]})}),v!==null&&s.jsxs("div",{className:ie?l["act-certificate-config-box"]:l["certificate-config-box"],children:[s.jsx("div",{className:"float-left mb-15",children:s.jsx(y,{className:"ml-15 mt-15",icon:s.jsx(ze,{}),onClick:()=>{b(null)},children:"关闭配置"})}),s.jsx(Ke,{block:n[v],onCreate:(t,e)=>je(t,e),onChange:(t,e)=>be(t,e)})]}),s.jsx("div",{className:"bottom-menus",children:s.jsxs("div",{className:"bottom-menus-box",style:{left:0,zIndex:1e3},children:[s.jsx("div",{children:s.jsx(y,{loading:_,type:"primary",onClick:()=>I.submit(),children:"保存"})}),s.jsx("div",{className:"ml-24",children:s.jsx(y,{type:"default",onClick:()=>Y(-1),children:"取消"})})]})})]})})})};export{zt as default};
