import{f as P,u as L,b as R,r as a,t as v,j as e,g as G,S as l,I as u,B as x,m as n,h as j}from"./index-b4683d61.js";import{a as U,u as V}from"./tuangou-86f5d757.js";import{B as A}from"./index-5f967da4.js";import{H as o}from"./index-133d6e1c.js";import{d as f,D as O}from"./index-cc7d88a3.js";import{F as r}from"./index-d434f3eb.js";import"./LeftOutlined-9e6e73a2.js";import"./InfoCircleOutlined-4d24221b.js";import"./row-4ee18533.js";import"./responsiveObserver-dc429d3b.js";const{RangePicker:z}=O,ae=()=>{const m=new URLSearchParams(P().search),[d]=r.useForm(),_=L(),h=R(),[p,b]=a.useState(!0),[g,c]=a.useState(!1),[y,Y]=a.useState(""),[D,w]=a.useState(""),[I,N]=a.useState(""),[H,S]=a.useState(""),[M,C]=a.useState(0),[i,q]=a.useState(Number(m.get("id")));a.useEffect(()=>{document.title="编辑团购活动",_(v("编辑团购活动")),F()},[i]),a.useEffect(()=>{q(Number(m.get("id")))},[m.get("id")]);const F=async()=>{await k(),b(!1)},k=async()=>{if(i===0)return;var s=(await U(i)).data.data;let E=[f(s.started_at,"YYYY-MM-DD HH:mm"),f(s.ended_at,"YYYY-MM-DD HH:mm")];d.setFieldsValue({charge:s.charge,started_at:E,people_num:s.people_num,time_limit:s.time_limit}),w(s.goods_thumb),S(s.original_charge),Y(s.goods_title),C(s.other_id),N(s.goods_type)},T=t=>{if(!g){if(t.charge<0){n.error("请输入正确的团购价");return}if(t.people_num<2){n.error("组团成功人数最少为2个");return}if(t.time_limit<0){n.error("请输入正确的有效期");return}c(!0),t.goods_type=I,t.original_charge=H,t.goods_title=y,t.goods_thumb=D,t.other_id=M,t.ended_at=j(new Date(t.started_at[1])).format("YYYY-MM-DD HH:mm"),t.started_at=j(new Date(t.started_at[0])).format("YYYY-MM-DD HH:mm"),V(i,t).then(s=>{c(!1),n.success("保存成功！"),h(-1)}).catch(s=>{c(!1)})}},B=t=>{console.log("Failed:",t)};return e.jsxs("div",{className:"meedu-main-body",children:[e.jsx(A,{title:"编辑团购活动"}),p&&e.jsx("div",{className:"float-left text-center mt-30",children:e.jsx(G,{})}),e.jsx("div",{style:{display:p?"none":"block"},className:"float-left mt-30",children:e.jsxs(r,{form:d,name:"tuangou-update",labelCol:{span:3},wrapperCol:{span:21},initialValues:{remember:!0},onFinish:T,onFinishFailed:B,autoComplete:"off",children:[e.jsx(r.Item,{label:"团购价",name:"charge",rules:[{required:!0,message:"请输入团购价!"}],children:e.jsxs(l,{align:"baseline",style:{height:32},children:[e.jsx(r.Item,{name:"charge",rules:[{required:!0,message:"请输入团购价!"}],children:e.jsx(u,{style:{width:300},placeholder:"请输入团购价",allowClear:!0,type:"number"})}),e.jsx("div",{className:"ml-10",children:e.jsx(o,{text:"最小单位：元。不支持小数。"})})]})}),e.jsx(r.Item,{label:"组团成功人数",name:"people_num",rules:[{required:!0,message:"请输入组团成功人数!"}],children:e.jsxs(l,{align:"baseline",style:{height:32},children:[e.jsx(r.Item,{name:"people_num",rules:[{required:!0,message:"请输入组团成功人数!"}],children:e.jsx(u,{type:"number",style:{width:300},placeholder:"请输入组团成功人数",allowClear:!0})}),e.jsx("div",{className:"ml-10",children:e.jsx(o,{text:"组团达到指定人数即为组团成功。原则上最少为2个人。"})})]})}),e.jsx(r.Item,{label:"有效期",name:"time_limit",rules:[{required:!0,message:"请输入有效期!"}],children:e.jsxs(l,{align:"baseline",style:{height:32},children:[e.jsx(r.Item,{name:"time_limit",rules:[{required:!0,message:"请输入有效期!"}],children:e.jsx(u,{type:"number",style:{width:300},placeholder:"单位：天",allowClear:!0})}),e.jsx("div",{className:"ml-10",children:e.jsx(o,{text:"团长开团时刻起多少天内有效，失败的话将自动转为退款订单"})})]})}),e.jsx(r.Item,{label:"活动时间",required:!0,children:e.jsxs(l,{align:"baseline",style:{height:32},children:[e.jsx(r.Item,{name:"started_at",rules:[{required:!0,message:"请输入活动时间!"}],children:e.jsx(z,{format:"YYYY-MM-DD HH:mm",showTime:!0,placeholder:["开始时间","结束时间"]})}),e.jsx("div",{className:"ml-10",children:e.jsx(o,{text:"团购开始时间，时间达到之后，学员才能参与团购"})})]})})]})}),e.jsx("div",{className:"bottom-menus",children:e.jsxs("div",{className:"bottom-menus-box",children:[e.jsx("div",{children:e.jsx(x,{loading:g,type:"primary",onClick:()=>d.submit(),children:"保存"})}),e.jsx("div",{className:"ml-24",children:e.jsx(x,{type:"default",onClick:()=>h(-1),children:"取消"})})]})})]})};export{ae as default};
