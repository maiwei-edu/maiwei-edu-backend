import{u as Q,b as U,r as i,t as W,j as e,B as h,I as p,S as C,m as u}from"./index-b4683d61.js";import{c as D,s as G}from"./creditMall-68ad6dbc.js";import{B as K}from"./index-5f967da4.js";import{H as S}from"./index-133d6e1c.js";import{U as L}from"./index-4432445b.js";import{S as $}from"./index-ea4492e3.js";import{Q as z}from"./index-353c72a4.js";import{F as t}from"./index-d434f3eb.js";import{T as J}from"./index-d198db66.js";import{S as _}from"./index-918ef875.js";import{S as O}from"./index-c09cc6d7.js";import{R as X,C as w}from"./row-4ee18533.js";import"./LeftOutlined-9e6e73a2.js";import"./InfoCircleOutlined-4d24221b.js";import"./InboxOutlined-1c6772bb.js";import"./selected-177ec16c.js";import"./Dragger-1df363a5.js";import"./useForceUpdate-f2aff5e0.js";import"./DeleteOutlined-8e7e99fd.js";import"./CheckOutlined-e6bc730e.js";import"./useIcons-e0af7133.js";import"./Pagination-d2c763c6.js";import"./responsiveObserver-dc429d3b.js";import"./course-7dc1c12e.js";import"./Table-76e623b5.js";import"./addEventListener-a27ae3f4.js";import"./index-10f1a096.js";import"./iconUtil-f3f90360.js";import"./live-ef2dd82c.js";import"./role-513b287e.js";import"./book-a8b4ca06.js";import"./path-6d6aef48.js";import"./topic-842c58e2.js";import"./paper-7f0d6524.js";import"./practice-e65e37d7.js";import"./mock-274446b7.js";import"./index-1a122d3f.js";import"./PlusOutlined-c97c4cac.js";const Ee=()=>{const[l]=t.useForm(),F=Q(),x=U(),[o,n]=i.useState(!1),[j,b]=i.useState(0),[m,I]=i.useState("base"),[k,V]=i.useState([]),[N,c]=i.useState(!1),[d,T]=i.useState(""),[f,g]=i.useState(""),[y,R]=i.useState(""),B=[{key:"base",label:"基础信息"},{key:"dev",label:"可选信息"}];i.useEffect(()=>{document.title="新建积分商品",F(W("新建积分商品")),l.setFieldsValue({is_show:1,is_v:0}),q()},[]);const q=()=>{D().then(s=>{let a=s.data.types;const v=[];for(let r=0;r<a.length;r++)v.push({label:a[r].name,value:a[r].value});V(v)})},A=s=>{I(s)},E=s=>{if(!o){if(s.is_v===0&&l.setFieldsValue({v_type:null,v_id:null}),s.is_v===1&&!s.v_type){u.error("请选择虚拟商品类型");return}if(s.is_v===1&&s.v_type&&!s.v_id){u.error("请选择虚拟商品");return}n(!0),G(s).then(a=>{n(!1),u.success("保存成功！"),x(-1)}).catch(a=>{n(!1)})}},P=s=>{console.log("Failed:",s)},H=s=>{s?l.setFieldsValue({is_show:1}):l.setFieldsValue({is_show:0})},M=s=>{s?(l.setFieldsValue({is_v:1}),b(1)):(l.setFieldsValue({is_v:0}),b(0))};return e.jsxs("div",{className:"meedu-main-body",children:[e.jsx(K,{title:"新建积分商品"}),e.jsx($,{open:N,enabledResource:y,onCancel:()=>c(!1),onSelected:s=>{l.setFieldsValue({v_id:s.id,title:s.title,thumb:s.thumb}),T(s.title),g(s.thumb),c(!1)}}),e.jsx("div",{className:"center-tabs mb-30",children:e.jsx(J,{defaultActiveKey:m,items:B,onChange:A})}),e.jsx("div",{className:"float-left",children:e.jsxs(t,{form:l,name:"creditMall-create",labelCol:{span:3},wrapperCol:{span:21},initialValues:{remember:!0},onFinish:E,onFinishFailed:P,autoComplete:"off",children:[e.jsxs("div",{style:{display:m==="base"?"block":"none"},children:[e.jsx(t.Item,{label:"是否虚拟商品",name:"is_v",valuePropName:"checked",children:e.jsx(_,{onChange:M})}),j===1&&e.jsx(t.Item,{name:"v_type",label:"虚拟商品类型",children:e.jsx(O,{style:{width:300},allowClear:!0,placeholder:"请选择虚拟商品类型",options:k,onChange:s=>{R(s)}})}),j===1&&y&&e.jsx(t.Item,{label:"虚拟商品",name:"v_id",children:e.jsxs(h,{loading:o,type:"primary",onClick:()=>c(!0),children:[d&&e.jsxs("span",{children:["已选择「",d,"」"]}),!d&&e.jsx("span",{children:"选择商品"})]})}),e.jsx(t.Item,{label:"商品名",name:"title",rules:[{required:!0,message:"请输入商品名!"}],children:e.jsx(p,{style:{width:300},placeholder:"请输入商品名",allowClear:!0})}),e.jsx(t.Item,{label:"商品封面",name:"thumb",rules:[{required:!0,message:"请上传商品封面!"}],children:e.jsx(L,{text:"上传封面",onSelected:s=>{l.setFieldsValue({thumb:s}),g(s)}})}),f&&e.jsxs(X,{style:{marginBottom:22},children:[e.jsx(w,{span:3}),e.jsx(w,{span:21,children:e.jsx("div",{className:"contain-thumb-box",style:{backgroundImage:`url(${f})`,width:400,height:400,backgroundColor:"#f4fafe"}})})]}),e.jsx(t.Item,{label:"价格",name:"charge",rules:[{required:!0,message:"请输入价格!"}],children:e.jsxs(C,{align:"baseline",style:{height:32},children:[e.jsx(t.Item,{name:"charge",rules:[{required:!0,message:"请输入价格!"}],children:e.jsx(p,{style:{width:300},placeholder:"单位：积分",allowClear:!0,type:"number"})}),e.jsx("div",{className:"ml-10",children:e.jsx(S,{text:"价格最小单位为：积分，不支持小数"})})]})}),e.jsx(t.Item,{label:"介绍",name:"desc",rules:[{required:!0,message:"请输入介绍!"}],style:{height:440},children:e.jsx(z,{mode:"",height:400,defautValue:"",isFormula:!1,setContent:s=>{l.setFieldsValue({desc:s})}})}),e.jsx(t.Item,{label:"库存",name:"stock_count",rules:[{required:!0,message:"请输入库存!"}],children:e.jsx(p,{type:"number",style:{width:300},placeholder:"商品库存数量",allowClear:!0})})]}),e.jsx("div",{style:{display:m==="dev"?"block":"none"},children:e.jsx(t.Item,{label:"显示",name:"is_show",children:e.jsxs(C,{align:"baseline",style:{height:32},children:[e.jsx(t.Item,{name:"is_show",valuePropName:"checked",children:e.jsx(_,{onChange:H})}),e.jsx("div",{className:"ml-10",children:e.jsx(S,{text:"控制用户是否能看到该商品"})})]})})})]})}),e.jsx("div",{className:"bottom-menus",children:e.jsxs("div",{className:"bottom-menus-box",children:[e.jsx("div",{children:e.jsx(h,{loading:o,type:"primary",onClick:()=>l.submit(),children:"保存"})}),e.jsx("div",{className:"ml-24",children:e.jsx(h,{type:"default",onClick:()=>x(-1),children:"取消"})})]})})]})};export{Ee as default};
