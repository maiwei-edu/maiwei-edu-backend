import{r as a,j as e,M as k,f as V,u as M,b as G,t as K,d as U,S,D as q,B as H,e as J,E as Q,m as W}from"./index-b4683d61.js";import{y as X,z as Y,A as $}from"./live-ef2dd82c.js";import{B as ee}from"./index-5f967da4.js";import{P as u}from"./index-573a6ce5.js";import{D as N}from"./index-44896e29.js";import{i as te}from"./index-305edcd4.js";import{T as se}from"./Table-76e623b5.js";import"./LeftOutlined-9e6e73a2.js";import"./addEventListener-a27ae3f4.js";import"./useIcons-e0af7133.js";import"./CheckOutlined-e6bc730e.js";import"./Pagination-d2c763c6.js";import"./useForceUpdate-f2aff5e0.js";import"./responsiveObserver-dc429d3b.js";import"./index-c09cc6d7.js";import"./index-10f1a096.js";import"./iconUtil-f3f90360.js";const ae="_charts_wnz35_9",ie="_item_wnz35_29",i={"live-stats-body":"_live-stats-body_wnz35_1",charts:ae,"stats-content":"_stats-content_wnz35_14","border-item":"_border-item_wnz35_21","item-name":"_item-name_wnz35_29","item-value":"_item-value_wnz35_36",item:ie},ne=n=>{let p=a.useRef(null);const[c,r]=a.useState(!1),[l,_]=a.useState({});a.useEffect(()=>(n.open&&n.id!==0&&v(),()=>{window.onresize=null}),[n.open,n.id]);const v=()=>{c||(r(!0),X(n.id).then(o=>{_(o.data),h(o.data.online_user_count_per_minute),r(!1)}).catch(o=>{r(!1)}))},h=o=>{let m=[],f=[];for(let x in o)m.push(x),f.push(o[x]);let g=p.current,j=te(g);j.setOption({title:{text:"学员实时在线统计",left:"center",textStyle:{color:"#333",fontSize:16}},tooltip:{trigger:"axis"},xAxis:{type:"category",boundaryGap:!1,data:m},yAxis:{type:"value"},series:[{name:"在线学员数",type:"line",itemStyle:{normal:{lineStyle:{color:"#4876FF"}}},stack:"总量",data:f}]}),window.onresize=()=>{j.resize()}};return e.jsx(e.Fragment,{children:n.open?e.jsx(k,{title:"直播统计",onCancel:()=>{n.onCancel()},open:!0,width:1e3,maskClosable:!1,footer:null,centered:!0,children:e.jsxs("div",{className:i["live-stats-body"],children:[e.jsxs("div",{className:i["stats-content"],children:[e.jsxs("div",{className:i["border-item"],children:[e.jsx("div",{className:i["item-name"],children:"直播时长"}),e.jsx("div",{className:i["item-value"],children:e.jsx(N,{duration:l.duration})})]}),e.jsxs("div",{className:i["border-item"],children:[e.jsx("div",{className:i["item-name"],children:"聊天消息数"}),e.jsx("div",{className:i["item-value"],children:l.count_watch_user})]}),e.jsxs("div",{className:i["border-item"],children:[e.jsx("div",{className:i["item-name"],children:"观看总人数"}),e.jsx("div",{className:i["item-value"],children:l.count_watch_user})]}),e.jsxs("div",{className:i.item,children:[e.jsx("div",{className:i["item-name"],children:"学员平均观看时长"}),e.jsx("div",{className:i["item-value"],children:e.jsx(N,{duration:l.avg_watch_duration})})]})]}),e.jsx("div",{className:i.charts,children:e.jsx("div",{ref:p,style:{width:"100%",height:280,position:"relative"}})})]})}):null})},{confirm:le}=k,Se=()=>{const n=new URLSearchParams(V().search),p=M(),c=G(),[r,l]=a.useState(!1),[_,v]=a.useState([]),[h,o]=a.useState(1),[m,f]=a.useState(1e3),[g,j]=a.useState(0),[x,C]=a.useState(!1),[d,z]=a.useState(Number(n.get("id"))),[y,D]=a.useState(String(n.get("title"))),[L,b]=a.useState(0),[E,w]=a.useState(!1);a.useEffect(()=>{document.title=y,p(K("直播排课"))},[y]),a.useEffect(()=>{z(Number(n.get("id"))),D(String(n.get("title")))},[n.get("id"),n.get("title")]),a.useEffect(()=>{F()},[d,h,m,x]);const F=()=>{r||(l(!0),Y({page:h,size:m,course_id:d}).then(s=>{v(s.data.data),j(s.data.total),l(!1)}).catch(s=>{l(!1)}))},P=()=>{o(1),v([]),C(!x)},T={current:h,pageSize:m,total:g,onChange:(s,t)=>Z(s,t),showSizeChanger:!0},Z=(s,t)=>{o(s),f(t)},B=[{title:"标题",width:"42%",render:(s,t)=>e.jsxs(e.Fragment,{children:[t.chapter&&e.jsxs(e.Fragment,{children:[e.jsx("span",{children:t.chapter.name}),e.jsx("span",{className:"mx-5",children:"/"})]}),e.jsx("span",{children:t.title})]})},{title:"直播时间",width:"18%",dataIndex:"published_at",render:s=>e.jsx("span",{children:U(s)})},{title:"状态",width:"18%",render:(s,t)=>e.jsxs(e.Fragment,{children:[t.status===1&&e.jsxs("span",{className:"c-green",children:["· ",t.status_text]}),t.status===2&&e.jsxs("span",{className:"c-gray",children:["· ",t.status_text]}),t.status===0&&e.jsxs("span",{className:"c-yellow",children:["· ",t.status_text]})]})},{title:"操作",width:"12%",fixed:"right",align:"right",render:(s,t)=>{const I=[{key:"1",label:e.jsx(u,{type:"link",text:"编辑",class:"c-primary",icon:null,p:"addons.Zhibo.course_video.update",onClick:()=>{c("/live/course/video/update?id="+t.id+"&course_id="+d)},disabled:null})},{key:"2",label:e.jsx(u,{type:"link",text:"聊天",class:"c-primary",icon:null,p:"addons.Zhibo.chat.list",onClick:()=>{c("/live/course/video/chats?id="+t.id+"&course_id="+d)},disabled:null})},{key:"3",label:e.jsx(u,{type:"link",text:"删除",class:"c-red",icon:null,p:"addons.Zhibo.course_video.delete",onClick:()=>{R(t.id)},disabled:null})}];return e.jsxs(S,{children:[e.jsx(u,{type:"link",text:"学员",class:"c-primary",icon:null,p:"addons.Zhibo.course_video.stats",onClick:()=>{c("/live/course/video/users?id="+t.id+"&course_id="+d)},disabled:null}),t.status===2&&e.jsx(u,{type:"link",text:"统计",class:"c-primary",icon:null,p:"addons.Zhibo.course_video.stats",onClick:()=>{A(t.id)},disabled:null}),e.jsx(q,{menu:{items:I},children:e.jsx(H,{type:"link",className:"c-primary",onClick:O=>O.preventDefault(),children:e.jsxs(S,{size:"small",align:"center",children:["更多",e.jsx(J,{})]})})})]})}}],R=s=>{s!==0&&le({title:"警告",icon:e.jsx(Q,{}),content:"确认操作？",centered:!0,okText:"确认",cancelText:"取消",onOk(){r||(l(!0),$(s).then(()=>{l(!1),W.success("删除成功"),P()}).catch(t=>{l(!1)}))},onCancel(){console.log("Cancel")}})},A=s=>{b(s),w(!0)};return e.jsxs("div",{className:"meedu-main-body",children:[e.jsx(ee,{title:y}),e.jsxs("div",{className:"float-left mb-30 mt-30",children:[e.jsx(u,{type:"primary",text:"新建排课",class:"",icon:null,p:"addons.Zhibo.course_video.store",onClick:()=>c("/live/course/video/create?course_id="+d),disabled:null}),e.jsx(u,{type:"primary",text:"章节管理",class:"ml-10",icon:null,p:"addons.Zhibo.course_chapter.list",onClick:()=>c("/live/course/chapter/index?id="+d),disabled:null})]}),e.jsx("div",{className:"float-left",children:e.jsx(se,{loading:r,columns:B,dataSource:_,rowKey:s=>s.id,pagination:T})}),e.jsx(ne,{id:L,open:E,onCancel:()=>{b(0),w(!1)}})]})};export{Se as default};
